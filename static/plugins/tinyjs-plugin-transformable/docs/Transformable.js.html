<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <title>Transformable.js - Documentation</title>

    <script src="scripts/prettify/prettify.js"></script>
    <script src="scripts/prettify/lang-css.js"></script>
    <!--[if lt IE 9]>
      <script src="//html5shiv.googlecode.com/svn/trunk/html5.js"></script>
    <![endif]-->
    <link type="text/css" rel="stylesheet" href="styles/prettify.css">
    <link type="text/css" rel="stylesheet" href="styles/jsdoc.css">
</head>
<body>

<input type="checkbox" id="nav-trigger" class="nav-trigger" />
<label for="nav-trigger" class="navicon-button x">
  <div class="navicon"></div>
</label>

<label for="nav-trigger" class="overlay"></label>

<nav>
    <h2><a href="index.html">Home</a></h2><h3>Classes</h3><ul><li><a href="Transformable.html">Transformable</a><ul class='methods'><li data-type='method'><a href="Transformable.html#.deactivateAll">deactivateAll</a></li><li data-type='method'><a href="Transformable.html#activate">activate</a></li><li data-type='method'><a href="Transformable.html#addWidget">addWidget</a></li><li data-type='method'><a href="Transformable.html#deactivate">deactivate</a></li><li data-type='method'><a href="Transformable.html#fixedIndex">fixedIndex</a></li></ul></li></ul><h3>Externals</h3><ul><li><a href="external-Tiny.html">Tiny</a></li></ul>
</nav>

<div id="main">
    
    <h1 class="page-title">Transformable.js</h1>
    

    



    
    <section>
        <article>
            <pre class="prettyprint source linenums"><code>import { DEFAULT_FRAME } from './constants';
import { Draggable, Frame, Zoom, Rotate, Remove, FlipX, FlipY, Widget } from './widget';

/**
 * @example
 * var ta = new Tiny.Transformable(sprite);
 * ta.on('remove:touchend', function(e) {
 *   console.log('remove', e);
 *   this.parent.removeChild(this);
 * });
 *
 * @class
 */
class Transformable extends Tiny.Container {
  /**
   *
   * @param {Tiny.Sprite} target
   * @param {object} opts
   * @param {object} [opts.frame={}]
   * @param {boolean} [opts.frame.fitness=true] - 操作是否贴合
   * @param {number} [opts.frame.thickness=1] - 选框线条粗细
   * @param {number} [opts.frame.color=0xffffff] - 选框线条颜色
   * @param {number} [opts.frame.lineOpacity=1] - 选框线条透明度
   * @param {number} [opts.frame.fill=0] - 选框填充颜色值
   * @param {number} [opts.frame.fillOpacity=0] - 选框填充透明度
   * @param {boolean|object} [opts.drag={}] - 是否可拖拽
   * @param {boolean} opts.drag.inScreen - 是否可移出屏幕外
   * @param {boolean|object} [opts.zoom={}] - 是否可缩放
   * @param {string|Tiny.Texture|Tiny.Sprite} [opts.zoom.sprite=ICONS['zoom'][0]] - 缩放控件的显示对象
   * @param {number} [opts.zoom.minScale=0.5] - 最小缩放值
   * @param {number} [opts.zoom.maxScale=1.5] - 最大缩放值
   * @param {boolean|object} [opts.rotation={}] - 是否可旋转
   * @param {string|Tiny.Texture|Tiny.Sprite} [opts.rotation.sprite=ICONS['rotation'][0]] - 旋转控件的显示对象
   * @param {boolean|object} [opts.remove={}] - 是否显示移除控件
   * @param {string|Tiny.Texture|Tiny.Sprite} [opts.remove.sprite=ICONS['remove'][0]] - 移除控件的显示对象
   * @param {boolean|object} [opts.flipx={}] - 是否可横向翻转
   * @param {string|Tiny.Texture|Tiny.Sprite} [opts.flipx.sprite=ICONS['flipx'][0]] - 横向翻转控件的显示对象
   * @param {boolean|object} [opts.flipy={}] - 是否可纵向翻转
   * @param {string|Tiny.Texture|Tiny.Sprite} [opts.flipy.sprite=ICONS['flipy'][0]] - 纵向翻转控件的显示对象
   */
  constructor(target, opts = {}) {
    super();

    const { frame = {}, drag = {}, zoom = {}, rotation = {}, remove = {}, flipx = {}, flipy = {} } = opts;
    const { width, height } = target.getBounds();

    this.$fixedIndex = false;
    this.$icons = {};

    /**
     * @type {Tiny.Sprite}
     */
    this.target = target;

    /**
     * 被编辑显示对象的容器
     *
     * @type {Tiny.Container}
     */
    this.spriteContainer = new Tiny.Container();

    /**
     * 控件的容器
     *
     * @type {Tiny.Container}
     */
    this.widgetContainer = new Tiny.Container();

    target.setAnchor(0.5);

    /**
     * 被编辑显示对象的宽
     *
     * @type {number}
     */
    this.targetWidth = width;
    /**
     * 被编辑显示对象的高
     *
     * @type {number}
     */
    this.targetHeight = height;
    this.deactivate();
    this.addChild(this.spriteContainer);
    this.addChild(this.widgetContainer);
    this.spriteContainer.addChild(target);
    this.widgetContainer.addChild(Frame.getInstance({ width, height, ...DEFAULT_FRAME, ...frame }));

    new Draggable(this, drag); // eslint-disable-line

    if (zoom) {
      this.widgetContainer.addChild(Zoom.getInstance(this, { ...{ minScale: 0.5, maxScale: 1.5 }, ...zoom }));
    }

    if (rotation) {
      this.widgetContainer.addChild(Rotate.getInstance(this, { ...rotation, fitness: ({ ...DEFAULT_FRAME, ...frame }).fitness }));
    }

    if (remove) {
      this.widgetContainer.addChild(Remove.getInstance(this, { ...remove }));
    }

    if (flipx) {
      this.widgetContainer.addChild(FlipX.getInstance(this, { ...flipx }));
    }

    if (!flipx &amp;&amp; flipy) {
      this.widgetContainer.addChild(FlipY.getInstance(this, { ...flipy }));
    }

    Transformable.instancesPoll.push(this);

    this.on('removed', () => {
      Tiny.arrayRemoveObject(Transformable.instancesPoll, this);
    });
    this.on('added', () => {
      const p = this.parent;
      const cancelHandler = (e) => {
        for (const key in this.$icons) {
          this.$icons[key].activated = false;
        }
      };

      p.on('pointerup', cancelHandler);
      p.on('pointerout', cancelHandler);
      p.on('pointercancel', cancelHandler);
      p.on('pointerupoutside', cancelHandler);
    });

    /**
     * Fired when remove touchend.
     *
     * @event Tiny.Transformable#remove:touchend
     */
    /**
     * Fired when flipx touchend.
     *
     * @event Tiny.Transformable#flipx:touchend
     */
    /**
     * Fired when flipy touchend.
     *
     * @event Tiny.Transformable#flipy:touchend
     */
  }

  /**
   * 激活编辑态
   */
  activate() {
    Transformable.deactivateAll();
    this.widgetContainer.renderable = true;

    if (!this.$fixedIndex) {
      this.parent.setChildIndex(this, this.parent.children.length - 1);
    }

    for (const key in this.$icons) {
      this.$icons[key].setEventEnabled(true);
    }
  }

  /**
   * 休眠编辑态
   */
  deactivate() {
    this.widgetContainer.renderable = false;
    for (const key in this.$icons) {
      this.$icons[key].setEventEnabled(false);
    }
  }

  /**
   * 是否按添加的顺序固定 index
   *
   * @param {boolean} fixed
   */
  fixedIndex(fixed) {
    this.$fixedIndex = fixed;
  }

  /**
   * 添加自定义控件
   *
   * @param {string} name - 名称，如：skew
   * @param {string|Tiny.Texture|Tiny.Sprite} image - 控件的显示对象
   * @param {number[]} [pos=[1,1]] - 位置（取值区间[[-1, 1], [-1, 1]]），如：[1,1]
   * @param {object} [listeners={}] - 回调
   * @param {function} [listeners.onTouchStart]
   * @param {function} [listeners.onTouchMove]
   * @param {function} [listeners.onTouchEnd]
   * @param {function} [listeners.onTouchCancel]
   */
  addWidget(name, image, pos = [1, 1], listeners = {}) {
    this.widgetContainer.addChild(Widget.getInstance(this, {
      name,
      sprite: image,
      pos,
      listeners,
    }));
  }
}

Transformable.instancesPoll = [];

/**
 * 使所有控件都休眠
 *
 * @static
 */
Transformable.deactivateAll = () => {
  Transformable.instancesPoll.forEach(item => {
    item.deactivate();
  });
};

export { Transformable };
</code></pre>
        </article>
    </section>




</div>

<br class="clear">

<footer>
    Documentation generated by <a href="https://github.com/jsdoc3/jsdoc">JSDoc 3.5.5</a> on Tue Jul 27 2021 16:13:31 GMT+0800 (GMT+08:00) using the <a href="https://github.com/clenemt/docdash">docdash</a> theme.
</footer>

<script>prettyPrint();</script>
<script src="scripts/linenumber.js"></script>
</body>
</html>
