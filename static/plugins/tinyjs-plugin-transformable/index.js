/*!
 * Name: tinyjs-plugin-transformable
 * Description: The Tiny.js plugin for transform something
 * Author: yiiqii
 * Version: v0.1.0
 */
!function(t,n){"object"==typeof exports&&"undefined"!=typeof module?module.exports=n():"function"==typeof define&&define.amd?define(n):(t.Tiny=t.Tiny||{},t.Tiny.Transformable=n())}(this,function(){"use strict";var t="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAADcAAAA3CAMAAACfBSJ0AAABNVBMVEUAAAD////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////YGTPaITr86evbJT764OP3z9T0uMDjU2fdNEvcLETZHjfZHDb/+/v+9/j97/H409j3ytDrhJLhSl7fPlTeOU/cMEj+8/T75Of529/519v2x830vsXysbryrrfwpK/woqzumKTsi5jnbH3lYXPbKUH87e/52t71wsnocoLgQ1jzs7zxqbPvnqntkp/peIfjWmxcOTleAAAANnRSTlMA/Pnv/rtuKCTxpEtDBOLd2tPKtpyORzQuEA307OXEvq6UiXJmVxsXEwmyqIF+eGFQPh8G1cwBBg/JAAACgklEQVRIx5XV6VbiQBAF4Ar7KiIiiPu+6+jM3KCIG+67oCPojDrr+z/CdBpOoOkCku8HnHBySdLVVaFOluaD2dDCZ3IhF01PjEEyEqnVTUfhpbmUAdVIZKhXKj47Bk7yU9fYXD86Gd/smAoOoJvJRT4W9aK7RJaLrRvoZUR/yngEDvjW2nODcCagxmbgkKGUMmrAKW+wpQBhONc/bOf8cCNNDUNwxbPVyCVhK1ROoCsVd9EiQtIGbHd58/pei51cmGaltYoZmeuD7Ztpmq+7UG1fil9raJEiIYamQl6csvOgxG6vTKGoFHFe5JQNdrYjzsmX0XS3L345eoJiRuTULjg9EKcd/rSP7+XxI1QTRBmoflxb//8Ldbuv1vWLWimW9J1Z2DeF37A8yNt+gyYmG4FZP/MPgLJcpjO2Lcah+f5hBc9RORRfB6dgTInq6W4urODekfi4vgNnmUbBON4z664KYE2QB2zwRcYut8EbEDnWucztHXfMjYLzV4Rk8IbP+SnBja2alZF1vDjhZzDX6yX5cC+lqil8sI84TVP6mvwzhVoJeJZLesvkZmlWK56swbtP9uORdb9MLTIU0ptbbpa6R7lltBEQjhP1MZuzah8X89wIWCaitN7cz2h6Y0YANkQu27qjG82tjwDliiM5EgaUuSSbWx8B72gxSG2D6UxvbjkC1Fv3zJOUgq18zrXbdvXJpxS9LmvAjdFh7aXp8tW5mHAR88fJFvS6f/1JQ04f0RsiRcBZzIhRm4CTK4ajpIl5ez9bkBihL71WcphYuSlPt3tcj1MnoRUfeJ70InWT8bPLGNmiXkJrybbQeGCBHFmYm55MjoU93r6vK6vRHDH+Azzf77qpXzbkAAAAAElFTkSuQmCC",n="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAADcAAAA2CAMAAABUWfHRAAAA9lBMVEUAAAD////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////YGTP/+/v86+3lZHbaJT7cK0P51tv74+b3y9Hqf43kYHLumqb1v8bfP1X++Pn+8/Ttj5zaITr63eH40dbulqLsipjma3vdNEr//f3ztr7xrbbvoKvqfotfJiWrAAAANHRSTlMA+t0FEgP21w8LCPLtzsW/lm5Qu3tUH+7q5rSfm5GMYl9CNCwZybmupYlnS0U8Lad1c3En87nDZgAAAfhJREFUSMet0sdi4jAQgOFxwXSw6R1Cets6goVki0kgddv7v8wusuNIxpLnkP/ky2dpJMFbVthrnBx2i2iUzKrrvaOh3LhuoFSpf5FJU/apgwmZE63MN4qoKNtUs0kHNZUVg1ou6nMSlzyoYGqj3SmnXSRUz8dYq4OkevKKuSwSc0Vm1ZGcJ7ghKrqdv3aDQXsR2zcUbM2ENn74AqIRj1DRiok9YdBZyM5R1Z+N6L5gUCfHWUZ3ljPeX8nhKXc1TOsbk12R3/4xia0Eh5PtlRsU9v1BdEd8mxQ2+yE6pwAwJDEUHb/7ConF3EeAEoXF3QByOvYrZDuuCi2dewjZjivDvs7NV+wpYOgztsYokztNt9GX/3smOHmfV4/3EbhDTWX5XJ7ZIvzp1yUfR1UVoC08fsbYPGALxti12vUBKjEXsecbtfsA4MZdyJZXqO4CoBZzFGYUAGxDdgSGdfhfT3YEhuOta0rOJzAnv3WWKToCwyHwaqIjsLYNQVXJLf1rnvL6PkHYNHJii/tkZlrw0gB5P5nUOtmdQ1QhfGyPG4Gt7hJZA4RsE4n1Qepzm8aqFshdliisYkO8VjmdDSzYLX+SoowzSM4r6lh2CqrskaNS5jgDmg5cI0l1PT6ZVnqHMeQcNwtAya6NetntrEap/L5xGS5FLq9Z5R/gTsBPh18U3QAAAABJRU5ErkJggg==",e="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAADcAAAA3CAMAAACfBSJ0AAABPlBMVEUAAAD////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////YGTPdMkn30NXZGzX//f3+9vf86Ovxq7XfPlPaIjv++Pn63+P3zNL0vcTwoazumaTbJj/97/H2x83ysLnrh5Xnb3/kX3HiUWXgRlveOlDcKkLZHTf98fP40tjtj5zsipfrhZPqgpDpd4fmaHnlZHbkW27jVGf+9PX64uX52N31wsnulqLodYThSV7fPlTcMEfZHzjZHjf98/TvnKjlYXPfQVdDI8zxAAAAM3RSTlMA+bPxJyILA/vr6LyagDMeFg0G0ZKOiWlfWlNGOjcB9drLwq2lhHVwTC7ft3o/Ghnj4EnYJz4cAAACyElEQVRIx5WW51oiMRSGA9IFQQEVFHuvu3tmZKQtTWBBF3vBvuqW+7+BTSgzJ2EG4vsv3zPvk+TkJECscAUdY479CfIJxjeiSz5o41mw7yTcMtJE3G4DHm9kbJg1F9sCM7Y3B2ozi2CBZyVoaYW2YQC2wJy5tvkVBrPsMtPi8zCMsLNfWwMJvAlRmwYpvMKMszaQI8ztMegDWeyoqhP6sR2dDhUDhrfey9LN96r+gXZkfo5OvY+9vSyjKK/AeLxsqE2lqbZK3/vElZ63qkeqomTYtMeKQeNAFLtdvjfPe6k7hefmN++NdrwocF6hrDA+Tlo3rZOO+EtY7CzT3D7OU7Psy+NipygPJZUNf/Kin3nfgPOS9LNy0YgOz1mS4c5nhD0fEc5jqA+AaS+8Dphd6oVFL/tSq9UuKkb61KTpk3D248B5Osm8ET+zHQsVTeBxRjH4Y8Qaq2seffdFuEDFpK6pKZSnaXAJCJdwX1MHXc4OcXz6QQ8RB07aZDI06IY1NN4kUSnvB11oiuuYSSnvinpnXGvvSHnX1MO95iBTgMilq5qpV6cerlSIzAjbuDL13mhv4wYlJAgIer7lnImWp9PdovEiIXNeoWwli3KmhYu0jMYV1tapPu0xSWP8SsUI4QvT0BeEuP9H0wuchKgX8uCNsAZ94Wuau2M3/r7vgbED4kKh1HHJU6/sVhUAMc00/iS0OhPV0qH+TJRZ8AwIn4u0GRVXxdZ1na4cFIq3WYVRA8wU6TAGGO1KEchWAbOg/y9ZAY7KMbaSN8LrGSc9nMJPtFb4+9613q7FZ36JGMRAJJcvnl+Wqmcg4gsSxCRIYpslGLdd0psW/8uFpbRJIjIuMaNnnfTjHrrHkRliSsw2UFtwEAscywMmC7iINYkli/JHQmQwG6Oe/rn8TjKcvXX7CJK2/HHpf+dux8baasQfDUzt7hNT/gOKANI4PmQ+0QAAAABJRU5ErkJggg==",i="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAADcAAAA4CAMAAABuU5ChAAABMlBMVEUAAAD////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////YGTP0v8bumKPyr7jjVmnxqbP/+/vbJD3ZHDb+9vf87e/86ezcL0baIDnsipjncIDmanvjWWviUGPhSV7fPFL63+P41Nn3ztP1wsn1wcjvnantkZ7cKkL98/T98PL75Of52d340df2ytDysbrulaHrhZPqgI7lZHbkXW/gQljeOE/64uX2yc/zt7/wpK/qg5HpeYiG6FF/AAAANHRSTlMACPTsDgH74MePFtbDclgjEgW2mXt3Y0E7NC7izpSHgmpOKyAd+O7m3dC9sKSfVDGpoV1bAT3B8QAAAqxJREFUSMeV1gdX4kAQwPExIRTpHbH3s1+Z6J2RIoq917OcXv3+X+E2OAqzuwn4f08gxN8LjgsseGWlJssTUwF4T8nC4pCBrcxwNtHfE5rKR1EqVuh63f7hIGqayff5qb6cgR6FPluebHwQfRoqe7Ac+meMa1/jInYtrxlIGHvoU1q+mo45qJSV3BIqVXftJiqNMRZHtXXbto9QLljsYMWgxq0Jt4pK5mT7jwth7w4XlFfpnD3UPN3qvxN6VCIWMOmJLdt+vvBwv8XRFS1zcqNI7YhzTb2rn4uj73Twsm5Sb2v5my1aZ46d+koHcy03huzkxoHGndmdDgdcF+bO3nMUd1ThLuIuTJScfS+7i2ebu0HhEoqzjyXXtCWHSYAsd9viZ7PWdrTgKtvMFQBi3FX3xc2PTnewIR5srTMXATC5wxt3Bqdt5+y1ZsVdBgIoObwTt43rN3fv/m9+IndRmJIcLZsnh9yvSgtIbhYmVFdviPtbcu48HlF2BpRlR/Orkzuj+XI3DUnZ0fyQHM1Xcib0y641v13n1eFhw52v5EJgTUvurzu/KyRH941D7sIAUe6ObXqjkaP57p8ytwSwwN2mu9aQufqm+zxzeYC4sq73q9zhqrKuSwADsmvcoOTwQXJGGsCaldwaKs554i4Dogh3O6g6vN5g7ovrBpg7r+sc/ul0Rh+4zSPVpN/UOHykzwG3EQB2wdvzyh16uMtdsYhokb3uLj4iVb30+X6oIRUHKhl8z/fKYHtLEvFyJ6iWgLfSMVQ7Euu7hkrDbFcQ0sCTrUNUmuc7gxUDe+pDCnjLwV6YOQFyRbM7i07qdp3Rbiyj304GMv4sYoE+KxHyVuGS3wY0PuMxx2XwLzWquebQWBq6ZhUjcx0mGBstQ6+lSoXcSHZ4JJdY0W+s/wOoYeI4ogLoOgAAAABJRU5ErkJggg==",o="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAADgAAAA3BAMAAACr/pT4AAAABGdBTUEAALGPC/xhBQAAAAFzUkdCAK7OHOkAAAAwUExURUdwTP///////////////////////////9gZM/XCyeRXau6Yo/Ktt/vl6N41TOp/jRf/vt8AAAAHdFJOUwCMF+PBYDWJP8hMAAAB1ElEQVQ4y31UO0gDQRBdL0ZbBcE24K9ViaYVRdIqirbxA7bGS7JEEtKOSmIZbbQ0CKkTEGyjYB9IYWssrLWwcD93u7O7d74id3svszPz5kOIgre9kfHTkzkSgYMMldh0uV2qkE9Z3DFFWDG5WUpj2bGMSdIJRO5bHC1otyPUwaoip13ST8UbUrqMPFbfNF6F1yBU/n4DCA864FH++oPJOv9S0nm4lvJeIUBlCPDLHT4DXPZFSFs61gHANQ+M/aknvywyciaIvQvQFr9fwYcikq7MbQJ7GjrNhodz5m0IjabSIUc8LcoLj7SNS5PUh2oL4AopuGYIW4NGHx1PpT4h7jv4VCIJGosiWRBp3FoQt+cl2QILdUme8IfNSSUC0rG8QNdWniw0ERmNPBnHx3LfTAWLUB1emyJg+bqG7vQMCz/gcfaw8LpkvNqo1qI51YCx7myzkn6iYqs2GfBi8pKGlfFZmwSJVkB0SE11JktTtSYz+ebPO3UxHyUZ0TtWtqOaWk6nOyu+GIdEkL/GR9jTRMpQe0RoSgnipl7P/b9j72UjyFzM/tLhCFPHq48Wa9Im1/HyO7K7x8BOzOZz3BacTe6pVb0UteXnpnhTpPdINLz5Q8PbH9SoSbdHwQAHAAAAAElFTkSuQmCC",a={remove:[t,-1,-1],zoom:[n,-1,1],rotate:[e,1,1],flipx:[i,1,-1],flipy:[o,1,-1]},r={fitness:!0,thickness:1,color:16777215,lineOpacity:1,fill:0,fillOpacity:0},s=Object.freeze({REMOVE_IMAGE:t,ZOOM_IMAGE:n,ROTATE_IMAGE:e,FLIPX_IMAGE:i,FLIPY_IMAGE:o,ICONS:a,DEFAULT_FRAME:r}),c=function(t,n){if(!(t instanceof n))throw new TypeError("Cannot call a class as a function")},h=function(){function t(t,n){for(var e=0;e<n.length;e++){var i=n[e];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(t,i.key,i)}}return function(n,e,i){return e&&t(n.prototype,e),i&&t(n,i),n}}(),d=Object.assign||function(t){for(var n=1;n<arguments.length;n++){var e=arguments[n];for(var i in e)Object.prototype.hasOwnProperty.call(e,i)&&(t[i]=e[i])}return t},l=function(t,n){if("function"!=typeof n&&null!==n)throw new TypeError("Super expression must either be null or a function, not "+typeof n);t.prototype=Object.create(n&&n.prototype,{constructor:{value:t,enumerable:!1,writable:!0,configurable:!0}}),n&&(Object.setPrototypeOf?Object.setPrototypeOf(t,n):t.__proto__=n)},u=function(t,n){if(!t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!n||"object"!=typeof n&&"function"!=typeof n?t:n},f=function(){return function(t,n){if(Array.isArray(t))return t;if(Symbol.iterator in Object(t))return function(t,n){var e=[],i=!0,o=!1,a=void 0;try{for(var r,s=t[Symbol.iterator]();!(i=(r=s.next()).done)&&(e.push(r.value),!n||e.length!==n);i=!0);}catch(t){o=!0,a=t}finally{try{!i&&s.return&&s.return()}finally{if(o)throw a}}return e}(t,n);throw new TypeError("Invalid attempt to destructure non-iterable instance")}}(),A=function t(n,e){c(this,t);var i=function(t){this.activated&&(this.activated=!1)};n.setEventEnabled(!0),n.on("pointerdown",function(t){if(t.stopPropagation(),!(t.data.originalEvent.touches&&t.data.originalEvent.touches.length>1)){var e=t.data.getLocalPosition(this.parent),i=e.x,o=e.y;this.activated=!0,this.lastX=i,this.lastY=o,this.lastGlobalX=n.x,this.lastGlobalY=n.y,n.activate()}}),n.on("pointermove",function(t){if(!(t.data.originalEvent.touches&&t.data.originalEvent.touches.length>1)&&e){var n=t.data.getLocalPosition(this.parent),i=n.x,o=n.y;!this.activated||this.lastX===i&&this.lastY===o||(e.inScreen&&(i=Math.max(0,Math.min(Tiny.WIN_SIZE.width,i)),o=Math.max(0,Math.min(Tiny.WIN_SIZE.height,o))),this.setPosition(this.lastGlobalX+(i-this.lastX),this.lastGlobalY+(o-this.lastY)))}}),n.on("pointerup",i),n.on("pointercancel",i),n.on("pointerupoutside",i)},v=function t(){c(this,t)};v.getInstance=function(t){var n=t.width,e=t.height,i=t.thickness,o=t.color,a=t.lineOpacity,r=t.fill,s=t.fillOpacity,c=new Tiny.Graphics;return c.$property=t,c.beginFill(r,s),c.lineStyle(i,o,a),c.drawRect(-n/2,-e/2,n,e),c.endFill(),c};var p=function(t,n){return Math.sqrt(t*t+n*n)};function g(){}var y={};var b=f(a.zoom,3),T=b[0],m=b[1],E=b[2],w=function(t){function n(){return c(this,n),u(this,(n.__proto__||Object.getPrototypeOf(n)).apply(this,arguments))}return l(n,t),h(n,[{key:"$bindEvent",value:function(t){var n=t.targetWidth,e=t.targetHeight,i=t.spriteContainer,o=t.widgetContainer,r=t.$icons,s=this.minScale,c=this.maxScale,h=p(n,e),l=function(t){this.activated&&(this.activated=!1)};this.setEventEnabled(!0),this.on("pointerdown",function(t){t.stopPropagation();var n=t.data.getLocalPosition(this.parent),e=n.x,i=n.y;this.activated=!0,this.lastX=e,this.lastY=i}),this.on("pointermove",function(t){if(!(t.data.originalEvent.touches&&t.data.originalEvent.touches.length>1)&&this.activated){var l=t.data.getLocalPosition(this.parent),u=l.x,A=l.y,g=u-this.lastX,b=A-this.lastY,T=Math.atan2(b,g),m=p(g,b)/h*2,E=i.scale.x;if(T>0){var w=E+m;if(w>=c)return;i.setScale(w)}else{var P=E-m;if(P<=s)return;i.setScale(P)}var S=i.scale.x,O=o.getChildAt(0);o.removeChild(O),o.addChildAt(v.getInstance(d({},O.$property,{width:-n*S,height:-e*S})),0),function(t,n,e){var i=d({},y,a);for(var o in i){var r=f(i[o],3),s=r[1],c=r[2];t[o]&&t[o].setPosition(n*s,e*c)}}(r,n/2*S,e/2*S),this.lastX=u,this.lastY=A}}),this.on("pointerup",l),this.on("pointercancel",l),this.on("pointerupoutside",l)}}]),n}(Tiny.Sprite);w.getInstance=function(t,n){var e=t.targetWidth,i=t.targetHeight,o=t.$icons,a=n.sprite,r=void 0===a?T:a,s=n.minScale,c=n.maxScale,h=r;return Tiny.isString(h)&&(h=Tiny.Texture.fromImage(h)),h instanceof Tiny.Texture&&(h=new w(h)),o.zoom=h,h.setAnchor(.5),h.setPosition(e/2*m,i/2*E),h.minScale=s,h.maxScale=c,h.$bindEvent(t),h};var P=f(a.rotate,3),S=P[0],O=P[1],I=P[2],C=function(t){function n(){return c(this,n),u(this,(n.__proto__||Object.getPrototypeOf(n)).apply(this,arguments))}return l(n,t),h(n,[{key:"$bindEvent",value:function(t){var n=t.target,e=t.widgetContainer,i=t.spriteContainer,o=this.fitness,a=function(t){this.activated&&(this.activated=!1,this.startAngle=Tiny.radian2deg(this.lastRadian||0))};this.setEventEnabled(!0),this.on("pointerdown",function(n){n.stopPropagation();var e=n.data.getLocalPosition(o?t:this.parent),i=e.x,a=e.y;this.activated=!0,this.lastX=i,this.lastY=a,this.startAngle=Tiny.radian2deg(this.lastRadian||0)}),this.on("pointermove",function(a){if(!(a.data.originalEvent.touches&&a.data.originalEvent.touches.length>1)&&this.activated){var r,s,c,h,d,l,u=a.data.getLocalPosition(o?t:this.parent),f=u.x,A=u.y,v=(r=this.lastX,s=this.lastY,d=r*(c=f)+s*(h=A),l=r*h-s*c,(Math.atan2(l,d)/Math.PI*180+360)%360),p=function(t){return t>=360?t-=360:t<0&&(t+=360),t>356||t<4?t=0:t>86&&t<94?t=90:t>176&&t<184?t=180:t>266&&t<274&&(t=270),t}(Math.round(this.startAngle+v)),g=Tiny.deg2radian(p);o?(e.setRotation(g),i.setRotation(g)):n.setRotation(g),this.lastRadian=g}}),this.on("pointerup",a),this.on("pointercancel",a),this.on("pointerupoutside",a)}}]),n}(Tiny.Sprite);C.getInstance=function(t,n){var e=t.targetWidth,i=t.targetHeight,o=t.$icons,a=n.sprite,r=void 0===a?S:a,s=n.fitness,c=r;return Tiny.isString(c)&&(c=Tiny.Texture.fromImage(c)),c instanceof Tiny.Texture&&(c=new C(c)),o.rotate=c,c.setAnchor(.5),c.setPosition(e/2*O,i/2*I),c.fitness=s,c.$bindEvent(t),c};var U=f(a.remove,3),x=U[0],j=U[1],M=U[2],R=function(t){function n(){return c(this,n),u(this,(n.__proto__||Object.getPrototypeOf(n)).apply(this,arguments))}return l(n,t),h(n,[{key:"$bindEvent",value:function(t){this.setEventEnabled(!0),this.on("pointerdown",function(t){t.stopPropagation()}),this.on("pointerup",function(n){t.emit("remove:touchend",n)})}}]),n}(Tiny.Sprite);R.getInstance=function(t,n){var e=t.targetWidth,i=t.targetHeight,o=t.$icons,a=n.sprite,r=void 0===a?x:a;return Tiny.isString(r)&&(r=Tiny.Texture.fromImage(r)),r instanceof Tiny.Texture&&(r=new R(r)),o.remove=r,r.setAnchor(.5),r.setPosition(e/2*j,i/2*M),r.$bindEvent(t),r};var H=f(a.flipx,3),z=H[0],X=H[1],Y=H[2],B=function(t){function n(){return c(this,n),u(this,(n.__proto__||Object.getPrototypeOf(n)).apply(this,arguments))}return l(n,t),h(n,[{key:"$bindEvent",value:function(t){var n=t.target;this.setEventEnabled(!0),this.on("pointerdown",function(t){t.stopPropagation()}),this.on("pointerup",function(e){n.scale.x*=-1,t.emit("flipx:touchend",e)})}}]),n}(Tiny.Sprite);B.getInstance=function(t,n){var e=t.targetWidth,i=t.targetHeight,o=t.$icons,a=n.sprite,r=void 0===a?z:a;return Tiny.isString(r)&&(r=Tiny.Texture.fromImage(r)),r instanceof Tiny.Texture&&(r=new B(r)),o.flipx=r,r.setAnchor(.5),r.setPosition(e/2*X,i/2*Y),r.$bindEvent(t),r};var G=f(a.flipy,3),k=G[0],J=G[1],L=G[2],q=function(t){function n(){return c(this,n),u(this,(n.__proto__||Object.getPrototypeOf(n)).apply(this,arguments))}return l(n,t),h(n,[{key:"$bindEvent",value:function(t){var n=t.target;this.setEventEnabled(!0),this.on("pointerdown",function(t){t.stopPropagation()}),this.on("pointerup",function(e){n.scale.y*=-1,t.emit("flipy:touchend",e)})}}]),n}(Tiny.Sprite);q.getInstance=function(t,n){var e=t.targetWidth,i=t.targetHeight,o=t.$icons,a=n.sprite,r=void 0===a?k:a;return Tiny.isString(r)&&(r=Tiny.Texture.fromImage(r)),r instanceof Tiny.Texture&&(r=new q(r)),o.flipy=r,r.setAnchor(.5),r.setPosition(e/2*J,i/2*L),r.$bindEvent(t),r};var N=function(t){function n(){return c(this,n),u(this,(n.__proto__||Object.getPrototypeOf(n)).apply(this,arguments))}return l(n,t),h(n,[{key:"$bindEvent",value:function(t){this.setEventEnabled(!0),this.on("pointerdown",t.onTouchStart||g),this.on("pointermove",t.onTouchMove||g),this.on("pointerup",t.onTouchEnd||g),this.on("pointercancel",t.onTouchCancel||g),this.on("pointerupoutside",t.onTouchCancel||g)}}]),n}(Tiny.Sprite);N.getInstance=function(t,n){var e=t.targetWidth,i=t.targetHeight,o=t.$icons,a=n.sprite,r=n.name,s=n.pos,c=n.listeners,h=f(s,2),d=h[0],l=h[1],u=a;return Tiny.isString(u)&&(u=Tiny.Texture.fromImage(u)),u instanceof Tiny.Texture&&(u=new N(u)),o[r]=u,y[r]=[a].concat(function(t){if(Array.isArray(t)){for(var n=0,e=Array(t.length);n<t.length;n++)e[n]=t[n];return e}return Array.from(t)}(s)),u.setAnchor(.5),u.setPosition(e/2*d,i/2*l),u.$bindEvent(c),u};var D=function(t){function n(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};c(this,n);var i=u(this,(n.__proto__||Object.getPrototypeOf(n)).call(this)),o=e.frame,a=void 0===o?{}:o,s=e.drag,h=void 0===s?{}:s,l=e.zoom,f=void 0===l?{}:l,p=e.rotation,g=void 0===p?{}:p,y=e.remove,b=void 0===y?{}:y,T=e.flipx,m=void 0===T?{}:T,E=e.flipy,P=void 0===E?{}:E,S=t.getBounds(),O=S.width,I=S.height;return i.$fixedIndex=!1,i.$icons={},i.target=t,i.spriteContainer=new Tiny.Container,i.widgetContainer=new Tiny.Container,t.setAnchor(.5),i.targetWidth=O,i.targetHeight=I,i.deactivate(),i.addChild(i.spriteContainer),i.addChild(i.widgetContainer),i.spriteContainer.addChild(t),i.widgetContainer.addChild(v.getInstance(d({width:O,height:I},r,a))),new A(i,h),f&&i.widgetContainer.addChild(w.getInstance(i,d({minScale:.5,maxScale:1.5},f))),g&&i.widgetContainer.addChild(C.getInstance(i,d({},g,{fitness:d({},r,a).fitness}))),b&&i.widgetContainer.addChild(R.getInstance(i,d({},b))),m&&i.widgetContainer.addChild(B.getInstance(i,d({},m))),!m&&P&&i.widgetContainer.addChild(q.getInstance(i,d({},P))),n.instancesPoll.push(i),i.on("removed",function(){Tiny.arrayRemoveObject(n.instancesPoll,i)}),i.on("added",function(){var t=i.parent,n=function(t){for(var n in i.$icons)i.$icons[n].activated=!1};t.on("pointerup",n),t.on("pointerout",n),t.on("pointercancel",n),t.on("pointerupoutside",n)}),i}return l(n,t),h(n,[{key:"activate",value:function(){for(var t in n.deactivateAll(),this.widgetContainer.renderable=!0,this.$fixedIndex||this.parent.setChildIndex(this,this.parent.children.length-1),this.$icons)this.$icons[t].setEventEnabled(!0)}},{key:"deactivate",value:function(){for(var t in this.widgetContainer.renderable=!1,this.$icons)this.$icons[t].setEventEnabled(!1)}},{key:"fixedIndex",value:function(t){this.$fixedIndex=t}},{key:"addWidget",value:function(t,n){var e=arguments.length>2&&void 0!==arguments[2]?arguments[2]:[1,1],i=arguments.length>3&&void 0!==arguments[3]?arguments[3]:{};this.widgetContainer.addChild(N.getInstance(this,{name:t,sprite:n,pos:e,listeners:i}))}}]),n}(Tiny.Container);return D.instancesPoll=[],D.deactivateAll=function(){D.instancesPoll.forEach(function(t){t.deactivate()})},D.constants=s,D});
