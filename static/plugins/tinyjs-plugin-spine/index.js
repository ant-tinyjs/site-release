/*!
 * Name: tinyjs-plugin-spine
 * Description: Spine implementation for TinyJS
 * Author: yiiqii
 * Version: v1.0.2
 */
!function(t,e){"object"==typeof exports&&"undefined"!=typeof module?e(exports):"function"==typeof define&&define.amd?define(["exports"],e):e((t.Tiny=t.Tiny||{},t.Tiny.spine={}))}(this,function(t){"use strict";var e=function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")},r=function(){function t(t,e){for(var r=0;r<e.length;r++){var n=e[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,n.key,n)}}return function(e,r,n){return r&&t(e.prototype,r),n&&t(e,n),e}}(),n=function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function, not "+typeof e);t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,enumerable:!1,writable:!0,configurable:!0}}),e&&(Object.setPrototypeOf?Object.setPrototypeOf(t,e):t.__proto__=e)},a=function(t,e){if(!t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!e||"object"!=typeof e&&"function"!=typeof e?t:e},i=function(){return function(t,e){if(Array.isArray(t))return t;if(Symbol.iterator in Object(t))return function(t,e){var r=[],n=!0,a=!1,i=void 0;try{for(var s,o=t[Symbol.iterator]();!(n=(s=o.next()).done)&&(r.push(s.value),!e||r.length!==e);n=!0);}catch(t){a=!0,i=t}finally{try{!n&&o.return&&o.return()}finally{if(a)throw i}}return r}(t,e);throw new TypeError("Invalid attempt to destructure non-iterable instance")}}(),s=function(){function t(){var r=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,a=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0,i=arguments.length>3&&void 0!==arguments[3]?arguments[3]:0;e(this,t),this.r=r,this.g=n,this.b=a,this.a=i}return r(t,[{key:"set",value:function(t,e,r,n){return this.r=t,this.g=e,this.b=r,this.a=n,this.clamp(),this}},{key:"setFromColor",value:function(t){return this.r=t.r,this.g=t.g,this.b=t.b,this.a=t.a,this}},{key:"setFromString",value:function(t){return t="#"===t.charAt(0)?t.substr(1):t,this.r=parseInt(t.substr(0,2),16)/255,this.g=parseInt(t.substr(2,2),16)/255,this.b=parseInt(t.substr(4,2),16)/255,this.a=(8!==t.length?255:parseInt(t.substr(6,2),16))/255,this}},{key:"add",value:function(t,e,r,n){return this.r+=t,this.g+=e,this.b+=r,this.a+=n,this.clamp(),this}},{key:"clamp",value:function(){return this.r<0?this.r=0:this.r>1&&(this.r=1),this.g<0?this.g=0:this.g>1&&(this.g=1),this.b<0?this.b=0:this.b>1&&(this.b=1),this.a<0?this.a=0:this.a>1&&(this.a=1),this}}],[{key:"rgba8888ToColor",value:function(t,e){t.r=((4278190080&e)>>>24)/255,t.g=((16711680&e)>>>16)/255,t.b=((65280&e)>>>8)/255,t.a=(255&e)/255}},{key:"rgb888ToColor",value:function(t,e){t.r=((16711680&e)>>>16)/255,t.g=((65280&e)>>>8)/255,t.b=(255&e)/255}}]),t}();s.WHITE=new s(1,1,1,1),s.RED=new s(1,0,0,1),s.GREEN=new s(0,1,0,1),s.BLUE=new s(0,0,1,1),s.MAGENTA=new s(1,0,1,1);var o,l=3.1415927,h=2*l,u=57.29577866666166,c=.01745329277777778;function f(t,e,r){return t<e?e:t>r?r:t}function d(t){return Math.cos(t*c)}function v(t){return Math.sin(t*c)}function m(t){return t>0?1:t<0?-1:0}function g(t,e){return p(t,e,.5*(t+e))}function p(t,e,r){var n=Math.random(),a=e-t;return n<=(r-t)/a?t+Math.sqrt(n*a*(r-t)):e-Math.sqrt((1-n)*a*(e-r))}Math.fround=Math.fround||(o=new Float32Array(1),function(t){return o[0]=t,o[0]});var y=function(){function t(){var r=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;e(this,t),this.x=r,this.y=n}return r(t,[{key:"set",value:function(t,e){return this.x=t,this.y=e,this}},{key:"length",value:function(){var t=this.x,e=this.y;return Math.sqrt(t*t+e*e)}},{key:"normalize",value:function(){var t=this.length();return 0!==t&&(this.x/=t,this.y/=t),this}}]),t}(),x=function(){function t(){var r=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,a=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0;e(this,t),this.x=r,this.y=n,this.z=a}return r(t,[{key:"setFrom",value:function(t){return this.x=t.x,this.y=t.y,this.z=t.z,this}},{key:"set",value:function(t,e,r){return this.x=t,this.y=e,this.z=r,this}},{key:"add",value:function(t){return this.x+=t.x,this.y+=t.y,this.z+=t.z,this}},{key:"sub",value:function(t){return this.x-=t.x,this.y-=t.y,this.z-=t.z,this}},{key:"scale",value:function(t){return this.x*=t,this.y*=t,this.z*=t,this}},{key:"normalize",value:function(){var t=this.length();return 0===t?this:(t=1/t,this.x*=t,this.y*=t,this.z*=t,this)}},{key:"cross",value:function(t){return this.set(this.y*t.z-this.z*t.y,this.z*t.x-this.x*t.z,this.x*t.y-this.y*t.x)}},{key:"dot",value:function(t){return this.x*t.x+this.y*t.y+this.z*t.z}},{key:"length",value:function(){return Math.sqrt(this.x*this.x+this.y*this.y+this.z*this.z)}},{key:"distance",value:function(t){var e=t.x-this.x,r=t.y-this.y,n=t.z-this.z;return Math.sqrt(e*e+r*r+n*n)}}]),t}(),b=function(){function t(r){e(this,t),this.items=[],this.instantiator=r}return r(t,[{key:"obtain",value:function(){return this.items.length>0?this.items.pop():this.instantiator()}},{key:"free",value:function(t){t.reset&&t.reset(),this.items.push(t)}},{key:"freeAll",value:function(t){for(var e=0;e<t.length;e++)t[e].reset&&t[e].reset(),this.items[e]=t[e]}},{key:"clear",value:function(){this.items.length=0}}]),t}(),k=function(){function t(){e(this,t),this.array=[]}return r(t,[{key:"add",value:function(t){var e=this.contains(t);return this.array[0|t]=0|t,!e}},{key:"contains",value:function(t){return void 0!==this.array[0|t]}},{key:"remove",value:function(t){this.array[0|t]=void 0}},{key:"clear",value:function(){this.array.length=0}}]),t}(),w=function(){function t(){e(this,t)}return r(t,[{key:"apply",value:function(t,e,r){return t+(e-t)*this.applyInternal(r)}}]),t}(),T=function(t){function i(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:2;e(this,i);var r=a(this,(i.__proto__||Object.getPrototypeOf(i)).call(this));return r.power=t,r}return n(i,w),r(i,[{key:"applyInternal",value:function(t){return t<=.5?Math.pow(2*t,this.power)/2:Math.pow(2*(t-1),this.power)/(this.power%2==0?-2:2)+1}}]),i}(),E=function(t){function i(){return e(this,i),a(this,(i.__proto__||Object.getPrototypeOf(i)).apply(this,arguments))}return n(i,T),r(i,[{key:"applyInternal",value:function(t){return Math.pow(t-1,this.power)*(this.power%2==0?-1:1)+1}}]),i}(),M="undefined"!=typeof Float32Array;function S(t,e,r,n,a){for(var i=e,s=n;i<e+a;i++,s++)r[s]=t[i]}function _(t,e){var r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0,n=t.length;if(n===e)return t;if(t.length=e,n<e)for(var a=n;a<e;a++)t[a]=r;return t}function I(t,e){var r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0;return t.length>=e?t:_(t,e,r)}function R(t,e){for(var r=new Array(t),n=0;n<t;n++)r[n]=e;return r}function A(t){if(M)return new Float32Array(t);for(var e=new Array(t),r=0;r<e.length;r++)e[r]=0;return e}function C(t){return M?new Float32Array(t):t}function P(t){return M?Math.fround(t):t}function V(t,e){for(var r=0;r<t.length;r++)if(t[r]===e)return!0;return!1}var O={Region:0,BoundingBox:1,Mesh:2,LinkedMesh:3,Path:4,Point:5,Clipping:6},N=function t(r){if(e(this,t),null==r)throw new Error("name cannot be null.");this.name=r},F=function(t){function i(t){e(this,i);var r=a(this,(i.__proto__||Object.getPrototypeOf(i)).call(this,t));return r.id=(65535&i.nextID++)<<11,r.worldVerticesLength=0,r.deformAttachment=r,r}return n(i,N),r(i,[{key:"computeWorldVerticesOld",value:function(t,e){this.computeWorldVertices(t,0,this.worldVerticesLength,e,0,2)}},{key:"computeWorldVertices",value:function(t,e,r,n,a,i){r=a+(r>>1)*i;var s=t.bone.skeleton,o=t.deform,l=this.vertices,h=this.bones;if(null!=h){for(var u=0,c=0,f=0;f<e;f+=2){var d=h[u];u+=d+1,c+=d}var v=s.bones;if(0===o.length)for(var m=a,g=3*c;m<r;m+=i){var p=0,y=0,x=h[u++];for(x+=u;u<x;u++,g+=3){var b=v[h[u]].matrix,k=l[g],w=l[g+1],T=l[g+2];p+=(k*b.a+w*b.c+b.tx)*T,y+=(k*b.b+w*b.d+b.ty)*T}n[m]=p,n[m+1]=y}else for(var E=o,M=a,S=3*c,_=c<<1;M<r;M+=i){var I=0,R=0,A=h[u++];for(A+=u;u<A;u++,S+=3,_+=2){var C=v[h[u]].matrix,P=l[S]+E[_],V=l[S+1]+E[_+1],O=l[S+2];I+=(P*C.a+V*C.c+C.tx)*O,R+=(P*C.b+V*C.d+C.ty)*O}n[M]=I,n[M+1]=R}}else{o.length>0&&(l=o);for(var N=t.bone.matrix,F=N.tx,B=N.ty,L=N.a,Y=N.c,X=N.b,D=N.d,W=e,U=a;U<r;W+=2,U+=i){var G=l[W],q=l[W+1];n[U]=G*L+q*Y+F,n[U+1]=G*X+q*D+B}}}},{key:"copyTo",value:function(t){null!=this.bones?(t.bones=new Array(this.bones.length),S(this.bones,0,t.bones,0,this.bones.length)):t.bones=null,null!=this.vertices?(t.vertices=A(this.vertices.length),S(this.vertices,0,t.vertices,0,this.vertices.length)):t.vertices=null,t.worldVerticesLength=this.worldVerticesLength,t.deformAttachment=this.deformAttachment}}]),i}();F.nextID=0;var B={setup:0,first:1,replace:2,add:3},L={mixIn:0,mixOut:1},Y={rotate:0,translate:1,scale:2,shear:3,attachment:4,color:5,deform:6,event:7,drawOrder:8,ikConstraint:9,transformConstraint:10,pathConstraintPosition:11,pathConstraintSpacing:12,pathConstraintMix:13,twoColor:14},X=function(){function t(r,n,a){if(e(this,t),null==r)throw new Error("name cannot be null.");if(null==n)throw new Error("timelines cannot be null.");this.name=r,this.timelines=n,this.timelineIds=[];for(var i=0;i<n.length;i++)this.timelineIds[n[i].getPropertyId()]=!0;this.duration=a}return r(t,[{key:"hasTimeline",value:function(t){return!0===this.timelineIds[t]}},{key:"apply",value:function(t,e,r,n,a,i,s,o){if(null==t)throw new Error("skeleton cannot be null.");n&&0!==this.duration&&(r%=this.duration,e>0&&(e%=this.duration));for(var l=this.timelines,h=0,u=l.length;h<u;h++)l[h].apply(t,e,r,a,i,s,o)}}],[{key:"binarySearch",value:function(t,e){var r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:1,n=0,a=t.length/r-2;if(0===a)return r;for(var i=a>>>1;;){if(t[(i+1)*r]<=e?n=i+1:a=i,n===a)return(n+1)*r;i=n+a>>>1}}},{key:"linearSearch",value:function(t,e,r){for(var n=0,a=t.length-r;n<=a;n+=r)if(t[n]>e)return n;return-1}}]),t}(),D=function(){function t(r){if(e(this,t),r<=0)throw new Error("frameCount must be > 0: "+r);this.curves=A((r-1)*t.BEZIER_SIZE)}return r(t,[{key:"getFrameCount",value:function(){return this.curves.length/t.BEZIER_SIZE+1}},{key:"setLinear",value:function(e){this.curves[e*t.BEZIER_SIZE]=t.LINEAR}},{key:"setStepped",value:function(e){this.curves[e*t.BEZIER_SIZE]=t.STEPPED}},{key:"getCurveType",value:function(e){var r=e*t.BEZIER_SIZE;if(r===this.curves.length)return t.LINEAR;var n=this.curves[r];return n===t.LINEAR?t.LINEAR:n===t.STEPPED?t.STEPPED:t.BEZIER}},{key:"setCurve",value:function(e,r,n,a,i){var s=.03*(2*-r+a),o=.03*(2*-n+i),l=.006*(3*(r-a)+1),h=.006*(3*(n-i)+1),u=2*s+l,c=2*o+h,f=.3*r+s+.16666667*l,d=.3*n+o+.16666667*h,v=e*t.BEZIER_SIZE,m=this.curves;m[v++]=t.BEZIER;for(var g=f,p=d,y=v+t.BEZIER_SIZE-1;v<y;v+=2)m[v]=g,m[v+1]=p,f+=u,d+=c,u+=l,c+=h,g+=f,p+=d}},{key:"getCurvePercent",value:function(e,r){r=f(r,0,1);var n=this.curves,a=e*t.BEZIER_SIZE,i=n[a];if(i===t.LINEAR)return r;if(i===t.STEPPED)return 0;for(var s=0,o=++a,l=a+t.BEZIER_SIZE-1;a<l;a+=2)if((s=n[a])>=r){var h=void 0,u=void 0;return a===o?(h=0,u=0):(h=n[a-2],u=n[a-1]),u+(n[a+1]-u)*(r-h)/(s-h)}var c=n[a-1];return c+(1-c)*(r-s)/(1-s)}}]),t}();D.LINEAR=0,D.STEPPED=1,D.BEZIER=2,D.BEZIER_SIZE=19;var W=function(t){function i(t){e(this,i);var r=a(this,(i.__proto__||Object.getPrototypeOf(i)).call(this,t));return r.frames=A(t<<1),r}return n(i,D),r(i,[{key:"getPropertyId",value:function(){return(Y.rotate<<24)+this.boneIndex}},{key:"setFrame",value:function(t,e,r){t<<=1,this.frames[t]=e,this.frames[t+i.ROTATION]=r}},{key:"apply",value:function(t,e,r,n,a,s,o){var l=this.frames,h=t.bones[this.boneIndex];if(h.active)if(r<l[0])switch(s){case B.setup:return void(h.rotation=h.data.rotation);case B.first:var u=h.data.rotation-h.rotation;h.rotation+=(u-360*(16384-(16384.499999999996-u/360|0)))*a}else if(r>=l[l.length-i.ENTRIES]){var c=l[l.length+i.PREV_ROTATION];switch(s){case B.setup:h.rotation=h.data.rotation+c*a;break;case B.first:case B.replace:c+=h.data.rotation-h.rotation,c-=360*(16384-(16384.499999999996-c/360|0));case B.add:h.rotation+=c*a}}else{var f=X.binarySearch(l,r,i.ENTRIES),d=l[f+i.PREV_ROTATION],v=l[f],m=l[f+i.PREV_TIME]-v,g=this.getCurvePercent((f>>1)-1,1-(r-v)/m),p=l[f+i.ROTATION]-d;switch(p=d+(p-360*(16384-(16384.499999999996-p/360|0)))*g,s){case B.setup:h.rotation=h.data.rotation+(p-360*(16384-(16384.499999999996-p/360|0)))*a;break;case B.first:case B.replace:p+=h.data.rotation-h.rotation;case B.add:h.rotation+=(p-360*(16384-(16384.499999999996-p/360|0)))*a}}}}]),i}();W.ENTRIES=2,W.PREV_TIME=-2,W.PREV_ROTATION=-1,W.ROTATION=1;var U=function(t){function i(t){e(this,i);var r=a(this,(i.__proto__||Object.getPrototypeOf(i)).call(this,t));return r.frames=A(t*i.ENTRIES),r}return n(i,D),r(i,[{key:"getPropertyId",value:function(){return(Y.translate<<24)+this.boneIndex}},{key:"setFrame",value:function(t,e,r,n){t*=i.ENTRIES,this.frames[t]=e,this.frames[t+i.X]=r,this.frames[t+i.Y]=n}},{key:"apply",value:function(t,e,r,n,a,s,o){var l=this.frames,h=t.bones[this.boneIndex];if(h.active)if(r<l[0])switch(s){case B.setup:return h.x=h.data.x,void(h.y=h.data.y);case B.first:h.x+=(h.data.x-h.x)*a,h.y+=(h.data.y-h.y)*a}else{var u=0,c=0;if(r>=l[l.length-i.ENTRIES])u=l[l.length+i.PREV_X],c=l[l.length+i.PREV_Y];else{var f=X.binarySearch(l,r,i.ENTRIES);u=l[f+i.PREV_X],c=l[f+i.PREV_Y];var d=l[f],v=l[f+i.PREV_TIME]-d,m=this.getCurvePercent(f/i.ENTRIES-1,1-(r-d)/v);u+=(l[f+i.X]-u)*m,c+=(l[f+i.Y]-c)*m}switch(s){case B.setup:h.x=h.data.x+u*a,h.y=h.data.y+c*a;break;case B.first:case B.replace:h.x+=(h.data.x+u-h.x)*a,h.y+=(h.data.y+c-h.y)*a;break;case B.add:h.x+=u*a,h.y+=c*a}}}}]),i}();U.ENTRIES=3,U.PREV_TIME=-3,U.PREV_X=-2,U.PREV_Y=-1,U.X=1,U.Y=2;var G=function(t){function i(t){return e(this,i),a(this,(i.__proto__||Object.getPrototypeOf(i)).call(this,t))}return n(i,U),r(i,[{key:"getPropertyId",value:function(){return(Y.scale<<24)+this.boneIndex}},{key:"apply",value:function(t,e,r,n,a,s,o){var l=this.frames,h=t.bones[this.boneIndex];if(h.active)if(r<l[0])switch(s){case B.setup:return h.scaleX=h.data.scaleX,void(h.scaleY=h.data.scaleY);case B.first:h.scaleX+=(h.data.scaleX-h.scaleX)*a,h.scaleY+=(h.data.scaleY-h.scaleY)*a}else{var u=0,c=0;if(r>=l[l.length-i.ENTRIES])u=l[l.length+i.PREV_X]*h.data.scaleX,c=l[l.length+i.PREV_Y]*h.data.scaleY;else{var f=X.binarySearch(l,r,i.ENTRIES);u=l[f+i.PREV_X],c=l[f+i.PREV_Y];var d=l[f],v=l[f+i.PREV_TIME]-d,g=this.getCurvePercent(f/i.ENTRIES-1,1-(r-d)/v);u=(u+(l[f+i.X]-u)*g)*h.data.scaleX,c=(c+(l[f+i.Y]-c)*g)*h.data.scaleY}if(1===a)s===B.add?(h.scaleX+=u-h.data.scaleX,h.scaleY+=c-h.data.scaleY):(h.scaleX=u,h.scaleY=c);else{var p=0,y=0;if(o===L.mixOut)switch(s){case B.setup:p=h.data.scaleX,y=h.data.scaleY,h.scaleX=p+(Math.abs(u)*m(p)-p)*a,h.scaleY=y+(Math.abs(c)*m(y)-y)*a;break;case B.first:case B.replace:p=h.scaleX,y=h.scaleY,h.scaleX=p+(Math.abs(u)*m(p)-p)*a,h.scaleY=y+(Math.abs(c)*m(y)-y)*a;break;case B.add:p=h.scaleX,y=h.scaleY,h.scaleX=p+(Math.abs(u)*m(p)-h.data.scaleX)*a,h.scaleY=y+(Math.abs(c)*m(y)-h.data.scaleY)*a}else switch(s){case B.setup:p=Math.abs(h.data.scaleX)*m(u),y=Math.abs(h.data.scaleY)*m(c),h.scaleX=p+(u-p)*a,h.scaleY=y+(c-y)*a;break;case B.first:case B.replace:p=Math.abs(h.scaleX)*m(u),y=Math.abs(h.scaleY)*m(c),h.scaleX=p+(u-p)*a,h.scaleY=y+(c-y)*a;break;case B.add:p=m(u),y=m(c),h.scaleX=Math.abs(h.scaleX)*p+(u-Math.abs(h.data.scaleX)*p)*a,h.scaleY=Math.abs(h.scaleY)*y+(c-Math.abs(h.data.scaleY)*y)*a}}}}}]),i}(),q=function(t){function i(t){return e(this,i),a(this,(i.__proto__||Object.getPrototypeOf(i)).call(this,t))}return n(i,U),r(i,[{key:"getPropertyId",value:function(){return(Y.shear<<24)+this.boneIndex}},{key:"apply",value:function(t,e,r,n,a,s,o){var l=this.frames,h=t.bones[this.boneIndex];if(h.active)if(r<l[0])switch(s){case B.setup:return h.shearX=h.data.shearX,void(h.shearY=h.data.shearY);case B.first:h.shearX+=(h.data.shearX-h.shearX)*a,h.shearY+=(h.data.shearY-h.shearY)*a}else{var u=0,c=0;if(r>=l[l.length-i.ENTRIES])u=l[l.length+i.PREV_X],c=l[l.length+i.PREV_Y];else{var f=X.binarySearch(l,r,i.ENTRIES);u=l[f+i.PREV_X],c=l[f+i.PREV_Y];var d=l[f],v=l[f+i.PREV_TIME]-d,m=this.getCurvePercent(f/i.ENTRIES-1,1-(r-d)/v);u+=(l[f+i.X]-u)*m,c+=(l[f+i.Y]-c)*m}switch(s){case B.setup:h.shearX=h.data.shearX+u*a,h.shearY=h.data.shearY+c*a;break;case B.first:case B.replace:h.shearX+=(h.data.shearX+u-h.shearX)*a,h.shearY+=(h.data.shearY+c-h.shearY)*a;break;case B.add:h.shearX+=u*a,h.shearY+=c*a}}}}]),i}(),j=function(t){function i(t){e(this,i);var r=a(this,(i.__proto__||Object.getPrototypeOf(i)).call(this,t));return r.frames=A(t*i.ENTRIES),r}return n(i,D),r(i,[{key:"getPropertyId",value:function(){return(Y.color<<24)+this.slotIndex}},{key:"setFrame",value:function(t,e,r,n,a,s){t*=i.ENTRIES,this.frames[t]=e,this.frames[t+i.R]=r,this.frames[t+i.G]=n,this.frames[t+i.B]=a,this.frames[t+i.A]=s}},{key:"apply",value:function(t,e,r,n,a,s,o){var l=t.slots[this.slotIndex];if(l.bone.active){var h=this.frames;if(r<h[0])switch(s){case B.setup:return void l.color.setFromColor(l.data.color);case B.first:var u=l.color,c=l.data.color;u.add((c.r-u.r)*a,(c.g-u.g)*a,(c.b-u.b)*a,(c.a-u.a)*a)}else{var f=0,d=0,v=0,m=0;if(r>=h[h.length-i.ENTRIES]){var g=h.length;f=h[g+i.PREV_R],d=h[g+i.PREV_G],v=h[g+i.PREV_B],m=h[g+i.PREV_A]}else{var p=X.binarySearch(h,r,i.ENTRIES);f=h[p+i.PREV_R],d=h[p+i.PREV_G],v=h[p+i.PREV_B],m=h[p+i.PREV_A];var y=h[p],x=h[p+i.PREV_TIME]-y,b=this.getCurvePercent(p/i.ENTRIES-1,1-(r-y)/x);f+=(h[p+i.R]-f)*b,d+=(h[p+i.G]-d)*b,v+=(h[p+i.B]-v)*b,m+=(h[p+i.A]-m)*b}if(1===a)l.color.set(f,d,v,m);else{var k=l.color;s===B.setup&&k.setFromColor(l.data.color),k.add((f-k.r)*a,(d-k.g)*a,(v-k.b)*a,(m-k.a)*a)}}}}}]),i}();j.ENTRIES=5,j.PREV_TIME=-5,j.PREV_R=-4,j.PREV_G=-3,j.PREV_B=-2,j.PREV_A=-1,j.R=1,j.G=2,j.B=3,j.A=4;var H=function(t){function i(t){e(this,i);var r=a(this,(i.__proto__||Object.getPrototypeOf(i)).call(this,t));return r.frames=A(t*i.ENTRIES),r}return n(i,D),r(i,[{key:"getPropertyId",value:function(){return(Y.twoColor<<24)+this.slotIndex}},{key:"setFrame",value:function(t,e,r,n,a,s,o,l,h){t*=i.ENTRIES,this.frames[t]=e,this.frames[t+i.R]=r,this.frames[t+i.G]=n,this.frames[t+i.B]=a,this.frames[t+i.A]=s,this.frames[t+i.R2]=o,this.frames[t+i.G2]=l,this.frames[t+i.B2]=h}},{key:"apply",value:function(t,e,r,n,a,s,o){var l=t.slots[this.slotIndex];if(l.bone.active){var h=this.frames;if(r<h[0])switch(s){case B.setup:return l.color.setFromColor(l.data.color),void l.darkColor.setFromColor(l.data.darkColor);case B.first:var u=l.color,c=l.darkColor,f=l.data.color,d=l.data.darkColor;u.add((f.r-u.r)*a,(f.g-u.g)*a,(f.b-u.b)*a,(f.a-u.a)*a),c.add((d.r-c.r)*a,(d.g-c.g)*a,(d.b-c.b)*a,0)}else{var v=0,m=0,g=0,p=0,y=0,x=0,b=0;if(r>=h[h.length-i.ENTRIES]){var k=h.length;v=h[k+i.PREV_R],m=h[k+i.PREV_G],g=h[k+i.PREV_B],p=h[k+i.PREV_A],y=h[k+i.PREV_R2],x=h[k+i.PREV_G2],b=h[k+i.PREV_B2]}else{var w=X.binarySearch(h,r,i.ENTRIES);v=h[w+i.PREV_R],m=h[w+i.PREV_G],g=h[w+i.PREV_B],p=h[w+i.PREV_A],y=h[w+i.PREV_R2],x=h[w+i.PREV_G2],b=h[w+i.PREV_B2];var T=h[w],E=h[w+i.PREV_TIME]-T,M=this.getCurvePercent(w/i.ENTRIES-1,1-(r-T)/E);v+=(h[w+i.R]-v)*M,m+=(h[w+i.G]-m)*M,g+=(h[w+i.B]-g)*M,p+=(h[w+i.A]-p)*M,y+=(h[w+i.R2]-y)*M,x+=(h[w+i.G2]-x)*M,b+=(h[w+i.B2]-b)*M}if(1===a)l.color.set(v,m,g,p),l.darkColor.set(y,x,b,1);else{var S=l.color,_=l.darkColor;s===B.setup&&(S.setFromColor(l.data.color),_.setFromColor(l.data.darkColor)),S.add((v-S.r)*a,(m-S.g)*a,(g-S.b)*a,(p-S.a)*a),_.add((y-_.r)*a,(x-_.g)*a,(b-_.b)*a,0)}}}}}]),i}();H.ENTRIES=8,H.PREV_TIME=-8,H.PREV_R=-7,H.PREV_G=-6,H.PREV_B=-5,H.PREV_A=-4,H.PREV_R2=-3,H.PREV_G2=-2,H.PREV_B2=-1,H.R=1,H.G=2,H.B=3,H.A=4,H.R2=5,H.G2=6,H.B2=7;var z=function(){function t(r){e(this,t),this.frames=A(r),this.attachmentNames=new Array(r)}return r(t,[{key:"getPropertyId",value:function(){return(Y.attachment<<24)+this.slotIndex}},{key:"getFrameCount",value:function(){return this.frames.length}},{key:"setFrame",value:function(t,e,r){this.frames[t]=e,this.attachmentNames[t]=r}},{key:"apply",value:function(t,e,r,n,a,i,s){var o=t.slots[this.slotIndex];if(o.bone.active)if(s!==L.mixOut||i!==B.setup){var l=this.frames;if(r<l[0]){if(i===B.setup||i===B.first){var h=o.data.attachmentName;o.setAttachment(null==h?null:t.getAttachment(this.slotIndex,h))}}else{var u=0;u=r>=l[l.length-1]?l.length-1:X.binarySearch(l,r,1)-1;var c=this.attachmentNames[u];t.slots[this.slotIndex].setAttachment(null==c?null:t.getAttachment(this.slotIndex,c))}}else{var f=o.data.attachmentName;o.setAttachment(null==f?null:t.getAttachment(this.slotIndex,f))}}}]),t}(),Z=null,K=function(t){function i(t){e(this,i);var r=a(this,(i.__proto__||Object.getPrototypeOf(i)).call(this,t));return r.frames=A(t),r.frameVertices=new Array(t),null==Z&&(Z=A(64)),r}return n(i,D),r(i,[{key:"getPropertyId",value:function(){return(Y.deform<<27)+ +this.attachment.id+this.slotIndex}},{key:"setFrame",value:function(t,e,r){this.frames[t]=e,this.frameVertices[t]=r}},{key:"apply",value:function(t,e,r,n,a,i,s){var o=t.slots[this.slotIndex];if(o.bone.active){var l=o.getAttachment();if(l instanceof F&&l.deformAttachment===this.attachment){var h=o.deform;0===h.length&&(i=B.setup);var u=this.frameVertices,c=u[0].length,f=this.frames;if(r<f[0]){var d=l;switch(i){case B.setup:return void(h.length=0);case B.first:if(1===a){h.length=0;break}var v=_(h,c);if(null==d.bones)for(var m=d.vertices,g=0;g<c;g++)v[g]+=(m[g]-v[g])*a;else{a=1-a;for(var p=0;p<c;p++)v[p]*=a}}}else{var y=_(h,c);if(r>=f[f.length-1]){var x=u[f.length-1];if(1===a)if(i===B.add){var b=l;if(null==b.bones)for(var k=b.vertices,w=0;w<c;w++)y[w]+=x[w]-k[w];else for(var T=0;T<c;T++)y[T]+=x[T]}else S(x,0,y,0,c);else switch(i){case B.setup:var E=l;if(null==E.bones)for(var M=E.vertices,I=0;I<c;I++){var R=M[I];y[I]=R+(x[I]-R)*a}else for(var A=0;A<c;A++)y[A]=x[A]*a;break;case B.first:case B.replace:for(var C=0;C<c;C++)y[C]+=(x[C]-y[C])*a;break;case B.add:var P=l;if(null==P.bones)for(var V=P.vertices,O=0;O<c;O++)y[O]+=(x[O]-V[O])*a;else for(var N=0;N<c;N++)y[N]+=x[N]*a}}else{var L=X.binarySearch(f,r),Y=u[L-1],D=u[L],W=f[L],U=this.getCurvePercent(L-1,1-(r-W)/(f[L-1]-W));if(1===a)if(i===B.add){var G=l;if(null==G.bones)for(var q=G.vertices,j=0;j<c;j++){var H=Y[j];y[j]+=H+(D[j]-H)*U-q[j]}else for(var z=0;z<c;z++){var Z=Y[z];y[z]+=Z+(D[z]-Z)*U}}else for(var K=0;K<c;K++){var J=Y[K];y[K]=J+(D[K]-J)*U}else switch(i){case B.setup:var Q=l;if(null==Q.bones)for(var $=Q.vertices,tt=0;tt<c;tt++){var et=Y[tt],rt=$[tt];y[tt]=rt+(et+(D[tt]-et)*U-rt)*a}else for(var nt=0;nt<c;nt++){var at=Y[nt];y[nt]=(at+(D[nt]-at)*U)*a}break;case B.first:case B.replace:for(var it=0;it<c;it++){var st=Y[it];y[it]+=(st+(D[it]-st)*U-y[it])*a}break;case B.add:var ot=l;if(null==ot.bones)for(var lt=ot.vertices,ht=0;ht<c;ht++){var ut=Y[ht];y[ht]+=(ut+(D[ht]-ut)*U-lt[ht])*a}else for(var ct=0;ct<c;ct++){var ft=Y[ct];y[ct]+=(ft+(D[ct]-ft)*U)*a}}}}}}}}]),i}(),J=function(){function t(r){e(this,t),this.frames=A(r),this.events=new Array(r)}return r(t,[{key:"getPropertyId",value:function(){return Y.event<<24}},{key:"getFrameCount",value:function(){return this.frames.length}},{key:"setFrame",value:function(t,e){this.frames[t]=e.time,this.events[t]=e}},{key:"apply",value:function(t,e,r,n,a,i,s){if(null!=n){var o=this.frames,l=this.frames.length;if(e>r)this.apply(t,e,Number.MAX_VALUE,n,a,i,s),e=-1;else if(e>=o[l-1])return;if(!(r<o[0])){var h=0;if(e<o[0])h=0;else for(var u=o[h=X.binarySearch(o,e)];h>0&&o[h-1]===u;)h--;for(;h<l&&r>=o[h];h++)n.push(this.events[h])}}}}]),t}(),Q=function(){function t(r){e(this,t),this.frames=A(r),this.drawOrders=new Array(r)}return r(t,[{key:"getPropertyId",value:function(){return Y.drawOrder<<24}},{key:"getFrameCount",value:function(){return this.frames.length}},{key:"setFrame",value:function(t,e,r){this.frames[t]=e,this.drawOrders[t]=r}},{key:"apply",value:function(t,e,r,n,a,i,s){var o=t.drawOrder,l=t.slots;if(s!==L.mixOut||i!==B.setup){var h=this.frames;if(r<h[0])i!==B.setup&&i!==B.first||S(t.slots,0,t.drawOrder,0,t.slots.length);else{var u=0;u=r>=h[h.length-1]?h.length-1:X.binarySearch(h,r)-1;var c=this.drawOrders[u];if(null==c)S(l,0,o,0,l.length);else for(var f=0,d=c.length;f<d;f++)o[f]=l[c[f]]}}else S(t.slots,0,t.drawOrder,0,t.slots.length)}}]),t}(),$=function(t){function i(t){e(this,i);var r=a(this,(i.__proto__||Object.getPrototypeOf(i)).call(this,t));return r.frames=A(t*i.ENTRIES),r}return n(i,D),r(i,[{key:"getPropertyId",value:function(){return(Y.ikConstraint<<24)+this.ikConstraintIndex}},{key:"setFrame",value:function(t,e,r,n,a,s,o){t*=i.ENTRIES,this.frames[t]=e,this.frames[t+i.MIX]=r,this.frames[t+i.SOFTNESS]=n,this.frames[t+i.BEND_DIRECTION]=a,this.frames[t+i.COMPRESS]=s?1:0,this.frames[t+i.STRETCH]=o?1:0}},{key:"apply",value:function(t,e,r,n,a,s,o){var l=this.frames,h=t.ikConstraints[this.ikConstraintIndex];if(h.active)if(r<l[0])switch(s){case B.setup:return h.mix=h.data.mix,h.softness=h.data.softness,h.bendDirection=h.data.bendDirection,h.compress=h.data.compress,void(h.stretch=h.data.stretch);case B.first:h.mix+=(h.data.mix-h.mix)*a,h.softness+=(h.data.softness-h.softness)*a,h.bendDirection=h.data.bendDirection,h.compress=h.data.compress,h.stretch=h.data.stretch}else if(r>=l[l.length-i.ENTRIES])s===B.setup?(h.mix=h.data.mix+(l[l.length+i.PREV_MIX]-h.data.mix)*a,h.softness=h.data.softness+(l[l.length+i.PREV_SOFTNESS]-h.data.softness)*a,o===L.mixOut?(h.bendDirection=h.data.bendDirection,h.compress=h.data.compress,h.stretch=h.data.stretch):(h.bendDirection=l[l.length+i.PREV_BEND_DIRECTION],h.compress=0!==l[l.length+i.PREV_COMPRESS],h.stretch=0!==l[l.length+i.PREV_STRETCH])):(h.mix+=(l[l.length+i.PREV_MIX]-h.mix)*a,h.softness+=(l[l.length+i.PREV_SOFTNESS]-h.softness)*a,o===L.mixIn&&(h.bendDirection=l[l.length+i.PREV_BEND_DIRECTION],h.compress=0!==l[l.length+i.PREV_COMPRESS],h.stretch=0!==l[l.length+i.PREV_STRETCH]));else{var u=X.binarySearch(l,r,i.ENTRIES),c=l[u+i.PREV_MIX],f=l[u+i.PREV_SOFTNESS],d=l[u],v=l[u+i.PREV_TIME]-d,m=this.getCurvePercent(u/i.ENTRIES-1,1-(r-d)/v);s===B.setup?(h.mix=h.data.mix+(c+(l[u+i.MIX]-c)*m-h.data.mix)*a,h.softness=h.data.softness+(f+(l[u+i.SOFTNESS]-f)*m-h.data.softness)*a,o===L.mixOut?(h.bendDirection=h.data.bendDirection,h.compress=h.data.compress,h.stretch=h.data.stretch):(h.bendDirection=l[u+i.PREV_BEND_DIRECTION],h.compress=0!==l[u+i.PREV_COMPRESS],h.stretch=0!==l[u+i.PREV_STRETCH])):(h.mix+=(c+(l[u+i.MIX]-c)*m-h.mix)*a,h.softness+=(f+(l[u+i.SOFTNESS]-f)*m-h.softness)*a,o===L.mixIn&&(h.bendDirection=l[u+i.PREV_BEND_DIRECTION],h.compress=0!==l[u+i.PREV_COMPRESS],h.stretch=0!==l[u+i.PREV_STRETCH]))}}}]),i}();$.ENTRIES=6,$.PREV_TIME=-6,$.PREV_MIX=-5,$.PREV_SOFTNESS=-4,$.PREV_BEND_DIRECTION=-3,$.PREV_COMPRESS=-2,$.PREV_STRETCH=-1,$.MIX=1,$.SOFTNESS=2,$.BEND_DIRECTION=3,$.COMPRESS=4,$.STRETCH=5;var tt=function(t){function i(t){e(this,i);var r=a(this,(i.__proto__||Object.getPrototypeOf(i)).call(this,t));return r.frames=A(t*i.ENTRIES),r}return n(i,D),r(i,[{key:"getPropertyId",value:function(){return(Y.transformConstraint<<24)+this.transformConstraintIndex}},{key:"setFrame",value:function(t,e,r,n,a,s){t*=i.ENTRIES,this.frames[t]=e,this.frames[t+i.ROTATE]=r,this.frames[t+i.TRANSLATE]=n,this.frames[t+i.SCALE]=a,this.frames[t+i.SHEAR]=s}},{key:"apply",value:function(t,e,r,n,a,s,o){var l=this.frames,h=t.transformConstraints[this.transformConstraintIndex];if(h.active)if(r<l[0]){var u=h.data;switch(s){case B.setup:return h.rotateMix=u.rotateMix,h.translateMix=u.translateMix,h.scaleMix=u.scaleMix,void(h.shearMix=u.shearMix);case B.first:h.rotateMix+=(u.rotateMix-h.rotateMix)*a,h.translateMix+=(u.translateMix-h.translateMix)*a,h.scaleMix+=(u.scaleMix-h.scaleMix)*a,h.shearMix+=(u.shearMix-h.shearMix)*a}}else{var c=0,f=0,d=0,v=0;if(r>=l[l.length-i.ENTRIES]){var m=l.length;c=l[m+i.PREV_ROTATE],f=l[m+i.PREV_TRANSLATE],d=l[m+i.PREV_SCALE],v=l[m+i.PREV_SHEAR]}else{var g=X.binarySearch(l,r,i.ENTRIES);c=l[g+i.PREV_ROTATE],f=l[g+i.PREV_TRANSLATE],d=l[g+i.PREV_SCALE],v=l[g+i.PREV_SHEAR];var p=l[g],y=l[g+i.PREV_TIME]-p,x=this.getCurvePercent(g/i.ENTRIES-1,1-(r-p)/y);c+=(l[g+i.ROTATE]-c)*x,f+=(l[g+i.TRANSLATE]-f)*x,d+=(l[g+i.SCALE]-d)*x,v+=(l[g+i.SHEAR]-v)*x}if(s===B.setup){var b=h.data;h.rotateMix=b.rotateMix+(c-b.rotateMix)*a,h.translateMix=b.translateMix+(f-b.translateMix)*a,h.scaleMix=b.scaleMix+(d-b.scaleMix)*a,h.shearMix=b.shearMix+(v-b.shearMix)*a}else h.rotateMix+=(c-h.rotateMix)*a,h.translateMix+=(f-h.translateMix)*a,h.scaleMix+=(d-h.scaleMix)*a,h.shearMix+=(v-h.shearMix)*a}}}]),i}();tt.ENTRIES=5,tt.PREV_TIME=-5,tt.PREV_ROTATE=-4,tt.PREV_TRANSLATE=-3,tt.PREV_SCALE=-2,tt.PREV_SHEAR=-1,tt.ROTATE=1,tt.TRANSLATE=2,tt.SCALE=3,tt.SHEAR=4;var et=function(t){function i(t){e(this,i);var r=a(this,(i.__proto__||Object.getPrototypeOf(i)).call(this,t));return r.frames=A(t*i.ENTRIES),r}return n(i,D),r(i,[{key:"getPropertyId",value:function(){return(Y.pathConstraintPosition<<24)+this.pathConstraintIndex}},{key:"setFrame",value:function(t,e,r){t*=i.ENTRIES,this.frames[t]=e,this.frames[t+i.VALUE]=r}},{key:"apply",value:function(t,e,r,n,a,s,o){var l=this.frames,h=t.pathConstraints[this.pathConstraintIndex];if(h.active)if(r<l[0])switch(s){case B.setup:return void(h.position=h.data.position);case B.first:h.position+=(h.data.position-h.position)*a}else{var u=0;if(r>=l[l.length-i.ENTRIES])u=l[l.length+i.PREV_VALUE];else{var c=X.binarySearch(l,r,i.ENTRIES);u=l[c+i.PREV_VALUE];var f=l[c],d=l[c+i.PREV_TIME]-f,v=this.getCurvePercent(c/i.ENTRIES-1,1-(r-f)/d);u+=(l[c+i.VALUE]-u)*v}s===B.setup?h.position=h.data.position+(u-h.data.position)*a:h.position+=(u-h.position)*a}}}]),i}();et.ENTRIES=2,et.PREV_TIME=-2,et.PREV_VALUE=-1,et.VALUE=1;var rt=function(t){function i(t){return e(this,i),a(this,(i.__proto__||Object.getPrototypeOf(i)).call(this,t))}return n(i,et),r(i,[{key:"getPropertyId",value:function(){return(Y.pathConstraintSpacing<<24)+this.pathConstraintIndex}},{key:"apply",value:function(t,e,r,n,a,s,o){var l=this.frames,h=t.pathConstraints[this.pathConstraintIndex];if(h.active)if(r<l[0])switch(s){case B.setup:return void(h.spacing=h.data.spacing);case B.first:h.spacing+=(h.data.spacing-h.spacing)*a}else{var u=0;if(r>=l[l.length-i.ENTRIES])u=l[l.length+i.PREV_VALUE];else{var c=X.binarySearch(l,r,i.ENTRIES);u=l[c+i.PREV_VALUE];var f=l[c],d=l[c+i.PREV_TIME]-f,v=this.getCurvePercent(c/i.ENTRIES-1,1-(r-f)/d);u+=(l[c+i.VALUE]-u)*v}s===B.setup?h.spacing=h.data.spacing+(u-h.data.spacing)*a:h.spacing+=(u-h.spacing)*a}}}]),i}(),nt=function(t){function i(t){e(this,i);var r=a(this,(i.__proto__||Object.getPrototypeOf(i)).call(this,t));return r.frames=A(t*i.ENTRIES),r}return n(i,D),r(i,[{key:"getPropertyId",value:function(){return(Y.pathConstraintMix<<24)+this.pathConstraintIndex}},{key:"setFrame",value:function(t,e,r,n){t*=i.ENTRIES,this.frames[t]=e,this.frames[t+i.ROTATE]=r,this.frames[t+i.TRANSLATE]=n}},{key:"apply",value:function(t,e,r,n,a,s,o){var l=this.frames,h=t.pathConstraints[this.pathConstraintIndex];if(h.active)if(r<l[0])switch(s){case B.setup:return h.rotateMix=h.data.rotateMix,void(h.translateMix=h.data.translateMix);case B.first:h.rotateMix+=(h.data.rotateMix-h.rotateMix)*a,h.translateMix+=(h.data.translateMix-h.translateMix)*a}else{var u=0,c=0;if(r>=l[l.length-i.ENTRIES])u=l[l.length+i.PREV_ROTATE],c=l[l.length+i.PREV_TRANSLATE];else{var f=X.binarySearch(l,r,i.ENTRIES);u=l[f+i.PREV_ROTATE],c=l[f+i.PREV_TRANSLATE];var d=l[f],v=l[f+i.PREV_TIME]-d,m=this.getCurvePercent(f/i.ENTRIES-1,1-(r-d)/v);u+=(l[f+i.ROTATE]-u)*m,c+=(l[f+i.TRANSLATE]-c)*m}s===B.setup?(h.rotateMix=h.data.rotateMix+(u-h.data.rotateMix)*a,h.translateMix=h.data.translateMix+(c-h.data.translateMix)*a):(h.rotateMix+=(u-h.rotateMix)*a,h.translateMix+=(c-h.translateMix)*a)}}}]),i}();nt.ENTRIES=3,nt.PREV_TIME=-3,nt.PREV_ROTATE=-2,nt.PREV_TRANSLATE=-1,nt.ROTATE=1,nt.TRANSLATE=2;var at={start:0,interrupt:1,end:2,dispose:3,complete:4,event:5},it=function(){function t(r){e(this,t),this.tracks=[],this.timeScale=1,this.events=[],this.listeners=[],this.queue=new ot(this),this.propertyIDs=new k,this.animationsChanged=!1,this.trackEntryPool=new b(function(){return new st}),this.data=r}return r(t,[{key:"update",value:function(t){t*=this.timeScale;for(var e=this.tracks,r=0,n=e.length;r<n;r++){var a=e[r];if(null!=a){a.animationLast=a.nextAnimationLast,a.trackLast=a.nextTrackLast;var i=t*a.timeScale;if(a.delay>0){if(a.delay-=i,a.delay>0)continue;i=-a.delay,a.delay=0}var s=a.next;if(null!=s){var o=a.trackLast-s.delay;if(o>=0){for(s.delay=0,s.trackTime+=0===a.timeScale?0:(o/a.timeScale+t)*s.timeScale,a.trackTime+=i,this.setCurrent(r,s,!0);null!=s.mixingFrom;)s.mixTime+=t,s=s.mixingFrom;continue}}else if(a.trackLast>=a.trackEnd&&null==a.mixingFrom){e[r]=null,this.queue.end(a),this.disposeNext(a);continue}if(null!=a.mixingFrom&&this.updateMixingFrom(a,t)){var l=a.mixingFrom;for(a.mixingFrom=null,null!=l&&(l.mixingTo=null);null!=l;)this.queue.end(l),l=l.mixingFrom}a.trackTime+=i}}this.queue.drain()}},{key:"updateMixingFrom",value:function(t,e){var r=t.mixingFrom;if(null==r)return!0;var n=this.updateMixingFrom(r,e);return r.animationLast=r.nextAnimationLast,r.trackLast=r.nextTrackLast,t.mixTime>0&&t.mixTime>=t.mixDuration?(0!==r.totalAlpha&&0!==t.mixDuration||(t.mixingFrom=r.mixingFrom,null!=r.mixingFrom&&(r.mixingFrom.mixingTo=t),t.interruptAlpha=r.interruptAlpha,this.queue.end(r)),n):(r.trackTime+=e*r.timeScale,t.mixTime+=e,!1)}},{key:"apply",value:function(e){if(null==e)throw new Error("skeleton cannot be null.");this.animationsChanged&&this._animationsChanged();for(var r=this.events,n=this.tracks,a=!1,i=0,s=n.length;i<s;i++){var o=n[i];if(!(null==o||o.delay>0)){a=!0;var l=0===i?B.first:o.mixBlend,h=o.alpha;null!=o.mixingFrom?h*=this.applyMixingFrom(o,e,l):o.trackTime>=o.trackEnd&&null==o.next&&(h=0);var u=o.animationLast,c=o.getAnimationTime(),f=o.animation.timelines.length,d=o.animation.timelines;if(0===i&&1===h||l===B.add)for(var v=0;v<f;v++)d[v].apply(e,u,c,r,h,l,L.mixIn);else{var m=o.timelineMode,g=0===o.timelinesRotation.length;g&&_(o.timelinesRotation,f<<1,null);for(var p=o.timelinesRotation,y=0;y<f;y++){var x=d[y],b=(m[y]&t.NOT_LAST-1)===t.SUBSEQUENT?l:B.setup;x instanceof W?this.applyRotateTimeline(x,e,c,h,b,p,y<<1,g):x.apply(e,u,c,r,h,b,L.mixIn)}}this.queueEvents(o,c),r.length=0,o.nextAnimationLast=c,o.nextTrackLast=o.trackTime}}return this.queue.drain(),a}},{key:"applyMixingFrom",value:function(e,r,n){var a=e.mixingFrom;null!=a.mixingFrom&&this.applyMixingFrom(a,r,n);var i=0;0===e.mixDuration?(i=1,n===B.first&&(n=B.setup)):((i=e.mixTime/e.mixDuration)>1&&(i=1),n!==B.first&&(n=a.mixBlend));var s=i<a.eventThreshold?this.events:null,o=i<a.attachmentThreshold,l=i<a.drawOrderThreshold,h=a.animationLast,u=a.getAnimationTime(),c=a.animation.timelines.length,f=a.animation.timelines,d=a.alpha*e.interruptAlpha,v=d*(1-i);if(n===B.add)for(var m=0;m<c;m++)f[m].apply(r,h,u,s,v,n,L.mixOut);else{var g=a.timelineMode,p=a.timelineHoldMix,y=0===a.timelinesRotation.length;y&&_(a.timelinesRotation,c<<1,null);var x=a.timelinesRotation;a.totalAlpha=0;for(var b=0;b<c;b++){var k=f[b],w=L.mixOut,T=void 0,E=0;switch(g[b]&t.NOT_LAST-1){case t.SUBSEQUENT:if(T=n,!o&&k instanceof z){if((g[b]&t.NOT_LAST)===t.NOT_LAST)continue;T=B.setup}if(!l&&k instanceof Q)continue;E=v;break;case t.FIRST:T=B.setup,E=v;break;case t.HOLD:T=B.setup,E=d;break;default:T=B.setup;var M=p[b];E=d*Math.max(0,1-M.mixTime/M.mixDuration)}a.totalAlpha+=E,k instanceof W?this.applyRotateTimeline(k,r,u,E,T,x,b<<1,y):(T===B.setup&&(k instanceof z?(o||(g[b]&t.NOT_LAST)===t.NOT_LAST)&&(w=L.mixIn):k instanceof Q&&l&&(w=L.mixIn)),k.apply(r,h,u,s,E,T,w))}}return e.mixDuration>0&&this.queueEvents(a,u),this.events.length=0,a.nextAnimationLast=u,a.nextTrackLast=a.trackTime,i}},{key:"applyRotateTimeline",value:function(t,e,r,n,a,i,s,o){if(o&&(i[s]=0),1!==n){var l=t,h=l.frames,u=e.bones[l.boneIndex];if(u.active){var c=0,f=0;if(r<h[0])switch(a){case B.setup:u.rotation=u.data.rotation;default:return;case B.first:c=u.rotation,f=u.data.rotation}else if(c=a===B.setup?u.data.rotation:u.rotation,r>=h[h.length-W.ENTRIES])f=u.data.rotation+h[h.length+W.PREV_ROTATION];else{var d=X.binarySearch(h,r,W.ENTRIES),v=h[d+W.PREV_ROTATION],g=h[d],p=h[d+W.PREV_TIME]-g,y=l.getCurvePercent((d>>1)-1,1-(r-g)/p);f=h[d+W.ROTATION]-v,f=v+(f-=360*(16384-(16384.499999999996-f/360|0)))*y+u.data.rotation,f-=360*(16384-(16384.499999999996-f/360|0))}var x=0,b=f-c;if(0===(b-=360*(16384-(16384.499999999996-b/360|0))))x=i[s];else{var k=0,w=0;o?(k=0,w=b):(k=i[s],w=i[s+1]);var T=b>0,E=k>=0;m(w)!==m(b)&&Math.abs(w)<=90&&(Math.abs(k)>180&&(k+=360*m(k)),E=T),x=b+k-k%360,E!==T&&(x+=360*m(k)),i[s]=x}i[s+1]=b,c+=x*n,u.rotation=c-360*(16384-(16384.499999999996-c/360|0))}}else t.apply(e,0,r,null,1,a,L.mixIn)}},{key:"queueEvents",value:function(t,e){for(var r=t.animationStart,n=t.animationEnd,a=n-r,i=t.trackLast%a,s=this.events,o=0,l=s.length;o<l;o++){var h=s[o];if(h.time<i)break;h.time>n||this.queue.event(t,h)}for((t.loop?0===a||i>t.trackTime%a:e>=n&&t.animationLast<n)&&this.queue.complete(t);o<l;o++){s[o].time<r||this.queue.event(t,s[o])}}},{key:"clearTracks",value:function(){var t=this.queue.drainDisabled;this.queue.drainDisabled=!0;for(var e=0,r=this.tracks.length;e<r;e++)this.clearTrack(e);this.tracks.length=0,this.queue.drainDisabled=t,this.queue.drain()}},{key:"clearTrack",value:function(t){if(!(t>=this.tracks.length)){var e=this.tracks[t];if(null!=e){this.queue.end(e),this.disposeNext(e);for(var r=e;;){var n=r.mixingFrom;if(null==n)break;this.queue.end(n),r.mixingFrom=null,r.mixingTo=null,r=n}this.tracks[e.trackIndex]=null,this.queue.drain()}}}},{key:"setCurrent",value:function(t,e,r){var n=this.expandToIndex(t);this.tracks[t]=e,null!=n&&(r&&this.queue.interrupt(n),e.mixingFrom=n,n.mixingTo=e,e.mixTime=0,null!=n.mixingFrom&&n.mixDuration>0&&(e.interruptAlpha*=Math.min(1,n.mixTime/n.mixDuration)),n.timelinesRotation.length=0),this.queue.start(e)}},{key:"setAnimation",value:function(t,e,r){var n=this.data.skeletonData.findAnimation(e);if(null==n)throw new Error("Animation not found: "+e);return this.setAnimationWith(t,n,r)}},{key:"setAnimationWith",value:function(t,e,r){if(null==e)throw new Error("animation cannot be null.");var n=!0,a=this.expandToIndex(t);null!=a&&(-1===a.nextTrackLast?(this.tracks[t]=a.mixingFrom,this.queue.interrupt(a),this.queue.end(a),this.disposeNext(a),a=a.mixingFrom,n=!1):this.disposeNext(a));var i=this.trackEntry(t,e,r,a);return this.setCurrent(t,i,n),this.queue.drain(),i}},{key:"addAnimation",value:function(t,e,r,n){var a=this.data.skeletonData.findAnimation(e);if(null==a)throw new Error("Animation not found: "+e);return this.addAnimationWith(t,a,r,n)}},{key:"addAnimationWith",value:function(t,e,r,n){if(null==e)throw new Error("animation cannot be null.");var a=this.expandToIndex(t);if(null!=a)for(;null!=a.next;)a=a.next;var i=this.trackEntry(t,e,r,a);if(null==a)this.setCurrent(t,i,!0),this.queue.drain();else if(a.next=i,n<=0){var s=a.animationEnd-a.animationStart;0!==s?(a.loop?n+=s*(1+(a.trackTime/s|0)):n+=Math.max(s,a.trackTime),n-=this.data.getMix(a.animation,e)):n=a.trackTime}return i.delay=n,i}},{key:"setEmptyAnimation",value:function(e,r){var n=this.setAnimationWith(e,t.emptyAnimation,!1);return n.mixDuration=r,n.trackEnd=r,n}},{key:"addEmptyAnimation",value:function(e,r,n){n<=0&&(n-=r);var a=this.addAnimationWith(e,t.emptyAnimation,!1,n);return a.mixDuration=r,a.trackEnd=r,a}},{key:"setEmptyAnimations",value:function(t){var e=this.queue.drainDisabled;this.queue.drainDisabled=!0;for(var r=0,n=this.tracks.length;r<n;r++){var a=this.tracks[r];null!=a&&this.setEmptyAnimation(a.trackIndex,t)}this.queue.drainDisabled=e,this.queue.drain()}},{key:"expandToIndex",value:function(t){return t<this.tracks.length?this.tracks[t]:(I(this.tracks,t+1,null),this.tracks.length=t+1,null)}},{key:"trackEntry",value:function(t,e,r,n){var a=this.trackEntryPool.obtain();return a.trackIndex=t,a.animation=e,a.loop=r,a.holdPrevious=!1,a.eventThreshold=0,a.attachmentThreshold=0,a.drawOrderThreshold=0,a.animationStart=0,a.animationEnd=e.duration,a.animationLast=-1,a.nextAnimationLast=-1,a.delay=0,a.trackTime=0,a.trackLast=-1,a.nextTrackLast=-1,a.trackEnd=Number.MAX_VALUE,a.timeScale=1,a.alpha=1,a.interruptAlpha=1,a.mixTime=0,a.mixDuration=null==n?0:this.data.getMix(n.animation,e),a.mixBlend=B.replace,a}},{key:"disposeNext",value:function(t){for(var e=t.next;null!=e;)this.queue.dispose(e),e=e.next;t.next=null}},{key:"_animationsChanged",value:function(){this.animationsChanged=!1,this.propertyIDs.clear();for(var t=0,e=this.tracks.length;t<e;t++){var r=this.tracks[t];if(null!=r){for(;null!=r.mixingFrom;)r=r.mixingFrom;do{null!=r.mixingFrom&&r.mixBlend===B.add||this.computeHold(r),r=r.mixingTo}while(null!=r)}}this.propertyIDs.clear();for(var n=this.tracks.length-1;n>=0;n--)for(var a=this.tracks[n];null!=a;)this.computeNotLast(a),a=a.mixingFrom}},{key:"computeHold",value:function(e){var r=e.mixingTo,n=e.animation.timelines,a=e.animation.timelines.length,i=_(e.timelineMode,a);e.timelineHoldMix.length=0;var s=_(e.timelineHoldMix,a),o=this.propertyIDs;if(null!=r&&r.holdPrevious)for(var l=0;l<a;l++)o.add(n[l].getPropertyId()),i[l]=t.HOLD;else t:for(var h=0;h<a;h++){var u=n[h],c=u.getPropertyId();if(o.add(c))if(null==r||u instanceof z||u instanceof Q||u instanceof J||!r.animation.hasTimeline(c))i[h]=t.FIRST;else{for(var f=r.mixingTo;null!=f;f=f.mixingTo)if(!f.animation.hasTimeline(c)){if(e.mixDuration>0){i[h]=t.HOLD_MIX,s[h]=f;continue t}break}i[h]=t.HOLD}else i[h]=t.SUBSEQUENT}}},{key:"computeNotLast",value:function(e){for(var r=e.animation.timelines,n=e.animation.timelines.length,a=e.timelineMode,i=this.propertyIDs,s=0;s<n;s++)if(r[s]instanceof z){var o=r[s];i.add(o.slotIndex)||(a[s]|=t.NOT_LAST)}}},{key:"getCurrent",value:function(t){return t>=this.tracks.length?null:this.tracks[t]}},{key:"addListener",value:function(t){if(null==t)throw new Error("listener cannot be null.");this.listeners.push(t)}},{key:"removeListener",value:function(t){var e=this.listeners.indexOf(t);e>=0&&this.listeners.splice(e,1)}},{key:"clearListeners",value:function(){this.listeners.length=0}},{key:"clearListenerNotifications",value:function(){this.queue.clear()}},{key:"hasAnimation",value:function(t){return null!==this.data.skeletonData.findAnimation(t)}}]),t}();it.emptyAnimation=new X("<empty>",[],0),it.SUBSEQUENT=0,it.FIRST=1,it.HOLD=2,it.HOLD_MIX=3,it.NOT_LAST=4;var st=function(){function t(){e(this,t),this.mixBlend=B.replace,this.timelineMode=[],this.timelineHoldMix=[],this.timelinesRotation=[]}return r(t,[{key:"reset",value:function(){this.next=null,this.mixingFrom=null,this.mixingTo=null,this.animation=null,this.listener=null,this.timelineMode.length=0,this.timelineHoldMix.length=0,this.timelinesRotation.length=0}},{key:"getAnimationTime",value:function(){if(this.loop){var t=this.animationEnd-this.animationStart;return 0===t?this.animationStart:this.trackTime%t+this.animationStart}return Math.min(this.trackTime+this.animationStart,this.animationEnd)}},{key:"setAnimationLast",value:function(t){this.animationLast=t,this.nextAnimationLast=t}},{key:"isComplete",value:function(){return this.trackTime>=this.animationEnd-this.animationStart}},{key:"resetRotationDirections",value:function(){this.timelinesRotation.length=0}},{key:"loopsCount",value:function(){return Math.floor(this.trackTime/this.trackEnd)}}]),t}(),ot=function(){function t(r){e(this,t),this.objects=[],this.drainDisabled=!1,this.animState=r}return r(t,[{key:"start",value:function(t){this.objects.push(at.start),this.objects.push(t),this.animState.animationsChanged=!0}},{key:"interrupt",value:function(t){this.objects.push(at.interrupt),this.objects.push(t)}},{key:"end",value:function(t){this.objects.push(at.end),this.objects.push(t),this.animState.animationsChanged=!0}},{key:"dispose",value:function(t){this.objects.push(at.dispose),this.objects.push(t)}},{key:"complete",value:function(t){this.objects.push(at.complete),this.objects.push(t)}},{key:"event",value:function(t,e){this.objects.push(at.event),this.objects.push(t),this.objects.push(e)}},{key:"drain",value:function(){if(!this.drainDisabled){this.drainDisabled=!0;for(var t=this.objects,e=this.animState.listeners,r=0;r<t.length;r+=2){var n=t[r],a=t[r+1];switch(n){case at.start:null!=a.listener&&a.listener.start&&a.listener.start(a);for(var i=0;i<e.length;i++)e[i].start&&e[i].start(a);break;case at.interrupt:null!=a.listener&&a.listener.interrupt&&a.listener.interrupt(a);for(var s=0;s<e.length;s++)e[s].interrupt&&e[s].interrupt(a);break;case at.end:null!=a.listener&&a.listener.end&&a.listener.end(a);for(var o=0;o<e.length;o++)e[o].end&&e[o].end(a);case at.dispose:null!=a.listener&&a.listener.dispose&&a.listener.dispose(a);for(var l=0;l<e.length;l++)e[l].dispose&&e[l].dispose(a);this.animState.trackEntryPool.free(a);break;case at.complete:null!=a.listener&&a.listener.complete&&a.listener.complete(a);for(var h=0;h<e.length;h++)e[h].complete&&e[h].complete(a);break;case at.event:var u=t[2+r++];null!=a.listener&&a.listener.event&&a.listener.event(a,u);for(var c=0;c<e.length;c++)e[c].event&&e[c].event(a,u)}}this.clear(),this.drainDisabled=!1}}},{key:"clear",value:function(){this.objects.length=0}}]),t}(),lt=function(){function t(r){if(e(this,t),this.animationToMixTime={},this.defaultMix=0,null==r)throw new Error("skeletonData cannot be null.");this.skeletonData=r}return r(t,[{key:"setMix",value:function(t,e,r){var n=this.skeletonData.findAnimation(t);if(null==n)throw new Error("Animation not found: "+t);var a=this.skeletonData.findAnimation(e);if(null==a)throw new Error("Animation not found: "+e);this.setMixWith(n,a,r)}},{key:"setMixWith",value:function(t,e,r){if(null==t)throw new Error("from cannot be null.");if(null==e)throw new Error("to cannot be null.");var n=t.name+"."+e.name;this.animationToMixTime[n]=r}},{key:"getMix",value:function(t,e){var r=t.name+"."+e.name,n=this.animationToMixTime[r];return void 0===n?this.defaultMix:n}}]),t}(),ht=function(t){function i(t){e(this,i);var r=a(this,(i.__proto__||Object.getPrototypeOf(i)).call(this,t));return r.x=0,r.y=0,r.scaleX=1,r.scaleY=1,r.rotation=0,r.width=0,r.height=0,r.color=new s(1,1,1,1),r.offset=A(8),r.uvs=A(8),r.tempColor=new s(1,1,1,1),r}return n(i,N),r(i,[{key:"updateOffset",value:function(){var t=this.width/this.region.originalWidth*this.scaleX,e=this.height/this.region.originalHeight*this.scaleY,r=-this.width/2*this.scaleX+this.region.offsetX*t,n=-this.height/2*this.scaleY+this.region.offsetY*e,a=r+this.region.width*t,s=n+this.region.height*e,o=this.rotation*Math.PI/180,l=Math.cos(o),h=Math.sin(o),u=r*l+this.x,c=r*h,f=n*l+this.y,d=n*h,v=a*l+this.x,m=a*h,g=s*l+this.y,p=s*h,y=this.offset;y[i.OX1]=u-d,y[i.OY1]=f+c,y[i.OX2]=u-p,y[i.OY2]=g+c,y[i.OX3]=v-p,y[i.OY3]=g+m,y[i.OX4]=v-d,y[i.OY4]=f+m}},{key:"setRegion",value:function(t){this.region=t;var e=this.uvs;t.rotate?(e[2]=t.u,e[3]=t.v2,e[4]=t.u,e[5]=t.v,e[6]=t.u2,e[7]=t.v,e[0]=t.u2,e[1]=t.v2):(e[0]=t.u,e[1]=t.v2,e[2]=t.u,e[3]=t.v,e[4]=t.u2,e[5]=t.v,e[6]=t.u2,e[7]=t.v2)}},{key:"computeWorldVertices",value:function(t,e,r,n){var a=this.offset,s=t.matrix,o=s.tx,l=s.ty,h=s.a,u=s.c,c=s.b,f=s.d,d=0,v=0;d=a[i.OX1],v=a[i.OY1],e[r]=d*h+v*u+o,e[r+1]=d*c+v*f+l,r+=n,d=a[i.OX2],v=a[i.OY2],e[r]=d*h+v*u+o,e[r+1]=d*c+v*f+l,r+=n,d=a[i.OX3],v=a[i.OY3],e[r]=d*h+v*u+o,e[r+1]=d*c+v*f+l,r+=n,d=a[i.OX4],v=a[i.OY4],e[r]=d*h+v*u+o,e[r+1]=d*c+v*f+l}},{key:"copy",value:function(){var t=new i(name);return t.region=this.region,t.rendererObject=this.rendererObject,t.path=this.path,t.x=this.x,t.y=this.y,t.scaleX=this.scaleX,t.scaleY=this.scaleY,t.rotation=this.rotation,t.width=this.width,t.height=this.height,S(this.uvs,0,t.uvs,0,8),S(this.offset,0,t.offset,0,8),t.color.setFromColor(this.color),t}}]),i}();ht.OX1=0,ht.OY1=1,ht.OX2=2,ht.OY2=3,ht.OX3=4,ht.OY3=5,ht.OX4=6,ht.OY4=7,ht.X1=0,ht.Y1=1,ht.C1R=2,ht.C1G=3,ht.C1B=4,ht.C1A=5,ht.U1=6,ht.V1=7,ht.X2=8,ht.Y2=9,ht.C2R=10,ht.C2G=11,ht.C2B=12,ht.C2A=13,ht.U2=14,ht.V2=15,ht.X3=16,ht.Y3=17,ht.C3R=18,ht.C3G=19,ht.C3B=20,ht.C3A=21,ht.U3=22,ht.V3=23,ht.X4=24,ht.Y4=25,ht.C4R=26,ht.C4G=27,ht.C4B=28,ht.C4A=29,ht.U4=30,ht.V4=31;var ut=function(t){function i(t){e(this,i);var r=a(this,(i.__proto__||Object.getPrototypeOf(i)).call(this,t));return r.color=new s(1,1,1,1),r.tempColor=new s(0,0,0,0),r}return n(i,F),r(i,[{key:"updateUVs",value:function(t,e){var r=this.regionUVs.length;if(e&&e.length===r||(e=A(r)),null!=t){for(var n=t.texture._uvs,a=t.width,i=t.height,s=t.originalWidth,o=t.originalHeight,l=t.offsetX,h=t.tinyOffsetY,u=0;u<r;u+=2){var c=this.regionUVs[u],f=this.regionUVs[u+1];c=(c*s-l)/a,f=(f*o-h)/i,e[u]=(n.x0*(1-c)+n.x1*c)*(1-f)+(n.x3*(1-c)+n.x2*c)*f,e[u+1]=(n.y0*(1-c)+n.y1*c)*(1-f)+(n.y3*(1-c)+n.y2*c)*f}return e}}},{key:"getParentMesh",value:function(){return this.parentMesh}},{key:"setParentMesh",value:function(t){this.parentMesh=t,null!=t&&(this.bones=t.bones,this.vertices=t.vertices,this.regionUVs=t.regionUVs,this.triangles=t.triangles,this.hullLength=t.hullLength,this.worldVerticesLength=t.worldVerticesLength)}},{key:"copy",value:function(){if(null!=this.parentMesh)return this.newLinkedMesh();var t=new i(this.name);return t.region=this.region,t.path=this.path,t.color.setFromColor(this.color),this.copyTo(t),t.regionUVs=new Float32Array(this.regionUVs.length),S(this.regionUVs,0,t.regionUVs,0,this.regionUVs.length),t.uvs=new Array(this.uvs.length),S(this.uvs,0,t.uvs,0,this.uvs.length),t.triangles=new Array(this.triangles.length),S(this.triangles,0,t.triangles,0,this.triangles.length),t.hullLength=this.hullLength,null!=this.edges&&(t.edges=new Array(this.edges.length),S(this.edges,0,t.edges,0,this.edges.length)),t.width=this.width,t.height=this.height,t}},{key:"newLinkedMesh",value:function(){var t=new i(this.name);return t.region=this.region,t.path=this.path,t.color.setFromColor(this.color),t.deformAttachment=this.deformAttachment,t.setParentMesh(null!=this.parentMesh?this.parentMesh:this),t}}]),i}(),ct=function(t){function i(t){e(this,i);var r=a(this,(i.__proto__||Object.getPrototypeOf(i)).call(this,t));return r.color=new s(1,1,1,1),r}return n(i,F),r(i,[{key:"copy",value:function(){var t=new i(name);return this.copyTo(t),t.color.setFromColor(this.color),t}}]),i}(),ft=function(t){function i(t){e(this,i);var r=a(this,(i.__proto__||Object.getPrototypeOf(i)).call(this,t));return r.closed=!1,r.constantSpeed=!1,r.color=new s(1,1,1,1),r}return n(i,F),r(i,[{key:"copy",value:function(){var t=new i(name);return this.copyTo(t),t.lengths=new Array(this.lengths.length),S(this.lengths,0,t.lengths,0,this.lengths.length),t.closed=closed,t.constantSpeed=this.constantSpeed,t.color.setFromColor(this.color),t}}]),i}(),dt=function(t){function i(t){e(this,i);var r=a(this,(i.__proto__||Object.getPrototypeOf(i)).call(this,t));return r.color=new s(.38,.94,0,1),r}return n(i,F),r(i,[{key:"computeWorldPosition",value:function(t,e){var r=t.matrix;return e.x=this.x*r.a+this.y*r.c+t.worldX,e.y=this.x*r.b+this.y*r.d+t.worldY,e}},{key:"computeWorldRotation",value:function(t){var e=t.matrix,r=d(this.rotation),n=v(this.rotation),a=r*e.a+n*e.c,i=r*e.b+n*e.d;return Math.atan2(i,a)*u}},{key:"copy",value:function(){var t=new i(name);return t.x=this.x,t.y=this.y,t.rotation=this.rotation,t.color.setFromColor(this.color),t}}]),i}(),vt=function(t){function i(t){e(this,i);var r=a(this,(i.__proto__||Object.getPrototypeOf(i)).call(this,t));return r.color=new s(.2275,.2275,.8078,1),r}return n(i,F),r(i,[{key:"copy",value:function(){var t=new i(name);return this.copyTo(t),t.endSlot=this.endSlot,t.color.setFromColor(this.color),t}}]),i}(),mt=function(){function t(r){e(this,t),this.atlas=r}return r(t,[{key:"newRegionAttachment",value:function(t,e,r){var n=this.atlas.findRegion(r);if(null==n)throw new Error("Region not found in atlas: "+r+" (region attachment: "+e+")");var a=new ht(e);return a.region=n,a}},{key:"newMeshAttachment",value:function(t,e,r){var n=this.atlas.findRegion(r);if(null==n)throw new Error("Region not found in atlas: "+r+" (mesh attachment: "+e+")");var a=new ut(e);return a.region=n,a}},{key:"newBoundingBoxAttachment",value:function(t,e){return new ct(e)}},{key:"newPathAttachment",value:function(t,e){return new ft(e)}},{key:"newPointAttachment",value:function(t,e){return new dt(e)}},{key:"newClippingAttachment",value:function(t,e){return new vt(e)}}]),t}(),gt={Normal:0,Additive:1,Multiply:2,Screen:3},pt={Normal:0,OnlyTranslation:1,NoRotationOrReflection:2,NoScale:3,NoScaleOrReflection:4},yt=function t(r,n,a){if(e(this,t),this.x=0,this.y=0,this.rotation=0,this.scaleX=1,this.scaleY=1,this.shearX=0,this.shearY=0,this.transformMode=pt.Normal,this.skinRequired=!1,this.color=new s,r<0)throw new Error("index must be >= 0.");if(null==n)throw new Error("name cannot be null.");this.index=r,this.name=n,this.parent=a},xt=function(){function t(r,n,a){if(e(this,t),this.matrix=new Tiny.Matrix,this.children=[],this.x=0,this.y=0,this.rotation=0,this.scaleX=0,this.scaleY=0,this.shearX=0,this.shearY=0,this.ax=0,this.ay=0,this.arotation=0,this.ascaleX=0,this.ascaleY=0,this.ashearX=0,this.ashearY=0,this.appliedValid=!1,this.sorted=!1,this.active=!1,null==r)throw new Error("data cannot be null.");if(null==n)throw new Error("skeleton cannot be null.");this.data=r,this.skeleton=n,this.parent=a,this.setToSetupPose()}return r(t,[{key:"isActive",value:function(){return this.active}},{key:"update",value:function(){this.updateWorldTransformWith(this.x,this.y,this.rotation,this.scaleX,this.scaleY,this.shearX,this.shearY)}},{key:"updateWorldTransform",value:function(){this.updateWorldTransformWith(this.x,this.y,this.rotation,this.scaleX,this.scaleY,this.shearX,this.shearY)}},{key:"updateWorldTransformWith",value:function(e,r,n,a,i,s,o){this.ax=e,this.ay=r,this.arotation=n,this.ascaleX=a,this.ascaleY=i,this.ashearX=s,this.ashearY=o,this.appliedValid=!0;var l=this.parent,h=this.matrix,c=this.skeleton.scaleX,f=t.yDown?-this.skeleton.scaleY:this.skeleton.scaleY;if(null==l){var m=this.skeleton,g=n+90+o;return h.a=d(n+s)*a*c,h.c=d(g)*i*c,h.b=v(n+s)*a*f,h.d=v(g)*i*f,h.tx=e*c+m.x,void(h.ty=r*f+m.y)}var p=l.matrix.a,y=l.matrix.c,x=l.matrix.b,b=l.matrix.d;switch(h.tx=p*e+y*r+l.matrix.tx,h.ty=x*e+b*r+l.matrix.ty,this.data.transformMode){case pt.Normal:var k=n+90+o,w=d(n+s)*a,T=d(k)*i,E=v(n+s)*a,M=v(k)*i;return h.a=p*w+y*E,h.c=p*T+y*M,h.b=x*w+b*E,void(h.d=x*T+b*M);case pt.OnlyTranslation:var S=n+90+o;h.a=d(n+s)*a,h.c=d(S)*i,h.b=v(n+s)*a,h.d=v(S)*i;break;case pt.NoRotationOrReflection:var _=p*p+x*x,I=0;_>1e-4?(y=x*(_=Math.abs(p*b-y*x)/_),b=p*_,I=Math.atan2(x,p)*u):(p=0,x=0,I=90-Math.atan2(b,y)*u);var R=n+s-I,A=n+o-I+90,C=d(R)*a,P=d(A)*i,V=v(R)*a,O=v(A)*i;h.a=p*C-y*V,h.c=p*P-y*O,h.b=x*C+b*V,h.d=x*P+b*O;break;case pt.NoScale:case pt.NoScaleOrReflection:var N=d(n),F=v(n),B=(p*N+y*F)/c,L=(x*N+b*F)/f,Y=Math.sqrt(B*B+L*L);Y>1e-5&&(Y=1/Y),B*=Y,L*=Y,Y=Math.sqrt(B*B+L*L),this.data.transformMode===pt.NoScale&&p*b-y*x<0!=(t.yDown?this.skeleton.scaleX<0!=this.skeleton.scaleY>0:this.skeleton.scaleX<0!=this.skeleton.scaleY<0)&&(Y=-Y);var X=Math.PI/2+Math.atan2(L,B),D=Math.cos(X)*Y,W=Math.sin(X)*Y,U=d(s)*a,G=d(90+o)*i,q=v(s)*a,j=v(90+o)*i;h.a=B*U+D*q,h.c=B*G+D*j,h.b=L*U+W*q,h.d=L*G+W*j}h.a*=c,h.c*=c,h.b*=f,h.d*=f}},{key:"setToSetupPose",value:function(){var t=this.data;this.x=t.x,this.y=t.y,this.rotation=t.rotation,this.scaleX=t.scaleX,this.scaleY=t.scaleY,this.shearX=t.shearX,this.shearY=t.shearY}},{key:"getWorldRotationX",value:function(){return Math.atan2(this.matrix.b,this.matrix.a)*u}},{key:"getWorldRotationY",value:function(){return Math.atan2(this.matrix.d,this.matrix.c)*u}},{key:"getWorldScaleX",value:function(){var t=this.matrix;return Math.sqrt(t.a*t.a+t.c*t.c)}},{key:"getWorldScaleY",value:function(){var t=this.matrix;return Math.sqrt(t.b*t.b+t.d*t.d)}},{key:"updateAppliedTransform",value:function(){this.appliedValid=!0;var t=this.parent,e=this.matrix;if(null==t)return this.ax=e.tx,this.ay=e.ty,this.arotation=Math.atan2(e.b,e.a)*u,this.ascaleX=Math.sqrt(e.a*e.a+e.b*e.b),this.ascaleY=Math.sqrt(e.c*e.c+e.d*e.d),this.ashearX=0,void(this.ashearY=Math.atan2(e.a*e.c+e.b*e.d,e.a*e.d-e.b*e.c)*u);var r=t.matrix,n=1/(r.a*r.d-r.b*r.c),a=e.tx-r.tx,i=e.ty-r.ty;this.ax=a*r.d*n-i*r.c*n,this.ay=i*r.a*n-a*r.b*n;var s=n*r.d,o=n*r.a,l=n*r.c,h=n*r.b,c=s*e.a-l*e.b,f=s*e.c-l*e.d,d=o*e.b-h*e.a,v=o*e.d-h*e.c;if(this.ashearX=0,this.ascaleX=Math.sqrt(c*c+d*d),this.ascaleX>1e-4){var m=c*v-f*d;this.ascaleY=m/this.ascaleX,this.ashearY=Math.atan2(c*f+d*v,m)*u,this.arotation=Math.atan2(d,c)*u}else this.ascaleX=0,this.ascaleY=Math.sqrt(f*f+v*v),this.ashearY=0,this.arotation=90-Math.atan2(v,f)*u}},{key:"worldToLocal",value:function(t){var e=this.matrix,r=e.a,n=e.c,a=e.b,i=e.d,s=1/(r*i-n*a),o=t.x-e.tx,l=t.y-e.ty;return t.x=o*i*s-l*n*s,t.y=l*r*s-o*a*s,t}},{key:"localToWorld",value:function(t){var e=this.matrix,r=t.x,n=t.y;return t.x=r*e.a+n*e.c+e.tx,t.y=r*e.b+n*e.d+e.ty,t}},{key:"worldToLocalRotation",value:function(t){var e=v(t),r=d(t),n=this.matrix;return Math.atan2(n.a*e-n.b*r,n.d*r-n.c*e)*u+this.rotation-this.shearX}},{key:"localToWorldRotation",value:function(t){var e=v(t),r=d(t),n=this.matrix;return Math.atan2(r*n.b+e*n.d,r*n.a+e*n.c)*u}},{key:"rotateWorld",value:function(t){var e=this.matrix,r=e.a,n=e.c,a=e.b,i=e.d,s=d(t),o=v(t);e.a=s*r-o*a,e.c=s*n-o*i,e.b=o*r+s*a,e.d=o*n+s*i,this.appliedValid=!1}},{key:"worldX",get:function(){return this.matrix.tx}},{key:"worldY",get:function(){return this.matrix.ty}}]),t}();xt.yDown=!1;var bt=function t(r,n,a){e(this,t),this.name=r,this.order=n,this.skinRequired=a},kt=function t(r,n){if(e(this,t),null==n)throw new Error("data cannot be null.");this.time=r,this.data=n},wt=function t(r){e(this,t),this.name=r},Tt=function(){function t(r,n){if(e(this,t),this.bendDirection=0,this.compress=!1,this.stretch=!1,this.mix=1,this.softness=0,this.active=!1,null==r)throw new Error("data cannot be null.");if(null==n)throw new Error("skeleton cannot be null.");this.data=r,this.mix=r.mix,this.softness=r.softness,this.bendDirection=r.bendDirection,this.compress=r.compress,this.stretch=r.stretch,this.bones=[];for(var a=0;a<r.bones.length;a++)this.bones.push(n.findBone(r.bones[a].name));this.target=n.findBone(r.target.name)}return r(t,[{key:"isActive",value:function(){return this.active}},{key:"apply",value:function(){this.update()}},{key:"update",value:function(){var t=this.target,e=this.bones;switch(e.length){case 1:this.apply1(e[0],t.worldX,t.worldY,this.compress,this.stretch,this.data.uniform,this.mix);break;case 2:this.apply2(e[0],e[1],t.worldX,t.worldY,this.bendDirection,this.stretch,this.softness,this.mix)}}},{key:"apply1",value:function(t,e,r,n,a,i,s){t.appliedValid||t.updateAppliedTransform();var o=t.parent.matrix,l=o.a,h=o.c,c=o.b,f=o.d,d=-t.ashearX-t.arotation,v=0,m=0;switch(t.data.transformMode){case pt.OnlyTranslation:v=e-t.worldX,m=r-t.worldY;break;case pt.NoRotationOrReflection:d+=Math.atan2(c,l)*u;var g=Math.abs(l*f-h*c)/(l*l+c*c);h=-c*g,f=l*g;default:var p=e-o.tx,y=r-o.ty,x=l*f-h*c;v=(p*f-y*h)/x-t.ax,m=(y*l-p*c)/x-t.ay}d+=Math.atan2(m,v)*u,t.ascaleX<0&&(d+=180),d>180?d-=360:d<-180&&(d+=360);var b=t.ascaleX,k=t.ascaleY;if(n||a){switch(t.data.transformMode){case pt.NoScale:case pt.NoScaleOrReflection:v=e-t.worldX,m=r-t.worldY}var w=t.data.length*b,T=Math.sqrt(v*v+m*m);if(n&&T<w||a&&T>w&&w>1e-4){var E=(T/w-1)*s+1;b*=E,i&&(k*=E)}}t.updateWorldTransformWith(t.ax,t.ay,t.arotation+d*s,b,k,t.ashearX,t.ashearY)}},{key:"apply2",value:function(t,e,r,n,a,i,s,o){if(0!==o){t.appliedValid||t.updateAppliedTransform(),e.appliedValid||e.updateAppliedTransform();var h=t.ax,c=t.ay,f=t.ascaleX,d=f,v=t.ascaleY,m=e.ascaleX,g=t.matrix,p=0,y=0,x=0;f<0?(f=-f,p=180,x=-1):(p=0,x=1),v<0&&(v=-v,x=-x),m<0?(m=-m,y=180):y=0;var b=e.ax,k=0,w=0,T=0,E=g.a,M=g.c,S=g.b,_=g.d,I=Math.abs(f-v)<=1e-4;I?(w=E*b+M*(k=e.ay)+g.tx,T=S*b+_*k+g.ty):(k=0,w=E*b+g.tx,T=S*b+g.ty);var R=t.parent.matrix;E=R.a,M=R.c,S=R.b;var A=1/(E*(_=R.d)-M*S),C=w-R.tx,P=T-R.ty,V=(C*_-P*M)*A-h,O=(P*E-C*S)*A-c,N=Math.sqrt(V*V+O*O),F=e.data.length*m,B=void 0,L=void 0;if(N<1e-4)return this.apply1(t,r,n,!1,i,!1,o),void e.updateWorldTransformWith(b,k,0,e.ascaleX,e.ascaleY,e.ashearX,e.ashearY);var Y=((C=r-R.tx)*_-(P=n-R.ty)*M)*A-h,X=(P*E-C*S)*A-c,D=Y*Y+X*X;if(0!==s){s*=f*(m+1)/2;var W=Math.sqrt(D),U=W-N-F*f+s;if(U>0){var G=Math.min(1,U/(2*s))-1;D=(Y-=(G=(U-s*(1-G*G))/W)*Y)*Y+(X-=G*X)*X}}t:if(I){var q=(D-N*N-(F*=f)*F)/(2*N*F);q<-1?q=-1:q>1&&(q=1,i&&(d*=(Math.sqrt(D)/(N+F)-1)*o+1)),L=Math.acos(q)*a,E=N+F*q,M=F*Math.sin(L),B=Math.atan2(X*E-Y*M,Y*E+X*M)}else{var j=(E=f*F)*E,H=(M=v*F)*M,z=Math.atan2(X,Y),Z=-2*H*N,K=H-j;if((_=Z*Z-4*K*(S=H*N*N+j*D-j*H))>=0){var J=Math.sqrt(_);Z<0&&(J=-J);var Q=(J=-(Z+J)/2)/K,$=S/J,tt=Math.abs(Q)<Math.abs($)?Q:$;if(tt*tt<=D){P=Math.sqrt(D-tt*tt)*a,B=z-Math.atan2(P,tt),L=Math.atan2(P/v,(tt-N)/f);break t}}var et=l,rt=N-E,nt=rt*rt,at=0,it=0,st=N+E,ot=st*st,lt=0;(S=-E*N/(j-H))>=-1&&S<=1&&(S=Math.acos(S),(_=(C=E*Math.cos(S)+N)*C+(P=M*Math.sin(S))*P)<nt&&(et=S,nt=_,rt=C,at=P),_>ot&&(it=S,ot=_,st=C,lt=P)),D<=(nt+ot)/2?(B=z-Math.atan2(at*a,rt),L=et*a):(B=z-Math.atan2(lt*a,st),L=it*a)}var ht=Math.atan2(k,b)*x,ut=t.arotation;(B=(B-ht)*u+p-ut)>180?B-=360:B<-180&&(B+=360),t.updateWorldTransformWith(h,c,ut+B*o,d,t.ascaleY,0,0),ut=e.arotation,(L=((L+ht)*u-e.ashearX)*x+y-ut)>180?L-=360:L<-180&&(L+=360),e.updateWorldTransformWith(b,k,ut+L*o,e.ascaleX,e.ascaleY,e.ashearX,e.ashearY)}else e.updateWorldTransform()}}]),t}(),Et=function(t){function r(t){e(this,r);var n=a(this,(r.__proto__||Object.getPrototypeOf(r)).call(this,t,0,!1));return n.bones=[],n.bendDirection=1,n.compress=!1,n.stretch=!1,n.uniform=!1,n.mix=1,n.softness=0,n}return n(r,bt),r}(),Mt=function(t){function r(t){e(this,r);var n=a(this,(r.__proto__||Object.getPrototypeOf(r)).call(this,t,0,!1));return n.bones=[],n}return n(r,bt),r}(),St={Fixed:0,Percent:1},_t={Length:0,Fixed:1,Percent:2},It={Tangent:0,Chain:1,ChainScale:2},Rt=function(){function t(r,n){if(e(this,t),this.position=0,this.spacing=0,this.rotateMix=0,this.translateMix=0,this.spaces=[],this.positions=[],this.world=[],this.curves=[],this.lengths=[],this.segments=[],this.active=!1,null==r)throw new Error("data cannot be null.");if(null==n)throw new Error("skeleton cannot be null.");this.data=r,this.bones=[];for(var a=0,i=r.bones.length;a<i;a++)this.bones.push(n.findBone(r.bones[a].name));this.target=n.findSlot(r.target.name),this.position=r.position,this.spacing=r.spacing,this.rotateMix=r.rotateMix,this.translateMix=r.translateMix}return r(t,[{key:"isActive",value:function(){return this.active}},{key:"apply",value:function(){this.update()}},{key:"update",value:function(){var e=this.target.getAttachment();if(e instanceof ft){var r=this.rotateMix,n=this.translateMix,a=r>0;if(n>0||a){var i=this.data,s=i.spacingMode,o=s===_t.Length,u=i.rotateMode,f=u===It.Tangent,d=u===It.ChainScale,v=this.bones.length,m=f?v:v+1,g=this.bones,p=_(this.spaces,m),y=null,x=this.spacing;if(d||o){d&&(y=_(this.lengths,v));for(var b=0,k=m-1;b<k;){var w=g[b],T=w.data.length;if(T<t.epsilon)d&&(y[b]=0),p[++b]=0;else{var E=T*w.matrix.a,M=T*w.matrix.b,S=Math.sqrt(E*E+M*M);d&&(y[b]=S),p[++b]=(o?T+x:x)*S/T}}}else for(var I=1;I<m;I++)p[I]=x;var R=this.computeWorldPositions(e,m,f,i.positionMode===St.Percent,s===_t.Percent),A=R[0],C=R[1],P=i.offsetRotation,V=!1;if(0===P)V=u===It.Chain;else{V=!1;var O=this.target.bone.matrix;P*=O.a*O.d-O.b*O.c>0?c:-c}for(var N=0,F=3;N<v;N++,F+=3){var B=g[N],L=B.matrix;L.tx+=(A-L.tx)*n,L.ty+=(C-L.ty)*n;var Y=R[F],X=R[F+1],D=Y-A,W=X-C;if(d){var U=y[N];if(0!==U){var G=(Math.sqrt(D*D+W*W)/U-1)*r+1;L.a*=G,L.b*=G}}if(A=Y,C=X,a){var q=L.a,j=L.c,H=L.b,z=L.d,Z=0,K=0,J=0;if(Z=f?R[F-1]:0===p[N+1]?R[F+2]:Math.atan2(W,D),Z-=Math.atan2(H,q),V){K=Math.cos(Z),J=Math.sin(Z);var Q=B.data.length;A+=(Q*(K*q-J*H)-D)*r,C+=(Q*(J*q+K*H)-W)*r}else Z+=P;Z>l?Z-=h:Z<-l&&(Z+=h),Z*=r,K=Math.cos(Z),J=Math.sin(Z),L.a=K*q-J*H,L.c=K*j-J*z,L.b=J*q+K*H,L.d=J*j+K*z}B.appliedValid=!1}}}}},{key:"computeWorldPositions",value:function(e,r,n,a,i){var s=this.target,o=this.position,l=this.spaces,h=_(this.positions,3*r+2),u=null,c=e.closed,f=e.worldVerticesLength,d=f/6,v=t.NONE;if(!e.constantSpeed){var m=e.lengths,g=m[d-=c?1:2];if(a&&(o*=g),i)for(var p=0;p<r;p++)l[p]*=g;u=_(this.world,8);for(var y=0,x=0,b=0;y<r;y++,x+=3){var k=l[y],w=o+=k;if(c)(w%=g)<0&&(w+=g),b=0;else{if(w<0){v!==t.BEFORE&&(v=t.BEFORE,e.computeWorldVertices(s,2,4,u,0,2)),this.addBeforePosition(w,u,0,h,x);continue}if(w>g){v!==t.AFTER&&(v=t.AFTER,e.computeWorldVertices(s,f-6,4,u,0,2)),this.addAfterPosition(w-g,u,0,h,x);continue}}for(;;b++){var T=m[b];if(!(w>T)){if(0===b)w/=T;else{var E=m[b-1];w=(w-E)/(T-E)}break}}b!==v&&(v=b,c&&b===d?(e.computeWorldVertices(s,f-4,4,u,0,2),e.computeWorldVertices(s,0,4,u,4,2)):e.computeWorldVertices(s,6*b+2,8,u,0,2)),this.addCurvePosition(w,u[0],u[1],u[2],u[3],u[4],u[5],u[6],u[7],h,x,n||y>0&&0===k)}return h}c?(f+=2,u=_(this.world,f),e.computeWorldVertices(s,2,f-4,u,0,2),e.computeWorldVertices(s,0,2,u,f-4,2),u[f-2]=u[0],u[f-1]=u[1]):(d--,f-=4,u=_(this.world,f),e.computeWorldVertices(s,2,f,u,0,2));for(var M=_(this.curves,d),S=0,I=u[0],R=u[1],A=0,C=0,P=0,V=0,O=0,N=0,F=0,B=0,L=0,Y=0,X=0,D=0,W=0,U=0,G=0,q=2;G<d;G++,q+=6)A=u[q],C=u[q+1],P=u[q+2],V=u[q+3],O=u[q+4],N=u[q+5],X=2*(F=.1875*(I-2*A+P))+(L=.09375*(3*(A-P)-I+O)),D=2*(B=.1875*(R-2*C+V))+(Y=.09375*(3*(C-V)-R+N)),W=.75*(A-I)+F+.16666667*L,U=.75*(C-R)+B+.16666667*Y,S+=Math.sqrt(W*W+U*U),W+=X,U+=D,X+=L,D+=Y,S+=Math.sqrt(W*W+U*U),W+=X,U+=D,S+=Math.sqrt(W*W+U*U),W+=X+L,U+=D+Y,S+=Math.sqrt(W*W+U*U),M[G]=S,I=O,R=N;if(a&&(o*=S),i)for(var j=0;j<r;j++)l[j]*=S;for(var H=this.segments,z=0,Z=0,K=0,J=0,Q=0;Z<r;Z++,K+=3){var $=l[Z],tt=o+=$;if(c)(tt%=S)<0&&(tt+=S),J=0;else{if(tt<0){this.addBeforePosition(tt,u,0,h,K);continue}if(tt>S){this.addAfterPosition(tt-S,u,f-4,h,K);continue}}for(;;J++){var et=M[J];if(!(tt>et)){if(0===J)tt/=et;else{var rt=M[J-1];tt=(tt-rt)/(et-rt)}break}}if(J!==v){v=J;var nt=6*J;for(I=u[nt],R=u[nt+1],A=u[nt+2],C=u[nt+3],P=u[nt+4],V=u[nt+5],O=u[nt+6],N=u[nt+7],X=2*(F=.03*(I-2*A+P))+(L=.006*(3*(A-P)-I+O)),D=2*(B=.03*(R-2*C+V))+(Y=.006*(3*(C-V)-R+N)),W=.3*(A-I)+F+.16666667*L,U=.3*(C-R)+B+.16666667*Y,z=Math.sqrt(W*W+U*U),H[0]=z,nt=1;nt<8;nt++)W+=X,U+=D,X+=L,D+=Y,z+=Math.sqrt(W*W+U*U),H[nt]=z;W+=X,U+=D,z+=Math.sqrt(W*W+U*U),H[8]=z,W+=X+L,U+=D+Y,z+=Math.sqrt(W*W+U*U),H[9]=z,Q=0}for(tt*=z;;Q++){var at=H[Q];if(!(tt>at)){if(0===Q)tt/=at;else{var it=H[Q-1];tt=Q+(tt-it)/(at-it)}break}}this.addCurvePosition(.1*tt,I,R,A,C,P,V,O,N,h,K,n||Z>0&&0===$)}return h}},{key:"addBeforePosition",value:function(t,e,r,n,a){var i=e[r],s=e[r+1],o=e[r+2]-i,l=e[r+3]-s,h=Math.atan2(l,o);n[a]=i+t*Math.cos(h),n[a+1]=s+t*Math.sin(h),n[a+2]=h}},{key:"addAfterPosition",value:function(t,e,r,n,a){var i=e[r+2],s=e[r+3],o=i-e[r],l=s-e[r+1],h=Math.atan2(l,o);n[a]=i+t*Math.cos(h),n[a+1]=s+t*Math.sin(h),n[a+2]=h}},{key:"addCurvePosition",value:function(t,e,r,n,a,i,s,o,l,h,u,c){(0===t||isNaN(t))&&(t=1e-4);var f=t*t,d=f*t,v=1-t,m=v*v,g=m*v,p=v*t,y=3*p,x=v*y,b=y*t,k=e*g+n*x+i*b+o*d,w=r*g+a*x+s*b+l*d;h[u]=k,h[u+1]=w,c&&(h[u+2]=Math.atan2(w-(r*m+a*p*2+s*f),k-(e*m+n*p*2+i*f)))}}]),t}();Rt.NONE=-1,Rt.BEFORE=-2,Rt.AFTER=-3,Rt.epsilon=1e-5;var At=function(){function t(r,n){if(e(this,t),this.deform=[],null==r)throw new Error("data cannot be null.");if(null==n)throw new Error("bone cannot be null.");this.data=r,this.bone=n,this.color=new s,this.darkColor=null==r.darkColor?null:new s,this.setToSetupPose(),this.blendMode=this.data.blendMode}return r(t,[{key:"getAttachment",value:function(){return this.attachment}},{key:"setAttachment",value:function(t){this.attachment!==t&&(this.attachment=t,this.attachmentTime=this.bone.skeleton.time,this.deform.length=0)}},{key:"setAttachmentTime",value:function(t){this.attachmentTime=this.bone.skeleton.time-t}},{key:"getAttachmentTime",value:function(){return this.bone.skeleton.time-this.attachmentTime}},{key:"setToSetupPose",value:function(){this.color.setFromColor(this.data.color),null!=this.darkColor&&this.darkColor.setFromColor(this.data.darkColor),null==this.data.attachmentName?this.attachment=null:(this.attachment=null,this.setAttachment(this.bone.skeleton.getAttachment(this.data.index,this.data.attachmentName)))}}]),t}(),Ct=function(){function t(r,n){if(e(this,t),this.rotateMix=0,this.translateMix=0,this.scaleMix=0,this.shearMix=0,this.temp=new y,this.active=!1,null==r)throw new Error("data cannot be null.");if(null==n)throw new Error("skeleton cannot be null.");this.data=r,this.rotateMix=r.rotateMix,this.translateMix=r.translateMix,this.scaleMix=r.scaleMix,this.shearMix=r.shearMix,this.bones=[];for(var a=0;a<r.bones.length;a++)this.bones.push(n.findBone(r.bones[a].name));this.target=n.findBone(r.target.name)}return r(t,[{key:"isActive",value:function(){return this.active}},{key:"apply",value:function(){this.update()}},{key:"update",value:function(){this.data.local?this.data.relative?this.applyRelativeLocal():this.applyAbsoluteLocal():this.data.relative?this.applyRelativeWorld():this.applyAbsoluteWorld()}},{key:"applyAbsoluteWorld",value:function(){for(var t=this.rotateMix,e=this.translateMix,r=this.scaleMix,n=this.shearMix,a=this.target,i=a.matrix,s=i.a,o=i.c,u=i.b,f=i.d,d=s*f-o*u>0?c:-c,v=this.data.offsetRotation*d,m=this.data.offsetShearY*d,g=this.bones,p=0,y=g.length;p<y;p++){var x=g[p],b=!1,k=x.matrix;if(0!==t){var w=k.a,T=k.c,E=k.b,M=k.d,S=Math.atan2(u,s)-Math.atan2(E,w)+v;S>l?S-=h:S<-l&&(S+=h),S*=t;var _=Math.cos(S),I=Math.sin(S);k.a=_*w-I*E,k.c=_*T-I*M,k.b=I*w+_*E,k.d=I*T+_*M,b=!0}if(0!==e){var R=this.temp;a.localToWorld(R.set(this.data.offsetX,this.data.offsetY)),k.tx+=(R.x-k.tx)*e,k.ty+=(R.y-k.ty)*e,b=!0}if(r>0){var A=Math.sqrt(k.a*k.a+k.b*k.b),C=Math.sqrt(s*s+u*u);A>1e-5&&(A=(A+(C-A+this.data.offsetScaleX)*r)/A),k.a*=A,k.b*=A,A=Math.sqrt(k.c*k.c+k.d*k.d),C=Math.sqrt(o*o+f*f),A>1e-5&&(A=(A+(C-A+this.data.offsetScaleY)*r)/A),k.c*=A,k.d*=A,b=!0}if(n>0){var P=k.c,V=k.d,O=Math.atan2(V,P),N=Math.atan2(f,o)-Math.atan2(u,s)-(O-Math.atan2(k.b,k.a));N>l?N-=h:N<-l&&(N+=h),N=O+(N+m)*n;var F=Math.sqrt(P*P+V*V);k.c=Math.cos(N)*F,k.d=Math.sin(N)*F,b=!0}b&&(x.appliedValid=!1)}}},{key:"applyRelativeWorld",value:function(){for(var t=this.rotateMix,e=this.translateMix,r=this.scaleMix,n=this.shearMix,a=this.target,i=a.matrix,s=i.a,o=i.c,u=i.b,f=i.d,d=s*f-o*u>0?c:-c,v=this.data.offsetRotation*d,m=this.data.offsetShearY*d,g=this.bones,p=0,y=g.length;p<y;p++){var x=g[p],b=!1,k=x.matrix;if(0!==t){var w=k.a,T=k.c,E=k.b,M=k.d,S=Math.atan2(u,s)+v;S>l?S-=h:S<-l&&(S+=h),S*=t;var _=Math.cos(S),I=Math.sin(S);k.a=_*w-I*E,k.c=_*T-I*M,k.b=I*w+_*E,k.d=I*T+_*M,b=!0}if(0!==e){var R=this.temp;a.localToWorld(R.set(this.data.offsetX,this.data.offsetY)),k.tx+=R.x*e,k.ty+=R.y*e,b=!0}if(r>0){var A=(Math.sqrt(s*s+u*u)-1+this.data.offsetScaleX)*r+1;k.a*=A,k.b*=A,A=(Math.sqrt(o*o+f*f)-1+this.data.offsetScaleY)*r+1,k.c*=A,k.d*=A,b=!0}if(n>0){var C=Math.atan2(f,o)-Math.atan2(u,s);C>l?C-=h:C<-l&&(C+=h);var P=k.c,V=k.d;C=Math.atan2(V,P)+(C-l/2+m)*n;var O=Math.sqrt(P*P+V*V);k.c=Math.cos(C)*O,k.d=Math.sin(C)*O,b=!0}b&&(x.appliedValid=!1)}}},{key:"applyAbsoluteLocal",value:function(){var t=this.rotateMix,e=this.translateMix,r=this.scaleMix,n=this.shearMix,a=this.target;a.appliedValid||a.updateAppliedTransform();for(var i=this.bones,s=0,o=i.length;s<o;s++){var l=i[s];l.appliedValid||l.updateAppliedTransform();var h=l.arotation;if(0!==t){var u=a.arotation-h+this.data.offsetRotation;h+=(u-=360*(16384-(16384.499999999996-u/360|0)))*t}var c=l.ax,f=l.ay;0!==e&&(c+=(a.ax-c+this.data.offsetX)*e,f+=(a.ay-f+this.data.offsetY)*e);var d=l.ascaleX,v=l.ascaleY;r>0&&(d>1e-5&&(d=(d+(a.ascaleX-d+this.data.offsetScaleX)*r)/d),v>1e-5&&(v=(v+(a.ascaleY-v+this.data.offsetScaleY)*r)/v));var m=l.ashearY;if(n>0){var g=a.ashearY-m+this.data.offsetShearY;g-=360*(16384-(16384.499999999996-g/360|0)),l.shearY+=g*n}l.updateWorldTransformWith(c,f,h,d,v,l.ashearX,m)}}},{key:"applyRelativeLocal",value:function(){var t=this.rotateMix,e=this.translateMix,r=this.scaleMix,n=this.shearMix,a=this.target;a.appliedValid||a.updateAppliedTransform();for(var i=this.bones,s=0,o=i.length;s<o;s++){var l=i[s];l.appliedValid||l.updateAppliedTransform();var h=l.arotation;0!==t&&(h+=(a.arotation+this.data.offsetRotation)*t);var u=l.ax,c=l.ay;0!==e&&(u+=(a.ax+this.data.offsetX)*e,c+=(a.ay+this.data.offsetY)*e);var f=l.ascaleX,d=l.ascaleY;r>0&&(f>1e-5&&(f*=(a.ascaleX-1+this.data.offsetScaleX)*r+1),d>1e-5&&(d*=(a.ascaleY-1+this.data.offsetScaleY)*r+1));var v=l.ashearY;n>0&&(v+=(a.ashearY+this.data.offsetShearY)*n),l.updateWorldTransformWith(u,c,h,f,d,l.ashearX,v)}}}]),t}(),Pt=function(){function t(r){if(e(this,t),this._updateCache=[],this.updateCacheReset=[],this.time=0,this.scaleX=1,this.scaleY=1,this.x=0,this.y=0,null==r)throw new Error("data cannot be null.");this.data=r,this.bones=[];for(var n=0;n<r.bones.length;n++){var a=r.bones[n],i=void 0;if(null==a.parent)i=new xt(a,this,null);else{var o=this.bones[a.parent.index];i=new xt(a,this,o),o.children.push(i)}this.bones.push(i)}this.slots=[],this.drawOrder=[];for(var l=0;l<r.slots.length;l++){var h=r.slots[l],u=this.bones[h.boneData.index],c=new At(h,u);this.slots.push(c),this.drawOrder.push(c)}this.ikConstraints=[];for(var f=0;f<r.ikConstraints.length;f++){var d=r.ikConstraints[f];this.ikConstraints.push(new Tt(d,this))}this.transformConstraints=[];for(var v=0;v<r.transformConstraints.length;v++){var m=r.transformConstraints[v];this.transformConstraints.push(new Ct(m,this))}this.pathConstraints=[];for(var g=0;g<r.pathConstraints.length;g++){var p=r.pathConstraints[g];this.pathConstraints.push(new Rt(p,this))}this.color=new s(1,1,1,1),this.updateCache()}return r(t,[{key:"updateCache",value:function(){var t=this._updateCache;t.length=0,this.updateCacheReset.length=0;for(var e=this.bones,r=0,n=e.length;r<n;r++){var a=e[r];a.sorted=a.data.skinRequired,a.active=!a.sorted}if(null!=this.skin)for(var i=this.skin.bones,s=0,o=this.skin.bones.length;s<o;s++){var l=this.bones[i[s].index];do{l.sorted=!1,l.active=!0,l=l.parent}while(null!=l)}var h=this.ikConstraints,u=this.transformConstraints,c=this.pathConstraints,f=h.length,d=u.length,v=c.length,m=f+d+v;t:for(var g=0;g<m;g++){for(var p=0;p<f;p++){var y=h[p];if(y.data.order===g){this.sortIKConstraint(y);continue t}}for(var x=0;x<d;x++){var b=u[x];if(b.data.order===g){this.sortTransformConstraint(b);continue t}}for(var k=0;k<v;k++){var w=c[k];if(w.data.order===g){this.sortPathConstraint(w);continue t}}}for(var T=0,E=e.length;T<E;T++)this.sortBone(e[T])}},{key:"sortIKConstraint",value:function(t){if(t.active=t.target.isActive()&&(!t.data.skinRequired||null!=this.skin&&V(this.skin.constraints,t.data)),t.active){var e=t.target;this.sortBone(e);var r=t.bones,n=r[0];if(this.sortBone(n),r.length>1){var a=r[r.length-1];this._updateCache.indexOf(a)>-1||this.updateCacheReset.push(a)}this._updateCache.push(t),this.sortReset(n.children),r[r.length-1].sorted=!0}}},{key:"sortPathConstraint",value:function(t){if(t.active=t.target.bone.isActive()&&(!t.data.skinRequired||null!=this.skin&&V(this.skin.constraints,t.data)),t.active){var e=t.target,r=e.data.index,n=e.bone;null!=this.skin&&this.sortPathConstraintAttachment(this.skin,r,n),null!=this.data.defaultSkin&&this.data.defaultSkin!==this.skin&&this.sortPathConstraintAttachment(this.data.defaultSkin,r,n);for(var a=0,i=this.data.skins.length;a<i;a++)this.sortPathConstraintAttachment(this.data.skins[a],r,n);var s=e.getAttachment();s instanceof ft&&this.sortPathConstraintAttachmentWith(s,n);for(var o=t.bones,l=o.length,h=0;h<l;h++)this.sortBone(o[h]);this._updateCache.push(t);for(var u=0;u<l;u++)this.sortReset(o[u].children);for(var c=0;c<l;c++)o[c].sorted=!0}}},{key:"sortTransformConstraint",value:function(t){if(t.active=t.target.isActive()&&(!t.data.skinRequired||null!=this.skin&&V(this.skin.constraints,t.data)),t.active){this.sortBone(t.target);var e=t.bones,r=e.length;if(t.data.local)for(var n=0;n<r;n++){var a=e[n];this.sortBone(a.parent),this._updateCache.indexOf(a)>-1||this.updateCacheReset.push(a)}else for(var i=0;i<r;i++)this.sortBone(e[i]);this._updateCache.push(t);for(var s=0;s<r;s++)this.sortReset(e[s].children);for(var o=0;o<r;o++)e[o].sorted=!0}}},{key:"sortPathConstraintAttachment",value:function(t,e,r){var n=t.attachments[e];if(n)for(var a in n)this.sortPathConstraintAttachmentWith(n[a],r)}},{key:"sortPathConstraintAttachmentWith",value:function(t,e){if(t instanceof ft){var r=t.bones;if(null==r)this.sortBone(e);else for(var n=this.bones,a=0;a<r.length;)for(var i=r[a++],s=a+i;a<s;a++){var o=r[a];this.sortBone(n[o])}}}},{key:"sortBone",value:function(t){if(!t.sorted){var e=t.parent;null!=e&&this.sortBone(e),t.sorted=!0,this._updateCache.push(t)}}},{key:"sortReset",value:function(t){for(var e=0,r=t.length;e<r;e++){var n=t[e];n.active&&(n.sorted&&this.sortReset(n.children),n.sorted=!1)}}},{key:"updateWorldTransform",value:function(){for(var t=this.updateCacheReset,e=0,r=t.length;e<r;e++){var n=t[e];n.ax=n.x,n.ay=n.y,n.arotation=n.rotation,n.ascaleX=n.scaleX,n.ascaleY=n.scaleY,n.ashearX=n.shearX,n.ashearY=n.shearY,n.appliedValid=!0}for(var a=this._updateCache,i=0,s=a.length;i<s;i++)a[i].update()}},{key:"setToSetupPose",value:function(){this.setBonesToSetupPose(),this.setSlotsToSetupPose()}},{key:"setBonesToSetupPose",value:function(){for(var t=this.bones,e=0,r=t.length;e<r;e++)t[e].setToSetupPose();for(var n=this.ikConstraints,a=0,i=n.length;a<i;a++){var s=n[a];s.mix=s.data.mix,s.softness=s.data.softness,s.bendDirection=s.data.bendDirection,s.compress=s.data.compress,s.stretch=s.data.stretch}for(var o=this.transformConstraints,l=0,h=o.length;l<h;l++){var u=o[l],c=u.data;u.rotateMix=c.rotateMix,u.translateMix=c.translateMix,u.scaleMix=c.scaleMix,u.shearMix=c.shearMix}for(var f=this.pathConstraints,d=0,v=f.length;d<v;d++){var m=f[d],g=m.data;m.position=g.position,m.spacing=g.spacing,m.rotateMix=g.rotateMix,m.translateMix=g.translateMix}}},{key:"setSlotsToSetupPose",value:function(){var t=this.slots;S(t,0,this.drawOrder,0,t.length);for(var e=0,r=t.length;e<r;e++)t[e].setToSetupPose()}},{key:"getRootBone",value:function(){return 0===this.bones.length?null:this.bones[0]}},{key:"findBone",value:function(t){if(null==t)throw new Error("boneName cannot be null.");for(var e=this.bones,r=0,n=e.length;r<n;r++){var a=e[r];if(a.data.name===t)return a}return null}},{key:"findBoneIndex",value:function(t){if(null==t)throw new Error("boneName cannot be null.");for(var e=this.bones,r=0,n=e.length;r<n;r++)if(e[r].data.name===t)return r;return-1}},{key:"findSlot",value:function(t){if(null==t)throw new Error("slotName cannot be null.");for(var e=this.slots,r=0,n=e.length;r<n;r++){var a=e[r];if(a.data.name===t)return a}return null}},{key:"findSlotIndex",value:function(t){if(null==t)throw new Error("slotName cannot be null.");for(var e=this.slots,r=0,n=e.length;r<n;r++)if(e[r].data.name===t)return r;return-1}},{key:"setSkinByName",value:function(t){var e=this.data.findSkin(t);if(null==e)throw new Error("Skin not found: "+t);this.setSkin(e)}},{key:"setSkin",value:function(t){if(t!==this.skin){if(null!=t)if(null!=this.skin)t.attachAll(this,this.skin);else for(var e=this.slots,r=0,n=e.length;r<n;r++){var a=e[r],i=a.data.attachmentName;if(null!=i){var s=t.getAttachment(r,i);null!=s&&a.setAttachment(s)}}this.skin=t,this.updateCache()}}},{key:"getAttachmentByName",value:function(t,e){return this.getAttachment(this.data.findSlotIndex(t),e)}},{key:"getAttachment",value:function(t,e){if(null==e)throw new Error("attachmentName cannot be null.");if(null!=this.skin){var r=this.skin.getAttachment(t,e);if(null!=r)return r}return null!=this.data.defaultSkin?this.data.defaultSkin.getAttachment(t,e):null}},{key:"setAttachment",value:function(t,e){if(null==t)throw new Error("slotName cannot be null.");for(var r=this.slots,n=0,a=r.length;n<a;n++){var i=r[n];if(i.data.name===t){var s=null;if(null!=e&&null==(s=this.getAttachment(n,e)))throw new Error("Attachment not found: "+e+", for slot: "+t);return void i.setAttachment(s)}}throw new Error("Slot not found: "+t)}},{key:"findIKConstraint",value:function(t){if(null==t)throw new Error("constraintName cannot be null.");for(var e=this.ikConstraints,r=0,n=e.length;r<n;r++){var a=e[r];if(a.data.name===t)return a}return null}},{key:"findTransformConstraint",value:function(t){if(null==t)throw new Error("constraintName cannot be null.");for(var e=this.transformConstraints,r=0,n=e.length;r<n;r++){var a=e[r];if(a.data.name===t)return a}return null}},{key:"findPathConstraint",value:function(t){if(null==t)throw new Error("constraintName cannot be null.");for(var e=this.pathConstraints,r=0,n=e.length;r<n;r++){var a=e[r];if(a.data.name===t)return a}return null}},{key:"getBounds",value:function(t,e){var r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:new Array(2);if(null==t)throw new Error("offset cannot be null.");if(null==e)throw new Error("size cannot be null.");for(var n=this.drawOrder,a=Number.POSITIVE_INFINITY,i=Number.POSITIVE_INFINITY,s=Number.NEGATIVE_INFINITY,o=Number.NEGATIVE_INFINITY,l=0,h=n.length;l<h;l++){var u=n[l];if(u.bone.active){var c=0,f=null,d=u.getAttachment();if(d instanceof ht)f=_(r,c=8,0),d.computeWorldVertices(u.bone,f,0,2);else if(d instanceof ut){var v=d;f=_(r,c=v.worldVerticesLength,0),v.computeWorldVertices(u,0,c,f,0,2)}if(null!=f)for(var m=0,g=f.length;m<g;m+=2){var p=f[m],y=f[m+1];a=Math.min(a,p),i=Math.min(i,y),s=Math.max(s,p),o=Math.max(o,y)}}}t.set(a,i),e.set(s-a,o-i)}},{key:"update",value:function(t){this.time+=t}}]),t}(),Vt=function(t){function r(t){e(this,r);var n=a(this,(r.__proto__||Object.getPrototypeOf(r)).call(this,t,0,!1));return n.bones=[],n.rotateMix=0,n.translateMix=0,n.scaleMix=0,n.shearMix=0,n.offsetRotation=0,n.offsetX=0,n.offsetY=0,n.offsetScaleX=0,n.offsetScaleY=0,n.offsetShearY=0,n.relative=!1,n.local=!1,n}return n(r,bt),r}(),Ot=function(){function t(){e(this,t),this.bones=[],this.slots=[],this.skins=[],this.events=[],this.animations=[],this.ikConstraints=[],this.transformConstraints=[],this.pathConstraints=[],this.fps=0}return r(t,[{key:"findBone",value:function(t){if(null==t)throw new Error("boneName cannot be null.");for(var e=this.bones,r=0,n=e.length;r<n;r++){var a=e[r];if(a.name===t)return a}return null}},{key:"findBoneIndex",value:function(t){if(null==t)throw new Error("boneName cannot be null.");for(var e=this.bones,r=0,n=e.length;r<n;r++)if(e[r].name===t)return r;return-1}},{key:"findSlot",value:function(t){if(null==t)throw new Error("slotName cannot be null.");for(var e=this.slots,r=0,n=e.length;r<n;r++){var a=e[r];if(a.name===t)return a}return null}},{key:"findSlotIndex",value:function(t){if(null==t)throw new Error("slotName cannot be null.");for(var e=this.slots,r=0,n=e.length;r<n;r++)if(e[r].name===t)return r;return-1}},{key:"findSkin",value:function(t){if(null==t)throw new Error("skinName cannot be null.");for(var e=this.skins,r=0,n=e.length;r<n;r++){var a=e[r];if(a.name===t)return a}return null}},{key:"findEvent",value:function(t){if(null==t)throw new Error("eventDataName cannot be null.");for(var e=this.events,r=0,n=e.length;r<n;r++){var a=e[r];if(a.name===t)return a}return null}},{key:"findAnimation",value:function(t){if(null==t)throw new Error("animationName cannot be null.");for(var e=this.animations,r=0,n=e.length;r<n;r++){var a=e[r];if(a.name===t)return a}return null}},{key:"findIKConstraint",value:function(t){if(null==t)throw new Error("constraintName cannot be null.");for(var e=this.ikConstraints,r=0,n=e.length;r<n;r++){var a=e[r];if(a.name===t)return a}return null}},{key:"findTransformConstraint",value:function(t){if(null==t)throw new Error("constraintName cannot be null.");for(var e=this.transformConstraints,r=0,n=e.length;r<n;r++){var a=e[r];if(a.name===t)return a}return null}},{key:"findPathConstraint",value:function(t){if(null==t)throw new Error("constraintName cannot be null.");for(var e=this.pathConstraints,r=0,n=e.length;r<n;r++){var a=e[r];if(a.name===t)return a}return null}},{key:"findPathConstraintIndex",value:function(t){if(null==t)throw new Error("pathConstraintName cannot be null.");for(var e=this.pathConstraints,r=0,n=e.length;r<n;r++)if(e[r].name===t)return r;return-1}}]),t}(),Nt=function t(r,n,a){if(e(this,t),this.color=new s(1,1,1,1),r<0)throw new Error("index must be >= 0.");if(null==n)throw new Error("name cannot be null.");if(null==a)throw new Error("boneData cannot be null.");this.index=r,this.name=n,this.boneData=a},Ft=function t(r,n,a){e(this,t),this.slotIndex=r,this.name=n,this.attachment=a},Bt=function(){function t(r){if(e(this,t),null==r)throw new Error("name cannot be null.");this.name=r,this.attachments=[],this.bones=[],this.constraints=[]}return r(t,[{key:"setAttachment",value:function(t,e,r){if(null==r)throw new Error("attachment cannot be null.");var n=this.attachments;t>=n.length&&(n.length=t+1),n[t]||(n[t]={}),n[t][e]=r}},{key:"addSkin",value:function(t){for(var e=0;e<t.bones.length;e++){for(var r=t.bones[e],n=!1,a=0;a<this.bones.length;a++)if(this.bones[a]===r){n=!0;break}n||this.bones.push(r)}for(var i=0;i<t.constraints.length;i++){for(var s=t.constraints[i],o=!1,l=0;l<this.constraints.length;l++)if(this.constraints[l]===s){o=!0;break}o||this.constraints.push(s)}for(var h=t.getAttachments(),u=0;u<h.length;u++){var c=h[u];this.setAttachment(c.slotIndex,c.name,c.attachment)}}},{key:"copySkin",value:function(t){for(var e=0;e<t.bones.length;e++){for(var r=t.bones[e],n=!1,a=0;a<this.bones.length;a++)if(this.bones[a]===r){n=!0;break}n||this.bones.push(r)}for(var i=0;i<t.constraints.length;i++){for(var s=t.constraints[i],o=!1,l=0;l<this.constraints.length;l++)if(this.constraints[l]===s){o=!0;break}o||this.constraints.push(s)}for(var h=t.getAttachments(),u=0;u<h.length;u++){var c=h[u];null!=c.attachment&&(c.attachment instanceof ut?(c.attachment=c.attachment.newLinkedMesh(),this.setAttachment(c.slotIndex,c.name,c.attachment)):(c.attachment=c.attachment.copy(),this.setAttachment(c.slotIndex,c.name,c.attachment)))}}},{key:"getAttachment",value:function(t,e){var r=this.attachments[t];return r?r[e]:null}},{key:"removeAttachment",value:function(t,e){var r=this.attachments[t];r&&(r[e]=null)}},{key:"getAttachments",value:function(){for(var t=[],e=0;e<this.attachments.length;e++){var r=this.attachments[e];if(r)for(var n in r){var a=r[n];a&&t.push(new Ft(e,n,a))}}return t}},{key:"getAttachmentsForSlot",value:function(t,e){var r=this.attachments[t];if(r)for(var n in r){var a=r[n];a&&e.push(new Ft(t,n,a))}}},{key:"clear",value:function(){this.attachments.length=0,this.bones.length=0,this.constraints.length=0}},{key:"attachAll",value:function(t,e){for(var r=0,n=0;n<t.slots.length;n++){var a=t.slots[n],i=a.getAttachment();if(i&&r<e.attachments.length){var s=e.attachments[r];for(var o in s){if(i===s[o]){var l=this.getAttachment(r,o);null!=l&&a.setAttachment(l);break}}}r++}}}]),t}(),Lt=function(){function t(r){e(this,t),this.scale=1,this.linkedMeshes=[],this.attachmentLoader=r}return r(t,[{key:"readSkeletonData",value:function(e){var r=this.scale,n=new Ot;n.name="";var a=new Yt(e);n.hash=a.readString(),n.version=a.readString(),"3.8.75"===n.version&&console.error("Unsupported skeleton data, 3.8.75 is deprecated, please export with a newer version of Spine."),n.x=a.readFloat(),n.y=a.readFloat(),n.width=a.readFloat(),n.height=a.readFloat();var i=a.readBoolean();i&&(n.fps=a.readFloat(),n.imagesPath=a.readString(),n.audioPath=a.readString());var o=0;o=a.readInt(!0);for(var l=0;l<o;l++)a.strings.push(a.readString());o=a.readInt(!0);for(var h=0;h<o;h++){var u=a.readString(),c=0===h?null:n.bones[a.readInt(!0)],f=new yt(h,u,c);f.rotation=a.readFloat(),f.x=a.readFloat()*r,f.y=a.readFloat()*r,f.scaleX=a.readFloat(),f.scaleY=a.readFloat(),f.shearX=a.readFloat(),f.shearY=a.readFloat(),f.length=a.readFloat()*r,f.transformMode=t.TransformModeValues[a.readInt(!0)],f.skinRequired=a.readBoolean(),i&&s.rgba8888ToColor(f.color,a.readInt32()),n.bones.push(f)}o=a.readInt(!0);for(var d=0;d<o;d++){var v=a.readString(),m=n.bones[a.readInt(!0)],g=new Nt(d,v,m);s.rgba8888ToColor(g.color,a.readInt32());var p=a.readInt32();-1!==p&&s.rgb888ToColor(g.darkColor=new s,p),g.attachmentName=a.readStringRef(),g.blendMode=t.BlendModeValues[a.readInt(!0)],n.slots.push(g)}o=a.readInt(!0);for(var y,x=0;x<o;x++){var b=new Et(a.readString());b.order=a.readInt(!0),b.skinRequired=a.readBoolean(),y=a.readInt(!0);for(var k=0;k<y;k++)b.bones.push(n.bones[a.readInt(!0)]);b.target=n.bones[a.readInt(!0)],b.mix=a.readFloat(),b.softness=a.readFloat()*r,b.bendDirection=a.readByte(),b.compress=a.readBoolean(),b.stretch=a.readBoolean(),b.uniform=a.readBoolean(),n.ikConstraints.push(b)}o=a.readInt(!0);for(var w,T=0;T<o;T++){var E=new Vt(a.readString());E.order=a.readInt(!0),E.skinRequired=a.readBoolean(),w=a.readInt(!0);for(var M=0;M<w;M++)E.bones.push(n.bones[a.readInt(!0)]);E.target=n.bones[a.readInt(!0)],E.local=a.readBoolean(),E.relative=a.readBoolean(),E.offsetRotation=a.readFloat(),E.offsetX=a.readFloat()*r,E.offsetY=a.readFloat()*r,E.offsetScaleX=a.readFloat(),E.offsetScaleY=a.readFloat(),E.offsetShearY=a.readFloat(),E.rotateMix=a.readFloat(),E.translateMix=a.readFloat(),E.scaleMix=a.readFloat(),E.shearMix=a.readFloat(),n.transformConstraints.push(E)}o=a.readInt(!0);for(var S,I=0;I<o;I++){var R=new Mt(a.readString());R.order=a.readInt(!0),R.skinRequired=a.readBoolean(),S=a.readInt(!0);for(var A=0;A<S;A++)R.bones.push(n.bones[a.readInt(!0)]);R.target=n.slots[a.readInt(!0)],R.positionMode=t.PositionModeValues[a.readInt(!0)],R.spacingMode=t.SpacingModeValues[a.readInt(!0)],R.rotateMode=t.RotateModeValues[a.readInt(!0)],R.offsetRotation=a.readFloat(),R.position=a.readFloat(),R.positionMode===St.Fixed&&(R.position*=r),R.spacing=a.readFloat(),R.spacingMode!==_t.Length&&R.spacingMode!==_t.Fixed||(R.spacing*=r),R.rotateMix=a.readFloat(),R.translateMix=a.readFloat(),n.pathConstraints.push(R)}var C=this.readSkin(a,n,!0,i);null!=C&&(n.defaultSkin=C,n.skins.push(C));var P=n.skins.length;for(_(n.skins,o=P+a.readInt(!0));P<o;P++)n.skins[P]=this.readSkin(a,n,!1,i);o=this.linkedMeshes.length;for(var V=0;V<o;V++){var O=this.linkedMeshes[V],N=null==O.skin?n.defaultSkin:n.findSkin(O.skin);if(null==N)throw new Error("Skin not found: "+O.skin);var F=N.getAttachment(O.slotIndex,O.parent);if(null==F)throw new Error("Parent mesh not found: "+O.parent);O.mesh.deformAttachment=O.inheritDeform?F:O.mesh,O.mesh.setParentMesh(F)}this.linkedMeshes.length=0,o=a.readInt(!0);for(var B=0;B<o;B++){var L=new wt(a.readStringRef());L.intValue=a.readInt(!1),L.floatValue=a.readFloat(),L.stringValue=a.readString(),L.audioPath=a.readString(),null!=L.audioPath&&(L.volume=a.readFloat(),L.balance=a.readFloat()),n.events.push(L)}o=a.readInt(!0);for(var Y=0;Y<o;Y++)n.animations.push(this.readAnimation(a,a.readString(),n));return n}},{key:"readSkin",value:function(t,e,r,n){var a=null,i=0;if(r){if(0===(i=t.readInt(!0)))return null;a=new Bt("default")}else{(a=new Bt(t.readStringRef())).bones.length=t.readInt(!0);for(var s=0,o=a.bones.length;s<o;s++)a.bones[s]=e.bones[t.readInt(!0)];for(var l=0,h=t.readInt(!0);l<h;l++)a.constraints.push(e.ikConstraints[t.readInt(!0)]);for(var u=0,c=t.readInt(!0);u<c;u++)a.constraints.push(e.transformConstraints[t.readInt(!0)]);for(var f=0,d=t.readInt(!0);f<d;f++)a.constraints.push(e.pathConstraints[t.readInt(!0)]);i=t.readInt(!0)}for(var v=0;v<i;v++)for(var m=t.readInt(!0),g=0,p=t.readInt(!0);g<p;g++){var y=t.readStringRef(),x=this.readAttachment(t,e,a,m,y,n);null!=x&&a.setAttachment(m,y,x)}return a}},{key:"readAttachment",value:function(e,r,n,a,i,o){var l=this.scale,h=e.readStringRef();null==h&&(h=i);var u=e.readByte();switch(t.AttachmentTypeValues[u]){case O.Region:var c=e.readStringRef(),f=e.readFloat(),d=e.readFloat(),v=e.readFloat(),m=e.readFloat(),g=e.readFloat(),p=e.readFloat(),y=e.readFloat(),x=e.readInt32();null==c&&(c=h);var b=this.attachmentLoader.newRegionAttachment(n,h,c);return null==b?null:(b.path=c,b.x=d*l,b.y=v*l,b.scaleX=m,b.scaleY=g,b.rotation=f,b.width=p*l,b.height=y*l,s.rgba8888ToColor(b.color,x),b.updateOffset(),b);case O.BoundingBox:var k=e.readInt(!0),w=this.readVertices(e,k),T=o?e.readInt32():0,E=this.attachmentLoader.newBoundingBoxAttachment(n,h);return null==E?null:(E.worldVerticesLength=k<<1,E.vertices=w.vertices,E.bones=w.bones,o&&s.rgba8888ToColor(E.color,T),E);case O.Mesh:var M=e.readStringRef(),S=e.readInt32(),_=e.readInt(!0),I=this.readFloatArray(e,_<<1,1),A=this.readShortArray(e),C=this.readVertices(e,_),P=e.readInt(!0),V=null,N=0,F=0;o&&(V=this.readShortArray(e),N=e.readFloat(),F=e.readFloat()),null==M&&(M=h);var B=this.attachmentLoader.newMeshAttachment(n,h,M);return null==B?null:(B.path=M,s.rgba8888ToColor(B.color,S),B.bones=C.bones,B.vertices=C.vertices,B.worldVerticesLength=_<<1,B.triangles=A,B.regionUVs=new Float32Array(I),B.hullLength=P<<1,o&&(B.edges=V,B.width=N*l,B.height=F*l),B);case O.LinkedMesh:var L=e.readStringRef(),Y=e.readInt32(),X=e.readStringRef(),D=e.readStringRef(),W=e.readBoolean(),U=0,G=0;o&&(U=e.readFloat(),G=e.readFloat()),null==L&&(L=h);var q=this.attachmentLoader.newMeshAttachment(n,h,L);return null==q?null:(q.path=L,s.rgba8888ToColor(q.color,Y),o&&(q.width=U*l,q.height=G*l),this.linkedMeshes.push(new Xt(q,X,a,D,W)),q);case O.Path:for(var j=e.readBoolean(),H=e.readBoolean(),z=e.readInt(!0),Z=this.readVertices(e,z),K=R(z/3,0),J=0,Q=K.length;J<Q;J++)K[J]=e.readFloat()*l;var $=o?e.readInt32():0,tt=this.attachmentLoader.newPathAttachment(n,h);return null==tt?null:(tt.closed=j,tt.constantSpeed=H,tt.worldVerticesLength=z<<1,tt.vertices=Z.vertices,tt.bones=Z.bones,tt.lengths=K,o&&s.rgba8888ToColor(tt.color,$),tt);case O.Point:var et=e.readFloat(),rt=e.readFloat(),nt=e.readFloat(),at=o?e.readInt32():0,it=this.attachmentLoader.newPointAttachment(n,h);return null==it?null:(it.x=rt*l,it.y=nt*l,it.rotation=et,o&&s.rgba8888ToColor(it.color,at),it);case O.Clipping:var st=e.readInt(!0),ot=e.readInt(!0),lt=this.readVertices(e,ot),ht=o?e.readInt32():0,ut=this.attachmentLoader.newClippingAttachment(n,h);return null==ut?null:(ut.endSlot=r.slots[st],ut.worldVerticesLength=ot<<1,ut.vertices=lt.vertices,ut.bones=lt.bones,o&&s.rgba8888ToColor(ut.color,ht),ut)}return null}},{key:"readVertices",value:function(t,e){var r=e<<1,n=new Dt,a=this.scale;if(!t.readBoolean())return n.vertices=this.readFloatArray(t,r,a),n;for(var i=[],s=[],o=0;o<e;o++){var l=t.readInt(!0);s.push(l);for(var h=0;h<l;h++)s.push(t.readInt(!0)),i.push(t.readFloat()*a),i.push(t.readFloat()*a),i.push(t.readFloat())}return n.vertices=C(i),n.bones=s,n}},{key:"readFloatArray",value:function(t,e,r){var n=new Array(e);if(1===r)for(var a=0;a<e;a++)n[a]=t.readFloat();else for(var i=0;i<e;i++)n[i]=t.readFloat()*r;return n}},{key:"readShortArray",value:function(t){for(var e=t.readInt(!0),r=new Array(e),n=0;n<e;n++)r[n]=t.readShort();return r}},{key:"readAnimation",value:function(e,r,n){for(var a=[],i=this.scale,o=0,l=new s,h=new s,u=0,c=e.readInt(!0);u<c;u++)for(var f=e.readInt(!0),d=0,v=e.readInt(!0);d<v;d++){var m=e.readByte(),g=e.readInt(!0);switch(m){case t.SLOT_ATTACHMENT:var p=new z(g);p.slotIndex=f;for(var y=0;y<g;y++)p.setFrame(y,e.readFloat(),e.readStringRef());a.push(p),o=Math.max(o,p.frames[g-1]);break;case t.SLOT_COLOR:var x=new j(g);x.slotIndex=f;for(var b=0;b<g;b++){var k=e.readFloat();s.rgba8888ToColor(l,e.readInt32()),x.setFrame(b,k,l.r,l.g,l.b,l.a),b<g-1&&this.readCurve(e,b,x)}a.push(x),o=Math.max(o,x.frames[(g-1)*j.ENTRIES]);break;case t.SLOT_TWO_COLOR:var w=new H(g);w.slotIndex=f;for(var T=0;T<g;T++){var E=e.readFloat();s.rgba8888ToColor(l,e.readInt32()),s.rgb888ToColor(h,e.readInt32()),w.setFrame(T,E,l.r,l.g,l.b,l.a,h.r,h.g,h.b),T<g-1&&this.readCurve(e,T,w)}a.push(w),o=Math.max(o,w.frames[(g-1)*H.ENTRIES])}}for(var M=0,S=e.readInt(!0);M<S;M++)for(var _=e.readInt(!0),I=0,C=e.readInt(!0);I<C;I++){var P=e.readByte(),V=e.readInt(!0);switch(P){case t.BONE_ROTATE:var O=new W(V);O.boneIndex=_;for(var N=0;N<V;N++)O.setFrame(N,e.readFloat(),e.readFloat()),N<V-1&&this.readCurve(e,N,O);a.push(O),o=Math.max(o,O.frames[(V-1)*W.ENTRIES]);break;case t.BONE_TRANSLATE:case t.BONE_SCALE:case t.BONE_SHEAR:var F=void 0,B=1;P===t.BONE_SCALE?F=new G(V):P===t.BONE_SHEAR?F=new q(V):(F=new U(V),B=i),F.boneIndex=_;for(var L=0;L<V;L++)F.setFrame(L,e.readFloat(),e.readFloat()*B,e.readFloat()*B),L<V-1&&this.readCurve(e,L,F);a.push(F),o=Math.max(o,F.frames[(V-1)*U.ENTRIES])}}for(var Y=0,D=e.readInt(!0);Y<D;Y++){var Z=e.readInt(!0),at=e.readInt(!0),it=new $(at);it.ikConstraintIndex=Z;for(var st=0;st<at;st++)it.setFrame(st,e.readFloat(),e.readFloat(),e.readFloat()*i,e.readByte(),e.readBoolean(),e.readBoolean()),st<at-1&&this.readCurve(e,st,it);a.push(it),o=Math.max(o,it.frames[(at-1)*$.ENTRIES])}for(var ot=0,lt=e.readInt(!0);ot<lt;ot++){var ht=e.readInt(!0),ut=e.readInt(!0),ct=new tt(ut);ct.transformConstraintIndex=ht;for(var ft=0;ft<ut;ft++)ct.setFrame(ft,e.readFloat(),e.readFloat(),e.readFloat(),e.readFloat(),e.readFloat()),ft<ut-1&&this.readCurve(e,ft,ct);a.push(ct),o=Math.max(o,ct.frames[(ut-1)*tt.ENTRIES])}for(var dt=0,vt=e.readInt(!0);dt<vt;dt++)for(var mt=e.readInt(!0),gt=n.pathConstraints[mt],pt=0,yt=e.readInt(!0);pt<yt;pt++){var xt=e.readByte(),bt=e.readInt(!0);switch(xt){case t.PATH_POSITION:case t.PATH_SPACING:var wt=void 0,Tt=1;xt===t.PATH_SPACING?(wt=new rt(bt),gt.spacingMode!==_t.Length&&gt.spacingMode!==_t.Fixed||(Tt=i)):(wt=new et(bt),gt.positionMode===St.Fixed&&(Tt=i)),wt.pathConstraintIndex=mt;for(var Et=0;Et<bt;Et++)wt.setFrame(Et,e.readFloat(),e.readFloat()*Tt),Et<bt-1&&this.readCurve(e,Et,wt);a.push(wt),o=Math.max(o,wt.frames[(bt-1)*et.ENTRIES]);break;case t.PATH_MIX:var Mt=new nt(bt);Mt.pathConstraintIndex=mt;for(var It=0;It<bt;It++)Mt.setFrame(It,e.readFloat(),e.readFloat(),e.readFloat()),It<bt-1&&this.readCurve(e,It,Mt);a.push(Mt),o=Math.max(o,Mt.frames[(bt-1)*nt.ENTRIES])}}for(var Rt=0,At=e.readInt(!0);Rt<At;Rt++)for(var Ct=n.skins[e.readInt(!0)],Pt=0,Vt=e.readInt(!0);Pt<Vt;Pt++)for(var Ot=e.readInt(!0),Nt=0,Ft=e.readInt(!0);Nt<Ft;Nt++){var Bt=Ct.getAttachment(Ot,e.readStringRef()),Lt=null!=Bt.bones,Yt=Bt.vertices,Xt=Lt?Yt.length/3*2:Yt.length,Dt=e.readInt(!0),Wt=new K(Dt);Wt.slotIndex=Ot,Wt.attachment=Bt;for(var Ut=0;Ut<Dt;Ut++){var Gt=e.readFloat(),qt=void 0,jt=e.readInt(!0);if(0===jt)qt=Lt?A(Xt):Yt;else{qt=A(Xt);var Ht=e.readInt(!0);if(jt+=Ht,1===i)for(var zt=Ht;zt<jt;zt++)qt[zt]=e.readFloat();else for(var Zt=Ht;Zt<jt;Zt++)qt[Zt]=e.readFloat()*i;if(!Lt)for(var Kt=0,Jt=qt.length;Kt<Jt;Kt++)qt[Kt]+=Yt[Kt]}Wt.setFrame(Ut,Gt,qt),Ut<Dt-1&&this.readCurve(e,Ut,Wt)}a.push(Wt),o=Math.max(o,Wt.frames[Dt-1])}var Qt=e.readInt(!0);if(Qt>0){for(var $t=new Q(Qt),te=n.slots.length,ee=0;ee<Qt;ee++){for(var re=e.readFloat(),ne=e.readInt(!0),ae=R(te,0),ie=te-1;ie>=0;ie--)ae[ie]=-1;for(var se=R(te-ne,0),oe=0,le=0,he=0;he<ne;he++){for(var ue=e.readInt(!0);oe!==ue;)se[le++]=oe++;ae[oe+e.readInt(!0)]=oe++}for(;oe<te;)se[le++]=oe++;for(var ce=te-1;ce>=0;ce--)-1===ae[ce]&&(ae[ce]=se[--le]);$t.setFrame(ee,re,ae)}a.push($t),o=Math.max(o,$t.frames[Qt-1])}var fe=e.readInt(!0);if(fe>0){for(var de=new J(fe),ve=0;ve<fe;ve++){var me=e.readFloat(),ge=n.events[e.readInt(!0)],pe=new kt(me,ge);pe.intValue=e.readInt(!1),pe.floatValue=e.readFloat(),pe.stringValue=e.readBoolean()?e.readString():ge.stringValue,null!=pe.data.audioPath&&(pe.volume=e.readFloat(),pe.balance=e.readFloat()),de.setFrame(ve,pe)}a.push(de),o=Math.max(o,de.frames[fe-1])}return new X(r,a,o)}},{key:"readCurve",value:function(e,r,n){switch(e.readByte()){case t.CURVE_STEPPED:n.setStepped(r);break;case t.CURVE_BEZIER:this.setCurve(n,r,e.readFloat(),e.readFloat(),e.readFloat(),e.readFloat())}}},{key:"setCurve",value:function(t,e,r,n,a,i){t.setCurve(e,r,n,a,i)}}]),t}();Lt.AttachmentTypeValues=[0,1,2,3,4,5,6],Lt.TransformModeValues=[pt.Normal,pt.OnlyTranslation,pt.NoRotationOrReflection,pt.NoScale,pt.NoScaleOrReflection],Lt.PositionModeValues=[St.Fixed,St.Percent],Lt.SpacingModeValues=[_t.Length,_t.Fixed,_t.Percent],Lt.RotateModeValues=[It.Tangent,It.Chain,It.ChainScale],Lt.BlendModeValues=[gt.Normal,gt.Additive,gt.Multiply,gt.Screen],Lt.BONE_ROTATE=0,Lt.BONE_TRANSLATE=1,Lt.BONE_SCALE=2,Lt.BONE_SHEAR=3,Lt.SLOT_ATTACHMENT=0,Lt.SLOT_COLOR=1,Lt.SLOT_TWO_COLOR=2,Lt.PATH_POSITION=0,Lt.PATH_SPACING=1,Lt.PATH_MIX=2,Lt.CURVE_LINEAR=0,Lt.CURVE_STEPPED=1,Lt.CURVE_BEZIER=2;var Yt=function(){function t(r){var n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:[],a=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0,i=arguments[3];e(this,t),this.strings=n,this.index=a,this.buffer=i||new DataView(r.buffer)}return r(t,[{key:"readByte",value:function(){return this.buffer.getInt8(this.index++)}},{key:"readShort",value:function(){var t=this.buffer.getInt16(this.index);return this.index+=2,t}},{key:"readInt32",value:function(){var t=this.buffer.getInt32(this.index);return this.index+=4,t}},{key:"readInt",value:function(t){var e=this.readByte(),r=127&e;return 0!=(128&e)&&(r|=(127&(e=this.readByte()))<<7,0!=(128&e)&&(r|=(127&(e=this.readByte()))<<14,0!=(128&e)&&(r|=(127&(e=this.readByte()))<<21,0!=(128&e)&&(r|=(127&(e=this.readByte()))<<28)))),t?r:r>>>1^-(1&r)}},{key:"readStringRef",value:function(){var t=this.readInt(!0);return 0===t?null:this.strings[t-1]}},{key:"readString",value:function(){var t=this.readInt(!0);switch(t){case 0:return null;case 1:return""}t--;for(var e="",r=0;r<t;){var n=this.readByte();switch(n>>4){case 12:case 13:e+=String.fromCharCode((31&n)<<6|63&this.readByte()),r+=2;break;case 14:e+=String.fromCharCode((15&n)<<12|(63&this.readByte())<<6|63&this.readByte()),r+=3;break;default:e+=String.fromCharCode(n),r++}}return e}},{key:"readFloat",value:function(){var t=this.buffer.getFloat32(this.index);return this.index+=4,t}},{key:"readBoolean",value:function(){return 0!==this.readByte()}}]),t}(),Xt=function t(r,n,a,i,s){e(this,t),this.mesh=r,this.skin=n,this.slotIndex=a,this.parent=i,this.inheritDeform=s},Dt=function t(){var r=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null,n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;e(this,t),this.bones=r,this.vertices=n},Wt=function(){function t(){e(this,t),this.minX=0,this.minY=0,this.maxX=0,this.maxY=0,this.boundingBoxes=[],this.polygons=[[]],this.polygonPool=new b(function(){return A(16)})}return r(t,[{key:"update",value:function(t,e){if(null==t)throw new Error("skeleton cannot be null.");var r=this.boundingBoxes,n=this.polygons,a=this.polygonPool,i=t.slots,s=i.length;r.length=0,a.freeAll(n),n.length=0;for(var o=0;o<s;o++){var l=i[o];if(l.bone.active){var h=l.getAttachment();if(h instanceof ct){var u=h;r.push(u);var c=a.obtain();c.length!==u.worldVerticesLength&&(c=A(u.worldVerticesLength)),n.push(c),u.computeWorldVertices(l,0,u.worldVerticesLength,c,0,2)}}}e?this.aabbCompute():(this.minX=Number.POSITIVE_INFINITY,this.minY=Number.POSITIVE_INFINITY,this.maxX=Number.NEGATIVE_INFINITY,this.maxY=Number.NEGATIVE_INFINITY)}},{key:"aabbCompute",value:function(){for(var t=Number.POSITIVE_INFINITY,e=Number.POSITIVE_INFINITY,r=Number.NEGATIVE_INFINITY,n=Number.NEGATIVE_INFINITY,a=this.polygons,i=0,s=a.length;i<s;i++)for(var o=a[i],l=o,h=0,u=o.length;h<u;h+=2){var c=l[h],f=l[h+1];t=Math.min(t,c),e=Math.min(e,f),r=Math.max(r,c),n=Math.max(n,f)}this.minX=t,this.minY=e,this.maxX=r,this.maxY=n}},{key:"aabbContainsPoint",value:function(t,e){return t>=this.minX&&t<=this.maxX&&e>=this.minY&&e<=this.maxY}},{key:"aabbIntersectsSegment",value:function(t,e,r,n){var a=this.minX,i=this.minY,s=this.maxX,o=this.maxY;if(t<=a&&r<=a||e<=i&&n<=i||t>=s&&r>=s||e>=o&&n>=o)return!1;var l=(n-e)/(r-t),h=l*(a-t)+e;if(h>i&&h<o)return!0;if((h=l*(s-t)+e)>i&&h<o)return!0;var u=(i-e)/l+t;return u>a&&u<s||(u=(o-e)/l+t)>a&&u<s}},{key:"aabbIntersectsSkeleton",value:function(t){return this.minX<t.maxX&&this.maxX>t.minX&&this.minY<t.maxY&&this.maxY>t.minY}},{key:"containsPoint",value:function(t,e){for(var r=this.polygons,n=0,a=r.length;n<a;n++)if(this.containsPointPolygon(r[n],t,e))return this.boundingBoxes[n];return null}},{key:"containsPointPolygon",value:function(t,e,r){for(var n=t,a=t.length,i=a-2,s=!1,o=0;o<a;o+=2){var l=n[o+1],h=n[i+1];if(l<r&&h>=r||h<r&&l>=r){var u=n[o];u+(r-l)/(h-l)*(n[i]-u)<e&&(s=!s)}i=o}return s}},{key:"intersectsSegment",value:function(t,e,r,n){for(var a=this.polygons,i=0,s=a.length;i<s;i++)if(this.intersectsSegmentPolygon(a[i],t,e,r,n))return this.boundingBoxes[i];return null}},{key:"intersectsSegmentPolygon",value:function(t,e,r,n,a){for(var i=t,s=t.length,o=e-n,l=r-a,h=e*a-r*n,u=i[s-2],c=i[s-1],f=0;f<s;f+=2){var d=i[f],v=i[f+1],m=u*v-c*d,g=u-d,p=c-v,y=o*p-l*g,x=(h*g-o*m)/y;if((x>=u&&x<=d||x>=d&&x<=u)&&(x>=e&&x<=n||x>=n&&x<=e)){var b=(h*p-l*m)/y;if((b>=c&&b<=v||b>=v&&b<=c)&&(b>=r&&b<=a||b>=a&&b<=r))return!0}u=d,c=v}return!1}},{key:"getPolygon",value:function(t){if(null==t)throw new Error("boundingBox cannot be null.");var e=this.boundingBoxes.indexOf(t);return-1===e?null:this.polygons[e]}},{key:"getWidth",value:function(){return this.maxX-this.minX}},{key:"getHeight",value:function(){return this.maxY-this.minY}}]),t}(),Ut=function(){function t(){e(this,t),this.convexPolygons=[[]],this.convexPolygonsIndices=[[]],this.indicesArray=[],this.isConcaveArray=[],this.triangles=[],this.polygonPool=new b(function(){return[]}),this.polygonIndicesPool=new b(function(){return[]})}return r(t,[{key:"triangulate",value:function(e){var r=e,n=e.length>>1,a=this.indicesArray;a.length=0;for(var i=0;i<n;i++)a[i]=i;var s=this.isConcaveArray;s.length=0;for(var o=0,l=n;o<l;++o)s[o]=t.isConcave(o,n,r,a);var h=this.triangles;for(h.length=0;n>3;){for(var u=n-1,c=0,f=1;;){t:if(!s[c]){for(var d=a[u]<<1,v=a[c]<<1,m=a[f]<<1,g=r[d],p=r[d+1],y=r[v],x=r[v+1],b=r[m],k=r[m+1],w=(f+1)%n;w!==u;w=(w+1)%n)if(s[w]){var T=a[w]<<1,E=r[T],M=r[T+1];if(t.positiveArea(b,k,g,p,E,M)&&t.positiveArea(g,p,y,x,E,M)&&t.positiveArea(y,x,b,k,E,M))break t}break}if(0===f){do{if(!s[c])break;c--}while(c>0);break}u=c,c=f,f=(f+1)%n}h.push(a[(n+c-1)%n]),h.push(a[c]),h.push(a[(c+1)%n]),a.splice(c,1),s.splice(c,1);var S=(--n+c-1)%n,_=c===n?0:c;s[S]=t.isConcave(S,n,r,a),s[_]=t.isConcave(_,n,r,a)}return 3===n&&(h.push(a[2]),h.push(a[0]),h.push(a[1])),h}},{key:"decompose",value:function(e,r){var n=e,a=this.convexPolygons;this.polygonPool.freeAll(a),a.length=0;var i=this.convexPolygonsIndices;this.polygonIndicesPool.freeAll(i),i.length=0;var s=this.polygonIndicesPool.obtain();s.length=0;var o=this.polygonPool.obtain();o.length=0;for(var l=-1,h=0,u=0,c=r.length;u<c;u+=3){var f=r[u]<<1,d=r[u+1]<<1,v=r[u+2]<<1,m=n[f],g=n[f+1],p=n[d],y=n[d+1],x=n[v],b=n[v+1],k=!1;if(l===f){var w=o.length-4,T=t.winding(o[w],o[w+1],o[w+2],o[w+3],x,b),E=t.winding(x,b,o[0],o[1],o[2],o[3]);T===h&&E===h&&(o.push(x),o.push(b),s.push(v),k=!0)}k||(o.length>0?(a.push(o),i.push(s)):(this.polygonPool.free(o),this.polygonIndicesPool.free(s)),(o=this.polygonPool.obtain()).length=0,o.push(m),o.push(g),o.push(p),o.push(y),o.push(x),o.push(b),(s=this.polygonIndicesPool.obtain()).length=0,s.push(f),s.push(d),s.push(v),h=t.winding(m,g,p,y,x,b),l=f)}o.length>0&&(a.push(o),i.push(s));for(var M=0,S=a.length;M<S;M++)if(0!==(s=i[M]).length)for(var _=s[0],I=s[s.length-1],R=(o=a[M]).length-4,A=o[R],C=o[R+1],P=o[R+2],V=o[R+3],O=o[0],N=o[1],F=o[2],B=o[3],L=t.winding(A,C,P,V,O,N),Y=0;Y<S;Y++)if(Y!==M){var X=i[Y];if(3===X.length){var D=X[0],W=X[1],U=X[2],G=a[Y],q=G[G.length-2],j=G[G.length-1];if(D===_&&W===I){var H=t.winding(A,C,P,V,q,j),z=t.winding(q,j,O,N,F,B);H===L&&z===L&&(G.length=0,X.length=0,o.push(q),o.push(j),s.push(U),A=P,C=V,P=q,V=j,Y=0)}}}for(var Z=a.length-1;Z>=0;Z--)0===(o=a[Z]).length&&(a.splice(Z,1),this.polygonPool.free(o),s=i[Z],i.splice(Z,1),this.polygonIndicesPool.free(s));return a}}],[{key:"isConcave",value:function(t,e,r,n){var a=n[(e+t-1)%e]<<1,i=n[t]<<1,s=n[(t+1)%e]<<1;return!this.positiveArea(r[a],r[a+1],r[i],r[i+1],r[s],r[s+1])}},{key:"positiveArea",value:function(t,e,r,n,a,i){return t*(i-n)+r*(e-i)+a*(n-e)>=0}},{key:"winding",value:function(t,e,r,n,a,i){var s=r-t,o=n-e;return a*o-i*s+s*e-t*o>=0?1:-1}}]),t}(),Gt=function(){function t(){e(this,t),this.triangulator=new Ut,this.clippingPolygon=[],this.clipOutput=[],this.clippedVertices=[],this.clippedTriangles=[],this.scratch=[],this.clippingPolygons=[[]]}return r(t,[{key:"clipStart",value:function(e,r){if(null!=this.clipAttachment)return 0;this.clipAttachment=r;var n=r.worldVerticesLength,a=_(this.clippingPolygon,n);r.computeWorldVertices(e,0,n,a,0,2);var i=this.clippingPolygon;t.makeClockwise(i);for(var s=this.clippingPolygons=this.triangulator.decompose(i,this.triangulator.triangulate(i)),o=0,l=s.length;o<l;o++){var h=s[o];t.makeClockwise(h),h.push(h[0]),h.push(h[1])}return s.length}},{key:"clipEndWithSlot",value:function(t){null!=this.clipAttachment&&this.clipAttachment.endSlot===t.data&&this.clipEnd()}},{key:"clipEnd",value:function(){null!=this.clipAttachment&&(this.clipAttachment=null,this.clippingPolygons=null,this.clippedVertices.length=0,this.clippedTriangles.length=0,this.clippingPolygon.length=0)}},{key:"isClipping",value:function(){return null!=this.clipAttachment}},{key:"clipTriangles",value:function(t,e,r,n,a,i,s,o){var l=this.clipOutput,h=this.clippedVertices,u=this.clippedTriangles,c=this.clippingPolygons,f=this.clippingPolygons.length,d=o?12:8,v=0;h.length=0,u.length=0;t:for(var m=0;m<n;m+=3)for(var g=r[m]<<1,p=t[g],y=t[g+1],x=a[g],b=a[g+1],k=t[g=r[m+1]<<1],w=t[g+1],T=a[g],E=a[g+1],M=t[g=r[m+2]<<1],S=t[g+1],I=a[g],R=a[g+1],A=0;A<f;A++){var C=h.length;if(!this.clip(p,y,k,w,M,S,c[A],l)){var P=_(h,C+3*d);P[C]=p,P[C+1]=y,P[C+2]=i.r,P[C+3]=i.g,P[C+4]=i.b,P[C+5]=i.a,o?(P[C+6]=x,P[C+7]=b,P[C+8]=s.r,P[C+9]=s.g,P[C+10]=s.b,P[C+11]=s.a,P[C+12]=k,P[C+13]=w,P[C+14]=i.r,P[C+15]=i.g,P[C+16]=i.b,P[C+17]=i.a,P[C+18]=T,P[C+19]=E,P[C+20]=s.r,P[C+21]=s.g,P[C+22]=s.b,P[C+23]=s.a,P[C+24]=M,P[C+25]=S,P[C+26]=i.r,P[C+27]=i.g,P[C+28]=i.b,P[C+29]=i.a,P[C+30]=I,P[C+31]=R,P[C+32]=s.r,P[C+33]=s.g,P[C+34]=s.b,P[C+35]=s.a):(P[C+6]=x,P[C+7]=b,P[C+8]=k,P[C+9]=w,P[C+10]=i.r,P[C+11]=i.g,P[C+12]=i.b,P[C+13]=i.a,P[C+14]=T,P[C+15]=E,P[C+16]=M,P[C+17]=S,P[C+18]=i.r,P[C+19]=i.g,P[C+20]=i.b,P[C+21]=i.a,P[C+22]=I,P[C+23]=R);var V=_(u,(C=u.length)+3);V[C]=v,V[C+1]=v+1,V[C+2]=v+2,v+=3;continue t}var O=l.length;if(0!==O){for(var N=w-S,F=M-k,B=p-M,L=S-y,Y=1/(N*B+F*(y-S)),X=O>>1,D=this.clipOutput,W=_(h,C+X*d),U=0;U<O;U+=2){var G=D[U],q=D[U+1];W[C]=G,W[C+1]=q,W[C+2]=i.r,W[C+3]=i.g,W[C+4]=i.b,W[C+5]=i.a;var j=G-M,H=q-S,z=(N*j+F*H)*Y,Z=(L*j+B*H)*Y,K=1-z-Z;W[C+6]=x*z+T*Z+I*K,W[C+7]=b*z+E*Z+R*K,o&&(W[C+8]=s.r,W[C+9]=s.g,W[C+10]=s.b,W[C+11]=s.a),C+=d}var J=_(u,(C=u.length)+3*(X-2));X--;for(var Q=1;Q<X;Q++)J[C]=v,J[C+1]=v+Q,J[C+2]=v+Q+1,C+=3;v+=X+1}}}},{key:"clip",value:function(t,e,r,n,a,i,s,o){var l=o,h=!1,u=null;s.length%4>=2?(u=o,o=this.scratch):u=this.scratch,u.length=0,u.push(t),u.push(e),u.push(r),u.push(n),u.push(a),u.push(i),u.push(t),u.push(e),o.length=0;for(var c=s,f=s.length-4,d=0;;d+=2){for(var v=c[d],m=c[d+1],g=c[d+2],p=c[d+3],y=v-g,x=m-p,b=u,k=u.length-2,w=o.length,T=0;T<k;T+=2){var E=b[T],M=b[T+1],S=b[T+2],_=b[T+3],I=y*(_-p)-x*(S-g)>0;if(y*(M-p)-x*(E-g)>0){if(I){o.push(S),o.push(_);continue}var R=_-M,A=S-E,C=(A*(m-M)-R*(v-E))/(R*(g-v)-A*(p-m));o.push(v+(g-v)*C),o.push(m+(p-m)*C)}else if(I){var P=_-M,V=S-E,O=(V*(m-M)-P*(v-E))/(P*(g-v)-V*(p-m));o.push(v+(g-v)*O),o.push(m+(p-m)*O),o.push(S),o.push(_)}h=!0}if(w===o.length)return l.length=0,!0;if(o.push(o[0]),o.push(o[1]),d===f)break;var N=o;(o=u).length=0,u=N}if(l!==o){l.length=0;for(var F=0,B=o.length-2;F<B;F++)l[F]=o[F]}else l.length=l.length-2;return h}}],[{key:"makeClockwise",value:function(t){for(var e=t,r=t.length,n=e[r-2]*e[1]-e[0]*e[r-1],a=0,i=0,s=0,o=0,l=r-3;o<l;o+=2)a=e[o],i=e[o+1],s=e[o+2],n+=a*e[o+3]-s*i;if(!(n<0))for(var h=0,u=r-2,c=r>>1;h<c;h+=2){var f=e[h],d=e[h+1],v=u-h;e[h]=e[v],e[h+1]=e[v+1],e[v]=f,e[v+1]=d}}}]),t}(),qt=function(){function t(r){e(this,t),this.scale=1,this.linkedMeshes=[],this.attachmentLoader=r}return r(t,[{key:"readSkeletonData",value:function(e){var r=this.scale,n=new Ot,a="string"==typeof e?JSON.parse(e):e,i=a.skeleton;if(null!=i&&(n.hash=i.hash,n.version=i.spine,"3.8"!==n.version.substr(0,3)&&console.error("TinyJS Spine plugin supports only format for Spine 3.8. Your model has version "+i.spine+"."),"3.8.75"===n.version&&console.error("Unsupported skeleton data, 3.8.75 is deprecated, please export with a newer version of Spine."),n.x=i.x,n.y=i.y,n.width=i.width,n.height=i.height,n.fps=i.fps,n.imagesPath=i.images),a.bones)for(var o=0;o<a.bones.length;o++){var l=a.bones[o],h=null,u=this.getValue(l,"parent",null);if(null!=u&&null==(h=n.findBone(u)))throw new Error("Parent bone not found: "+u);var c=new yt(n.bones.length,l.name,h);c.length=this.getValue(l,"length",0)*r,c.x=this.getValue(l,"x",0)*r,c.y=this.getValue(l,"y",0)*r,c.rotation=this.getValue(l,"rotation",0),c.scaleX=this.getValue(l,"scaleX",1),c.scaleY=this.getValue(l,"scaleY",1),c.shearX=this.getValue(l,"shearX",0),c.shearY=this.getValue(l,"shearY",0),c.transformMode=t.transformModeFromString(this.getValue(l,"transform","normal")),c.skinRequired=this.getValue(l,"skin",!1),n.bones.push(c)}if(a.slots)for(var f=0;f<a.slots.length;f++){var d=a.slots[f],v=d.name,m=d.bone,g=n.findBone(m);if(null==g)throw new Error("Slot bone not found: "+m);var p=new Nt(n.slots.length,v,g),y=this.getValue(d,"color",null);null!=y&&p.color.setFromString(y);var x=this.getValue(d,"dark",null);null!=x&&(p.darkColor=new s(1,1,1,1),p.darkColor.setFromString(x)),p.attachmentName=this.getValue(d,"attachment",null),p.blendMode=t.blendModeFromString(this.getValue(d,"blend","normal")),n.slots.push(p)}if(a.ik)for(var b=0;b<a.ik.length;b++){var k=a.ik[b],w=new Et(k.name);w.order=this.getValue(k,"order",0),w.skinRequired=this.getValue(k,"skin",!1);for(var T=0;T<k.bones.length;T++){var E=k.bones[T],M=n.findBone(E);if(null==M)throw new Error("IK bone not found: "+E);w.bones.push(M)}var S=k.target;if(w.target=n.findBone(S),null==w.target)throw new Error("IK target bone not found: "+S);w.mix=this.getValue(k,"mix",1),w.softness=this.getValue(k,"softness",0)*r,w.bendDirection=this.getValue(k,"bendPositive",!0)?1:-1,w.compress=this.getValue(k,"compress",!1),w.stretch=this.getValue(k,"stretch",!1),w.uniform=this.getValue(k,"uniform",!1),n.ikConstraints.push(w)}if(a.transform)for(var _=0;_<a.transform.length;_++){var I=a.transform[_],R=new Vt(I.name);R.order=this.getValue(I,"order",0),R.skinRequired=this.getValue(I,"skin",!1);for(var A=0;A<I.bones.length;A++){var C=I.bones[A],P=n.findBone(C);if(null==P)throw new Error("Transform constraint bone not found: "+C);R.bones.push(P)}var V=I.target;if(R.target=n.findBone(V),null==R.target)throw new Error("Transform constraint target bone not found: "+V);R.local=this.getValue(I,"local",!1),R.relative=this.getValue(I,"relative",!1),R.offsetRotation=this.getValue(I,"rotation",0),R.offsetX=this.getValue(I,"x",0)*r,R.offsetY=this.getValue(I,"y",0)*r,R.offsetScaleX=this.getValue(I,"scaleX",0),R.offsetScaleY=this.getValue(I,"scaleY",0),R.offsetShearY=this.getValue(I,"shearY",0),R.rotateMix=this.getValue(I,"rotateMix",1),R.translateMix=this.getValue(I,"translateMix",1),R.scaleMix=this.getValue(I,"scaleMix",1),R.shearMix=this.getValue(I,"shearMix",1),n.transformConstraints.push(R)}if(a.path)for(var O=0;O<a.path.length;O++){var N=a.path[O],F=new Mt(N.name);F.order=this.getValue(N,"order",0),F.skinRequired=this.getValue(N,"skin",!1);for(var B=0;B<N.bones.length;B++){var L=N.bones[B],Y=n.findBone(L);if(null==Y)throw new Error("Transform constraint bone not found: "+L);F.bones.push(Y)}var X=N.target;if(F.target=n.findSlot(X),null==F.target)throw new Error("Path target slot not found: "+X);F.positionMode=t.positionModeFromString(this.getValue(N,"positionMode","percent")),F.spacingMode=t.spacingModeFromString(this.getValue(N,"spacingMode","length")),F.rotateMode=t.rotateModeFromString(this.getValue(N,"rotateMode","tangent")),F.offsetRotation=this.getValue(N,"rotation",0),F.position=this.getValue(N,"position",0),F.positionMode===St.Fixed&&(F.position*=r),F.spacing=this.getValue(N,"spacing",0),F.spacingMode!==_t.Length&&F.spacingMode!==_t.Fixed||(F.spacing*=r),F.rotateMix=this.getValue(N,"rotateMix",1),F.translateMix=this.getValue(N,"translateMix",1),n.pathConstraints.push(F)}if(a.skins)for(var D=0;D<a.skins.length;D++){var W=a.skins[D],U=new Bt(W.name);if(W.bones)for(var G=0;G<W.bones.length;G++){var q=n.findBone(W.bones[G]);if(null==q)throw new Error("Skin bone not found: "+W.bones[D]);U.bones.push(q)}if(W.ik)for(var j=0;j<W.ik.length;j++){var H=n.findIKConstraint(W.ik[j]);if(null==H)throw new Error("Skin IK constraint not found: "+W.ik[D]);U.constraints.push(H)}if(W.transform)for(var z=0;z<W.transform.length;z++){var Z=n.findTransformConstraint(W.transform[z]);if(null==Z)throw new Error("Skin transform constraint not found: "+W.transform[D]);U.constraints.push(Z)}if(W.path)for(var K=0;K<W.path.length;K++){var J=n.findPathConstraint(W.path[K]);if(null==J)throw new Error("Skin path constraint not found: "+W.path[D]);U.constraints.push(J)}for(var Q in W.attachments){var $=n.findSlot(Q);if(null==$)throw new Error("Slot not found: "+Q);var tt=W.attachments[Q];for(var et in tt){var rt=this.readAttachment(tt[et],U,$.index,et,n);null!=rt&&U.setAttachment($.index,et,rt)}}n.skins.push(U),"default"===U.name&&(n.defaultSkin=U)}for(var nt=0,at=this.linkedMeshes.length;nt<at;nt++){var it=this.linkedMeshes[nt],st=null==it.skin?n.defaultSkin:n.findSkin(it.skin);if(null==st)throw new Error("Skin not found: "+it.skin);var ot=st.getAttachment(it.slotIndex,it.parent);if(null==ot)throw new Error("Parent mesh not found: "+it.parent);it.mesh.deformAttachment=it.inheritDeform?ot:it.mesh,it.mesh.setParentMesh(ot)}if(this.linkedMeshes.length=0,a.events)for(var lt in a.events){var ht=a.events[lt],ut=new wt(lt);ut.intValue=this.getValue(ht,"int",0),ut.floatValue=this.getValue(ht,"float",0),ut.stringValue=this.getValue(ht,"string",""),ut.audioPath=this.getValue(ht,"audio",null),null!=ut.audioPath&&(ut.volume=this.getValue(ht,"volume",1),ut.balance=this.getValue(ht,"balance",0)),n.events.push(ut)}if(a.animations)for(var ct in a.animations){var ft=a.animations[ct];this.readAnimation(ft,ct,n)}return n}},{key:"readAttachment",value:function(t,e,r,n,a){var i=this.scale;switch(n=this.getValue(t,"name",n),this.getValue(t,"type","region")){case"region":var s=this.getValue(t,"path",n),o=this.attachmentLoader.newRegionAttachment(e,n,s);if(null==o)return null;o.path=s,o.x=this.getValue(t,"x",0)*i,o.y=this.getValue(t,"y",0)*i,o.scaleX=this.getValue(t,"scaleX",1),o.scaleY=this.getValue(t,"scaleY",1),o.rotation=this.getValue(t,"rotation",0),o.width=t.width*i,o.height=t.height*i;var l=this.getValue(t,"color",null);return null!=l&&o.color.setFromString(l),o.updateOffset(),o;case"boundingbox":var h=this.attachmentLoader.newBoundingBoxAttachment(e,n);if(null==h)return null;this.readVertices(t,h,t.vertexCount<<1);var u=this.getValue(t,"color",null);return null!=u&&h.color.setFromString(u),h;case"mesh":case"linkedmesh":var c=this.getValue(t,"path",n),f=this.attachmentLoader.newMeshAttachment(e,n,c);if(null==f)return null;f.path=c;var d=this.getValue(t,"color",null);null!=d&&f.color.setFromString(d),f.width=this.getValue(t,"width",0)*i,f.height=this.getValue(t,"height",0)*i;var v=this.getValue(t,"parent",null);if(null!=v)return this.linkedMeshes.push(new jt(f,this.getValue(t,"skin",null),r,v,this.getValue(t,"deform",!0))),f;var m=t.uvs;return this.readVertices(t,f,m.length),f.triangles=t.triangles,f.regionUVs=new Float32Array(m),f.edges=this.getValue(t,"edges",null),f.hullLength=2*this.getValue(t,"hull",0),f;case"path":var g=this.attachmentLoader.newPathAttachment(e,n);if(null==g)return null;g.closed=this.getValue(t,"closed",!1),g.constantSpeed=this.getValue(t,"constantSpeed",!0);var p=t.vertexCount;this.readVertices(t,g,p<<1);for(var y=R(p/3,0),x=0;x<t.lengths.length;x++)y[x]=t.lengths[x]*i;g.lengths=y;var b=this.getValue(t,"color",null);return null!=b&&g.color.setFromString(b),g;case"point":var k=this.attachmentLoader.newPointAttachment(e,n);if(null==k)return null;k.x=this.getValue(t,"x",0)*i,k.y=this.getValue(t,"y",0)*i,k.rotation=this.getValue(t,"rotation",0);var w=this.getValue(t,"color",null);return null!=w&&k.color.setFromString(w),k;case"clipping":var T=this.attachmentLoader.newClippingAttachment(e,n);if(null==T)return null;var E=this.getValue(t,"end",null);if(null!=E){var M=a.findSlot(E);if(null==M)throw new Error("Clipping end slot not found: "+E);T.endSlot=M}var S=t.vertexCount;this.readVertices(t,T,S<<1);var _=this.getValue(t,"color",null);return null!=_&&T.color.setFromString(_),T}return null}},{key:"readVertices",value:function(t,e,r){var n=this.scale;e.worldVerticesLength=r;var a=t.vertices;if(r!==a.length){for(var i=[],s=[],o=0,l=a.length;o<l;){var h=a[o++];s.push(h);for(var u=o+4*h;o<u;o+=4)s.push(a[o]),i.push(a[o+1]*n),i.push(a[o+2]*n),i.push(a[o+3])}e.bones=s,e.vertices=C(i)}else{var c=C(a);if(1!==n)for(var f=0,d=a.length;f<d;f++)c[f]*=n;e.vertices=c}}},{key:"readAnimation",value:function(t,e,r){var n=this.scale,a=[],i=0;if(t.slots)for(var o in t.slots){var l=t.slots[o],h=r.findSlotIndex(o);if(-1===h)throw new Error("Slot not found: "+o);for(var u in l){var c=l[u];if("attachment"===u){var f=new z(c.length);f.slotIndex=h;for(var d=0,v=0;v<c.length;v++){var m=c[v];f.setFrame(d++,this.getValue(m,"time",0),m.name)}a.push(f),i=Math.max(i,f.frames[f.getFrameCount()-1])}else if("color"===u){var g=new j(c.length);g.slotIndex=h;for(var p=0,y=0;y<c.length;y++){var x=c[y],b=new s;b.setFromString(x.color||"ffffffff"),g.setFrame(p,this.getValue(x,"time",0),b.r,b.g,b.b,b.a),this.readCurve(x,g,p),p++}a.push(g),i=Math.max(i,g.frames[(g.getFrameCount()-1)*j.ENTRIES])}else{if("twoColor"!==u)throw new Error("Invalid timeline type for a slot: "+u+" ("+o+")");var k=new H(c.length);k.slotIndex=h;for(var w=0,T=0;T<c.length;T++){var E=c[T],M=new s,_=new s;M.setFromString(E.light),_.setFromString(E.dark),k.setFrame(w,this.getValue(E,"time",0),M.r,M.g,M.b,M.a,_.r,_.g,_.b),this.readCurve(E,k,w),w++}a.push(k),i=Math.max(i,k.frames[(k.getFrameCount()-1)*H.ENTRIES])}}}if(t.bones)for(var I in t.bones){var C=t.bones[I],V=r.findBoneIndex(I);if(-1===V)throw new Error("Bone not found: "+I);for(var O in C){var N=C[O];if("rotate"===O){var F=new W(N.length);F.boneIndex=V;for(var B=0,L=0;L<N.length;L++){var Y=N[L];F.setFrame(B,this.getValue(Y,"time",0),this.getValue(Y,"angle",0)),this.readCurve(Y,F,B),B++}a.push(F),i=Math.max(i,F.frames[(F.getFrameCount()-1)*W.ENTRIES])}else{if("translate"!==O&&"scale"!==O&&"shear"!==O)throw new Error("Invalid timeline type for a bone: "+O+" ("+I+")");var D=null,Z=1,at=0;"scale"===O?(D=new G(N.length),at=1):"shear"===O?D=new q(N.length):(D=new U(N.length),Z=n),D.boneIndex=V;for(var it=0,st=0;st<N.length;st++){var ot=N[st],lt=this.getValue(ot,"x",at),ht=this.getValue(ot,"y",at);D.setFrame(it,this.getValue(ot,"time",0),lt*Z,ht*Z),this.readCurve(ot,D,it),it++}a.push(D),i=Math.max(i,D.frames[(D.getFrameCount()-1)*U.ENTRIES])}}}if(t.ik)for(var ut in t.ik){var ct=t.ik[ut],ft=r.findIKConstraint(ut),dt=new $(ct.length);dt.ikConstraintIndex=r.ikConstraints.indexOf(ft);for(var vt=0,mt=0;mt<ct.length;mt++){var gt=ct[mt];dt.setFrame(vt,this.getValue(gt,"time",0),this.getValue(gt,"mix",1),this.getValue(gt,"softness",0)*n,this.getValue(gt,"bendPositive",!0)?1:-1,this.getValue(gt,"compress",!1),this.getValue(gt,"stretch",!1)),this.readCurve(gt,dt,vt),vt++}a.push(dt),i=Math.max(i,dt.frames[(dt.getFrameCount()-1)*$.ENTRIES])}if(t.transform)for(var pt in t.transform){var yt=t.transform[pt],xt=r.findTransformConstraint(pt),bt=new tt(yt.length);bt.transformConstraintIndex=r.transformConstraints.indexOf(xt);for(var wt=0,Tt=0;Tt<yt.length;Tt++){var Et=yt[Tt];bt.setFrame(wt,this.getValue(Et,"time",0),this.getValue(Et,"rotateMix",1),this.getValue(Et,"translateMix",1),this.getValue(Et,"scaleMix",1),this.getValue(Et,"shearMix",1)),this.readCurve(Et,bt,wt),wt++}a.push(bt),i=Math.max(i,bt.frames[(bt.getFrameCount()-1)*tt.ENTRIES])}if(t.path)for(var Mt in t.path){var It=t.path[Mt],Rt=r.findPathConstraintIndex(Mt);if(-1===Rt)throw new Error("Path constraint not found: "+Mt);var At=r.pathConstraints[Rt];for(var Ct in It){var Pt=It[Ct];if("position"===Ct||"spacing"===Ct){var Vt=null,Ot=1;"spacing"===Ct?(Vt=new rt(Pt.length),At.spacingMode!==_t.Length&&At.spacingMode!==_t.Fixed||(Ot=n)):(Vt=new et(Pt.length),At.positionMode===St.Fixed&&(Ot=n)),Vt.pathConstraintIndex=Rt;for(var Nt=0,Ft=0;Ft<Pt.length;Ft++){var Bt=Pt[Ft];Vt.setFrame(Nt,this.getValue(Bt,"time",0),this.getValue(Bt,Ct,0)*Ot),this.readCurve(Bt,Vt,Nt),Nt++}a.push(Vt),i=Math.max(i,Vt.frames[(Vt.getFrameCount()-1)*et.ENTRIES])}else if("mix"===Ct){var Lt=new nt(Pt.length);Lt.pathConstraintIndex=Rt;for(var Yt=0,Xt=0;Xt<Pt.length;Xt++){var Dt=Pt[Xt];Lt.setFrame(Yt,this.getValue(Dt,"time",0),this.getValue(Dt,"rotateMix",1),this.getValue(Dt,"translateMix",1)),this.readCurve(Dt,Lt,Yt),Yt++}a.push(Lt),i=Math.max(i,Lt.frames[(Lt.getFrameCount()-1)*nt.ENTRIES])}}}if(t.deform)for(var Wt in t.deform){var Ut=t.deform[Wt],Gt=r.findSkin(Wt);if(null!=Gt)for(var qt in Ut){var jt=Ut[qt],Ht=r.findSlotIndex(qt);if(-1===Ht)throw new Error("Slot not found: "+jt.name);for(var zt in jt){var Zt=jt[zt],Kt=Gt.getAttachment(Ht,zt);if(null==Kt)throw new Error("Deform attachment not found: "+Zt.name);var Jt=null!=Kt.bones,Qt=Kt.vertices,$t=Jt?Qt.length/3*2:Qt.length,te=new K(Zt.length);te.slotIndex=Ht,te.attachment=Kt;for(var ee=0,re=0;re<Zt.length;re++){var ne=Zt[re],ae=void 0,ie=this.getValue(ne,"vertices",null);if(null==ie)ae=Jt?A($t):Qt;else{ae=A($t);var se=this.getValue(ne,"offset",0);if(S(ie,0,ae,se,ie.length),1!==n)for(var oe=se,le=oe+ie.length;oe<le;oe++)ae[oe]*=n;if(!Jt)for(var he=0;he<$t;he++)ae[he]+=Qt[he]}te.setFrame(ee,this.getValue(ne,"time",0),ae),this.readCurve(ne,te,ee),ee++}a.push(te),i=Math.max(i,te.frames[te.getFrameCount()-1])}}}var ue=t.drawOrder;if(null==ue&&(ue=t.draworder),null!=ue){for(var ce=new Q(ue.length),fe=r.slots.length,de=0,ve=0;ve<ue.length;ve++){var me=ue[ve],ge=null,pe=this.getValue(me,"offsets",null);if(null!=pe){ge=R(fe,-1);for(var ye=R(fe-pe.length,0),xe=0,be=0,ke=0;ke<pe.length;ke++){var we=pe[ke],Te=r.findSlotIndex(we.slot);if(-1===Te)throw new Error("Slot not found: "+we.slot);for(;xe!==Te;)ye[be++]=xe++;ge[xe+we.offset]=xe++}for(;xe<fe;)ye[be++]=xe++;for(var Ee=fe-1;Ee>=0;Ee--)-1===ge[Ee]&&(ge[Ee]=ye[--be])}ce.setFrame(de++,this.getValue(me,"time",0),ge)}a.push(ce),i=Math.max(i,ce.frames[ce.getFrameCount()-1])}if(t.events){for(var Me=new J(t.events.length),Se=0,_e=0;_e<t.events.length;_e++){var Ie=t.events[_e],Re=r.findEvent(Ie.name);if(null==Re)throw new Error("Event not found: "+Ie.name);var Ae=new kt(P(this.getValue(Ie,"time",0)),Re);Ae.intValue=this.getValue(Ie,"int",Re.intValue),Ae.floatValue=this.getValue(Ie,"float",Re.floatValue),Ae.stringValue=this.getValue(Ie,"string",Re.stringValue),null!=Ae.data.audioPath&&(Ae.volume=this.getValue(Ie,"volume",1),Ae.balance=this.getValue(Ie,"balance",0)),Me.setFrame(Se++,Ae)}a.push(Me),i=Math.max(i,Me.frames[Me.getFrameCount()-1])}if(isNaN(i))throw new Error("Error while parsing animation, duration is NaN");r.animations.push(new X(e,a,i))}},{key:"readCurve",value:function(t,e,r){if(t.hasOwnProperty("curve"))if("stepped"===t.curve)e.setStepped(r);else{var n=t.curve;e.setCurve(r,n,this.getValue(t,"c2",0),this.getValue(t,"c3",1),this.getValue(t,"c4",1))}}},{key:"getValue",value:function(t,e,r){return void 0!==t[e]?t[e]:r}}],[{key:"blendModeFromString",value:function(t){if("normal"===(t=t.toLowerCase()))return gt.Normal;if("additive"===t)return gt.Additive;if("multiply"===t)return gt.Multiply;if("screen"===t)return gt.Screen;throw new Error("Unknown blend mode: "+t)}},{key:"positionModeFromString",value:function(t){if("fixed"===(t=t.toLowerCase()))return St.Fixed;if("percent"===t)return St.Percent;throw new Error("Unknown position mode: "+t)}},{key:"spacingModeFromString",value:function(t){if("length"===(t=t.toLowerCase()))return _t.Length;if("fixed"===t)return _t.Fixed;if("percent"===t)return _t.Percent;throw new Error("Unknown position mode: "+t)}},{key:"rotateModeFromString",value:function(t){if("tangent"===(t=t.toLowerCase()))return It.Tangent;if("chain"===t)return It.Chain;if("chainscale"===t)return It.ChainScale;throw new Error("Unknown rotate mode: "+t)}},{key:"transformModeFromString",value:function(t){if("normal"===(t=t.toLowerCase()))return pt.Normal;if("onlytranslation"===t)return pt.OnlyTranslation;if("norotationorreflection"===t)return pt.NoRotationOrReflection;if("noscale"===t)return pt.NoScale;if("noscaleorreflection"===t)return pt.NoScaleOrReflection;throw new Error("Unknown transform mode: "+t)}}]),t}(),jt=function t(r,n,a,i,s){e(this,t),this.mesh=r,this.skin=n,this.slotIndex=a,this.parent=i,this.inheritDeform=s},Ht={Nearest:9728,Linear:9729,MipMap:9987,MipMapNearestNearest:9984,MipMapLinearNearest:9985,MipMapNearestLinear:9986,MipMapLinearLinear:9987},zt={MirroredRepeat:33648,ClampToEdge:33071,Repeat:10497},Zt=function(){function t(r){e(this,t),this._image=r}return r(t,[{key:"getImage",value:function(){return this._image}}],[{key:"filterFromString",value:function(t){switch(t.toLowerCase()){case"nearest":return Ht.Nearest;case"linear":return Ht.Linear;case"mipmap":return Ht.MipMap;case"mipmapnearestnearest":return Ht.MipMapNearestNearest;case"mipmaplinearnearest":return Ht.MipMapLinearNearest;case"mipmapnearestlinear":return Ht.MipMapNearestLinear;case"mipmaplinearlinear":return Ht.MipMapLinearLinear;default:throw new Error("Unknown texture filter "+t)}}},{key:"wrapFromString",value:function(t){switch(t.toLowerCase()){case"mirroredtepeat":return zt.MirroredRepeat;case"clamptoedge":return zt.ClampToEdge;case"repeat":return zt.Repeat;default:throw new Error("Unknown texture wrap "+t)}}}]),t}(),Kt=function(){function t(){e(this,t),this.size=null}return r(t,[{key:"width",get:function(){var t=this.texture;return t.trim?t.trim.width:t.orig.width}},{key:"height",get:function(){var t=this.texture;return t.trim?t.trim.height:t.orig.height}},{key:"u",get:function(){return this.texture._uvs.x0}},{key:"v",get:function(){return this.texture._uvs.y0}},{key:"u2",get:function(){return this.texture._uvs.x2}},{key:"v2",get:function(){return this.texture._uvs.y2}},{key:"offsetX",get:function(){var t=this.texture;return t.trim?t.trim.x:0}},{key:"offsetY",get:function(){return this.spineOffsetY}},{key:"tinyOffsetY",get:function(){var t=this.texture;return t.trim?t.trim.y:0}},{key:"spineOffsetY",get:function(){var t=this.texture;return this.originalHeight-this.height-(t.trim?t.trim.y:0)}},{key:"originalWidth",get:function(){return this.texture.orig.width}},{key:"originalHeight",get:function(){return this.texture.orig.height}},{key:"x",get:function(){return this.texture.frame.x}},{key:"y",get:function(){return this.texture.frame.y}},{key:"rotate",get:function(){return 0!==this.texture.rotate}}]),t}(),Jt=function(){function t(r,n,a){e(this,t),this.pages=[],this.regions=[],r&&this.addSpineAtlas(r,n,a)}return r(t,[{key:"addTexture",value:function(t,e){for(var r=this.pages,n=null,a=0;a<r.length;a++)if(r[a].baseTexture===e.baseTexture){n=r[a];break}if(null===n){(n=new Qt).name="texturePage";var i=e.baseTexture;n.width=i.realWidth,n.height=i.realHeight,n.baseTexture=i,n.minFilter=n.magFilter=Ht.Nearest,n.uWrap=zt.ClampToEdge,n.vWrap=zt.ClampToEdge,r.push(n)}var s=new $t;return s.name=t,s.page=n,s.texture=e,s.index=-1,this.regions.push(s),s}},{key:"addTextureHash",value:function(t,e){for(var r in t)t.hasOwnProperty(r)&&this.addTexture(e&&-1!==r.indexOf(".")?r.substr(0,r.lastIndexOf(".")):r,t[r])}},{key:"addSpineAtlas",value:function(t,e,r){return this.load(t,e,r)}},{key:"load",value:function(t,e,r){var n=this;if(null==e)throw new Error("textureLoader cannot be null.");var a=new te(t),i=new Array(4),s=null;!function t(){for(;;){var o=n,l=a.readLine();if(null==l)return r&&r(o);if(0===(l=l.trim()).length)s=null;else{if(!s){(s=new Qt).name=l,2===a.readTuple(i)&&(s.width=parseInt(i[0]),s.height=parseInt(i[1]),a.readTuple(i)),a.readTuple(i),s.minFilter=Zt.filterFromString(i[0]),s.magFilter=Zt.filterFromString(i[1]);var h=a.readValue();s.uWrap=zt.ClampToEdge,s.vWrap=zt.ClampToEdge,"x"===h?s.uWrap=zt.Repeat:"y"===h?s.vWrap=zt.Repeat:"xy"===h&&(s.uWrap=s.vWrap=zt.Repeat),e(l,function(e){if(null===e)return n.pages.splice(n.pages.indexOf(s),1),r&&r(null);s.baseTexture=e,e.hasLoaded||(e.width=s.width,e.height=s.height),n.pages.push(s),s.setFilters(),s.width&&s.height||(s.width=e.realWidth,s.height=e.realHeight,s.width&&s.height||console.log("ERROR spine atlas page "+s.name+": meshes wont work if you dont specify size in atlas (http://www.html5gamedevs.com/topic/18888-pixi-spines-and-meshes/?p=107121)")),t()}),n.pages.push(s);break}var u=new $t;u.name=l,u.page=s;var c=a.readValue(),f=0;f="true"===c.toLocaleLowerCase()?6:"false"===c.toLocaleLowerCase()?0:(720-parseFloat(c))%360/45,a.readTuple(i);var d=parseInt(i[0]),v=parseInt(i[1]);a.readTuple(i);var m=parseInt(i[0]),g=parseInt(i[1]),p=s.baseTexture.resolution;d/=p,v/=p,m/=p,g/=p;var y=f%4!=0,x=new Tiny.Rectangle(d,v,y?g:m,y?m:g);4===a.readTuple(i)&&4===a.readTuple(i)&&a.readTuple(i);var b=parseInt(i[0])/p,k=parseInt(i[1])/p;a.readTuple(i);var w=parseInt(i[0])/p,T=parseInt(i[1])/p,E=new Tiny.Rectangle(0,0,b,k),M=new Tiny.Rectangle(w,k-g-T,m,g);u.texture=new Tiny.Texture(u.page.baseTexture,x,E,M,f),u.index=parseInt(a.readValue()),u.texture._updateUvs(),n.regions.push(u)}}}()}},{key:"findRegion",value:function(t){for(var e=0;e<this.regions.length;e++)if(this.regions[e].name===t)return this.regions[e];return null}},{key:"dispose",value:function(){for(var t=0;t<this.pages.length;t++)this.pages[t].baseTexture.dispose()}}]),t}(),Qt=function(){function t(){e(this,t),this._=null}return r(t,[{key:"setFilters",value:function(){var t=this.baseTexture,e=this.minFilter;e===Ht.Linear?t.scaleMode=Tiny.SCALE_MODES.LINEAR:this.minFilter===Ht.Nearest?t.scaleMode=Tiny.SCALE_MODES.NEAREST:(t.mipmap=!0,t.scaleMode=e===Ht.MipMapNearestNearest?Tiny.SCALE_MODES.NEAREST:Tiny.SCALE_MODES.LINEAR)}}]),t}(),$t=function(t){function r(){return e(this,r),a(this,(r.__proto__||Object.getPrototypeOf(r)).call(this))}return n(r,Kt),r}(),te=function(){function t(r){e(this,t),this.index=0,this.lines=r.split(/\r\n|\r|\n/)}return r(t,[{key:"readLine",value:function(){return this.index>=this.lines.length?null:this.lines[this.index++]}},{key:"readValue",value:function(){var t=this.readLine(),e=t.indexOf(":");if(-1===e)throw new Error("Invalid line: "+t);return t.substring(e+1).trim()}},{key:"readTuple",value:function(t){var e=this.readLine(),r=e.indexOf(":");if(-1===r)throw new Error("Invalid line: "+e);for(var n=0,a=r+1;n<3;n++){var i=e.indexOf(",",a);if(-1===i)break;t[n]=e.substr(a,i-a).trim(),a=i+1}return t[n]=e.substring(a).trim(),n+1}}]),t}(),ee=function(){function t(){var r=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;e(this,t),this.jitterX=r,this.jitterY=n}return r(t,[{key:"begin",value:function(t){}},{key:"transform",value:function(t,e,r,n){t.x+=g(-this.jitterX,this.jitterY),t.y+=g(-this.jitterX,this.jitterY)}},{key:"end",value:function(){}}]),t}(),re=function(){function t(r){e(this,t),this.radius=r,this.centerX=0,this.centerY=0,this.radius=0,this.angle=0,this.worldX=0,this.worldY=0}return r(t,[{key:"begin",value:function(t){this.worldX=t.x+this.centerX,this.worldY=t.y+this.centerY}},{key:"transform",value:function(e,r,n,a){var i=.01745329277777778*this.angle,s=e.x-this.worldX,o=e.y-this.worldY,l=Math.sqrt(s*s+o*o);if(l<this.radius){var h=t.interpolation.apply(0,i,(this.radius-l)/this.radius),u=Math.cos(h),c=Math.sin(h);e.x=u*s-c*o+this.worldX,e.y=c*s+u*o+this.worldY}}},{key:"end",value:function(){}}]),t}();function ne(){var t=Tiny.loaders.Resource;return function(e,r){if(!e.data)return r();var n=function(t){return t.type===Tiny.loaders.Resource.TYPE.JSON}(e)&&e.data.bones,a=function(t){return t.xhrType===Tiny.loaders.Resource.XHR_RESPONSE_TYPE.BUFFER}(e)&&("skel"===e.extension||e.metadata.spineMetadata);if(!n&&!a)return r();var i=null,s=e.data;n?i=new qt(null):(i=new Lt(null),e.data instanceof ArrayBuffer&&(s=new Uint8Array(e.data)));var o=e.metadata||{},l=o?e.metadata.spineSkeletonScale:null;l&&(i.scale=l);var h=o?e.metadata.spineAtlas:null;if(!1===h)return r();if(h&&h.pages)return i.attachmentLoader=new mt(h),e.spineData=i.readSkeletonData(s),e.spineAtlas=h,r();var u=o.spineAtlasSuffix||".atlas",c=e.url,f=c.indexOf("?");f>0&&(c=c.substr(0,f)),c=c.substr(0,c.lastIndexOf("."))+u,e.metadata&&e.metadata.spineAtlasFile&&(c=e.metadata.spineAtlasFile),c=c.replace(this.baseUrl,"");var d={crossOrigin:e.crossOrigin,xhrType:t.XHR_RESPONSE_TYPE.TEXT,metadata:o.spineMetadata||null,parentResource:e},v={crossOrigin:e.crossOrigin,metadata:o.imageMetadata||null,parentResource:e},m=e.url.substr(0,e.url.lastIndexOf("/")+1);m=m.replace(this.baseUrl,"");var g=o.imageNamePrefix||e.name+"_atlas_page_",p=o.images?ie(o.images):o.image?ie({default:o.image}):o.imageLoader?o.imageLoader(this,g,m,v):ae(this,g,m,v),y=function(t){return new Jt(t,p,function(t){t&&(i.attachmentLoader=new mt(t),e.spineData=i.readSkeletonData(s),e.spineAtlas=t),r()})};e.metadata&&e.metadata.atlasRawData?y(e.metadata.atlasRawData):this.add(e.name+"_atlas",c,d,function(t){t.error?r():y(t.data)})}}function ae(t,e,r,n){return r&&r.lastIndexOf("/")!==r.length-1&&(r+="/"),function(a,i){var s=e+a,o=r+a,l=t.resources[s];function h(){i(l.texture.baseTexture)}l?l.texture?h():l.onAfterMiddleware.add(h):t.add(s,o,n,function(t){t.error?i(null):i(t.texture.baseTexture)})}}function ie(t){return function(e,r){var n=t[e]||t.default;n&&n.baseTexture?r(n.baseTexture):r(n)}}re.interpolation=new E(2),Tiny.loaders.Loader&&(Tiny.loaders.Loader.addTinyMiddleware(ne),Tiny.loaders.Resource.setExtensionXhrType("skel",Tiny.loaders.Resource.XHR_RESPONSE_TYPE.BUFFER));"undefined"!=typeof globalThis?globalThis:"undefined"!=typeof window?window:"undefined"!=typeof global?global:"undefined"!=typeof self&&self;var se,oe,le=(function(t,e){
/*!
   * Name: tinyjs-plugin-mesh
   * Description: The Tiny.js plugin of mesh
   * Author: yiiqii
   * Version: v1.3.1
   */
!function(t){var e=function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")},r=function(){function t(t,e){for(var r=0;r<e.length;r++){var n=e[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,n.key,n)}}return function(e,r,n){return r&&t(e.prototype,r),n&&t(e,n),e}}(),n=function t(e,r,n){null===e&&(e=Function.prototype);var a=Object.getOwnPropertyDescriptor(e,r);if(void 0===a){var i=Object.getPrototypeOf(e);return null===i?void 0:t(i,r,n)}if("value"in a)return a.value;var s=a.get;return void 0!==s?s.call(n):void 0},a=function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function, not "+typeof e);t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,enumerable:!1,writable:!0,configurable:!0}}),e&&(Object.setPrototypeOf?Object.setPrototypeOf(t,e):t.__proto__=e)},i=function(t,e){if(!t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!e||"object"!=typeof e&&"function"!=typeof e?t:e},s=new Tiny.Point,o=new Tiny.Polygon,l=function(t){function l(t,r,n,a,s){e(this,l);var o=i(this,(l.__proto__||Object.getPrototypeOf(l)).call(this));return o._texture=t||Tiny.Texture.EMPTY,o.uvs=n||new Float32Array([0,0,1,0,1,1,0,1]),o.vertices=r||new Float32Array([0,0,100,0,100,100,0,100]),o.indices=a||new Uint16Array([0,1,3,2]),o.dirty=0,o.indexDirty=0,o.vertexDirty=0,o.autoUpdate=!0,o.blendMode=Tiny.BLEND_MODES.NORMAL,o.canvasPadding=l.defaults.canvasPadding,o.drawMode=s||l.DRAW_MODES.TRIANGLE_MESH,o.shader=null,o.tintRgb=new Float32Array([1,1,1]),o._glDatas={},o._uvTransform=new Tiny.TextureTransform(o._texture),o.uploadUvTransform=!1,o.pluginName="mesh",o._canvasDrawTimes=1,o}return a(l,t),r(l,[{key:"_renderWebGL",value:function(t){this.refresh(),t.setObjectRenderer(t.plugins[this.pluginName]),t.plugins[this.pluginName].render(this)}},{key:"_renderCanvas",value:function(t){this.refresh(),t.plugins[this.pluginName].render(this)}},{key:"_onTextureUpdate",value:function(){this._uvTransform.texture=this._texture,this.refresh()}},{key:"multiplyUvs",value:function(){this.uploadUvTransform||this._uvTransform.multiplyUvs(this.uvs)}},{key:"refresh",value:function(t){this.autoUpdate&&this.vertexDirty++,this._uvTransform.update(t)&&this._refresh()}},{key:"_refresh",value:function(){}},{key:"_calculateBounds",value:function(){this._bounds.addVertices(this.transform,this.vertices,0,this.vertices.length)}},{key:"containsPoint",value:function(t){if(!this.getBounds().contains(t.x,t.y))return!1;this.worldTransform.applyInverse(t,s);for(var e=this.vertices,r=o.points,n=this.indices,a=this.indices.length,i=this.drawMode===l.DRAW_MODES.TRIANGLES?3:1,h=0;h+2<a;h+=i){var u=2*n[h],c=2*n[h+1],f=2*n[h+2];if(r[0]=e[u],r[1]=e[u+1],r[2]=e[c],r[3]=e[c+1],r[4]=e[f],r[5]=e[f+1],o.contains(s.x,s.y))return!0}return!1}},{key:"destroy",value:function(t){for(var e in this._glDatas){var r=this._glDatas[e];r.destroy?r.destroy():(r.vertexBuffer&&(r.vertexBuffer.destroy(),r.vertexBuffer=null),r.indexBuffer&&(r.indexBuffer.destroy(),r.indexBuffer=null),r.uvBuffer&&(r.uvBuffer.destroy(),r.uvBuffer=null),r.vao&&(r.vao.destroy(),r.vao=null))}this._glDatas=null,n(l.prototype.__proto__||Object.getPrototypeOf(l.prototype),"destroy",this).call(this,t)}},{key:"texture",get:function(){return this._texture},set:function(t){this._texture!==t&&(this._texture=t,t&&(t.baseTexture.hasLoaded?this._onTextureUpdate():t.once("update",this._onTextureUpdate,this)))}},{key:"tint",get:function(){return Tiny.rgb2hex(this.tintRgb)},set:function(t){this.tintRgb=Tiny.hex2rgb(t,this.tintRgb)}},{key:"canvasDrawTimes",get:function(){return this._canvasDrawTimes||1},set:function(t){this._canvasDrawTimes=t>10?10:(t<0?1:0|t)||1}}]),l}(Tiny.Container);l.DRAW_MODES={TRIANGLE_MESH:0,TRIANGLES:1},l.defaults={canvasPadding:0};var h=Tiny.glCore,u=Tiny.Matrix.IDENTITY,c=function(t){function n(t){e(this,n);var r=i(this,(n.__proto__||Object.getPrototypeOf(n)).call(this,t));return r.shader=null,r}return a(n,t),r(n,[{key:"onContextChange",value:function(){var t=this.renderer.gl;this.shader=new Tiny.Shader(t,"attribute vec2 aVertexPosition;\nattribute vec2 aTextureCoord;\n\nuniform mat3 projectionMatrix;\nuniform mat3 translationMatrix;\nuniform mat3 uTransform;\n\nvarying vec2 vTextureCoord;\n\nvoid main(void) {\n    gl_Position = vec4((projectionMatrix * translationMatrix * vec3(aVertexPosition, 1.0)).xy, 0.0, 1.0);\n\n    vTextureCoord = (uTransform * vec3(aTextureCoord, 1.0)).xy;\n}","varying vec2 vTextureCoord;\nuniform vec4 uColor;\n\nuniform sampler2D uSampler;\n\nvoid main(void) {\n    gl_FragColor = texture2D(uSampler, vTextureCoord) * uColor;\n}")}},{key:"render",value:function(t){var e=this.renderer,r=e.gl,n=t._texture;if(n.valid){var a=t._glDatas[e.CONTEXT_UID];a||(e.bindVao(null),(a={shader:this.shader,vertexBuffer:h.GLBuffer.createVertexBuffer(r,t.vertices,r.STREAM_DRAW),uvBuffer:h.GLBuffer.createVertexBuffer(r,t.uvs,r.STREAM_DRAW),indexBuffer:h.GLBuffer.createIndexBuffer(r,t.indices,r.STATIC_DRAW),vao:null,dirty:t.dirty,indexDirty:t.indexDirty,vertexDirty:t.vertexDirty}).vao=new h.VertexArrayObject(r).addIndex(a.indexBuffer).addAttribute(a.vertexBuffer,a.shader.attributes.aVertexPosition,r.FLOAT,!1,8,0).addAttribute(a.uvBuffer,a.shader.attributes.aTextureCoord,r.FLOAT,!1,8,0),t._glDatas[e.CONTEXT_UID]=a),e.bindVao(a.vao),t.dirty!==a.dirty&&(a.dirty=t.dirty,a.uvBuffer.upload(t.uvs)),t.indexDirty!==a.indexDirty&&(a.indexDirty=t.indexDirty,a.indexBuffer.upload(t.indices)),t.vertexDirty!==a.vertexDirty&&(a.vertexDirty=t.vertexDirty,a.vertexBuffer.upload(t.vertices)),e.bindShader(a.shader),a.shader.uniforms.uSampler=e.bindTexture(n),e.state.setBlendMode(Tiny.correctBlendMode(t.blendMode,n.baseTexture.premultipliedAlpha)),a.shader.uniforms.uTransform&&(t.uploadUvTransform?a.shader.uniforms.uTransform=t._uvTransform.mapCoord.toArray(!0):a.shader.uniforms.uTransform=u.toArray(!0)),a.shader.uniforms.translationMatrix=t.worldTransform.toArray(!0),a.shader.uniforms.uColor=Tiny.premultiplyRgba(t.tintRgb,t.worldAlpha,a.shader.uniforms.uColor,n.baseTexture.premultipliedAlpha);var i=t.drawMode===l.DRAW_MODES.TRIANGLE_MESH?r.TRIANGLE_STRIP:r.TRIANGLES;a.vao.draw(i,t.indices.length,0)}}}]),n}(Tiny.ObjectRenderer);Tiny.WebGLRenderer.registerPlugin("mesh",c);var f=function(){function t(r){e(this,t),this.renderer=r}return r(t,[{key:"render",value:function(t){var e=this.renderer,r=e.context,n=t.worldTransform,a=e.resolution;e.roundPixels?r.setTransform(n.a*a,n.b*a,n.c*a,n.d*a,n.tx*a|0,n.ty*a|0):r.setTransform(n.a*a,n.b*a,n.c*a,n.d*a,n.tx*a,n.ty*a),e.context.globalAlpha=t.worldAlpha,e.setBlendMode(t.blendMode),t.drawMode===l.DRAW_MODES.TRIANGLE_MESH?this._renderTriangleMesh(t):this._renderTriangles(t)}},{key:"_renderTriangleMesh",value:function(t){for(var e=t.vertices.length/2,r=0;r<e-2;r++){var n=2*r;this._renderDrawTriangle(t,n,n+2,n+4)}}},{key:"_renderTriangles",value:function(t){for(var e=t.indices,r=e.length,n=0;n<r;n+=3){var a=2*e[n],i=2*e[n+1],s=2*e[n+2];this._renderDrawTriangle(t,a,i,s)}}},{key:"_renderDrawTriangle",value:function(t,e,r,n){var a=this.renderer.context,i=t.uvs,s=t.vertices,o=t._texture;if(o.valid){var l=o.baseTexture,h=l.width,u=l.height,c=l.source,f=void 0,d=void 0,v=void 0,m=void 0,g=void 0,p=void 0;if(t.uploadUvTransform){var y=t._uvTransform.mapCoord;f=(i[e]*y.a+i[e+1]*y.c+y.tx)*l.width,d=(i[r]*y.a+i[r+1]*y.c+y.tx)*l.width,v=(i[n]*y.a+i[n+1]*y.c+y.tx)*l.width,m=(i[e]*y.b+i[e+1]*y.d+y.ty)*l.height,g=(i[r]*y.b+i[r+1]*y.d+y.ty)*l.height,p=(i[n]*y.b+i[n+1]*y.d+y.ty)*l.height}else f=i[e]*l.width,d=i[r]*l.width,v=i[n]*l.width,m=i[e+1]*l.height,g=i[r+1]*l.height,p=i[n+1]*l.height;var x=s[e],b=s[r],k=s[n],w=s[e+1],T=s[r+1],E=s[n+1],M=t.canvasPadding/this.renderer.resolution;if(M>0){var S=M/Math.abs(t.worldTransform.a),_=M/Math.abs(t.worldTransform.d),I=(x+b+k)/3,R=(w+T+E)/3,A=x-I,C=w-R,P=Math.sqrt(A*A+C*C);x=I+A/P*(P+S),w=R+C/P*(P+_),A=b-I,C=T-R,P=Math.sqrt(A*A+C*C),b=I+A/P*(P+S),T=R+C/P*(P+_),A=k-I,C=E-R,P=Math.sqrt(A*A+C*C),k=I+A/P*(P+S),E=R+C/P*(P+_)}a.save(),a.beginPath(),a.moveTo(x,w),a.lineTo(b,T),a.lineTo(k,E),a.closePath(),a.clip();var V=f*g+m*v+d*p-g*v-m*d-f*p,O=x*g+m*k+b*p-g*k-m*b-x*p,N=f*b+x*v+d*k-b*v-x*d-f*k,F=f*g*k+m*b*v+x*d*p-x*g*v-m*d*k-f*b*p,B=w*g+m*E+T*p-g*E-m*T-w*p,L=f*T+w*v+d*E-T*v-w*d-f*E,Y=f*g*E+m*T*v+w*d*p-w*g*v-m*d*E-f*T*p;a.transform(O/V,B/V,N/V,L/V,F/V,Y/V),window.navigator.isAppXCanvasPlus&&"IMAGE"===c.tagName&&(c=window.navigator.canUseBinding?c.$realImage:c.src);for(var X=t.canvasDrawTimes;X>0;X--)a.drawImage(c,0,0,h*l.resolution,u*l.resolution,0,0,h,u);a.restore(),this.renderer.invalidateBlendMode()}}},{key:"renderMeshFlat",value:function(t){var e=this.renderer.context,r=t.vertices,n=r.length/2;e.beginPath();for(var a=1;a<n-2;++a){var i=2*a,s=r[i],o=r[i+1],l=r[i+2],h=r[i+3],u=r[i+4],c=r[i+5];e.moveTo(s,o),e.lineTo(l,h),e.lineTo(u,c)}e.fillStyle="#FF0000",e.fill(),e.closePath()}},{key:"destroy",value:function(){this.renderer=null}}]),t}();Tiny.CanvasRenderer.registerPlugin("mesh",f);var d=function(t){function n(t,r,a){e(this,n);var s=i(this,(n.__proto__||Object.getPrototypeOf(n)).call(this,t));return s._ready=!0,s.verticesX=r||10,s.verticesY=a||10,s.drawMode=l.DRAW_MODES.TRIANGLES,s.refresh(),s}return a(n,t),r(n,[{key:"_refresh",value:function(){for(var t=this._texture,e=this.verticesX*this.verticesY,r=[],n=[],a=[],i=this.verticesX-1,s=this.verticesY-1,o=t.width/i,l=t.height/s,h=0;h<e;h++){var u=h%this.verticesX,c=h/this.verticesX|0;r.push(u*o,c*l),n.push(u/i,c/s)}for(var f=i*s,d=0;d<f;d++){var v=d%i,m=d/i|0,g=m*this.verticesX+v,p=m*this.verticesX+v+1,y=(m+1)*this.verticesX+v,x=(m+1)*this.verticesX+v+1;a.push(g,p,y),a.push(p,x,y)}this.vertices=new Float32Array(r),this.uvs=new Float32Array(n),this.colors=new Float32Array([]),this.indices=new Uint16Array(a),this.dirty++,this.indexDirty++,this.multiplyUvs()}},{key:"_onTextureUpdate",value:function(){l.prototype._onTextureUpdate.call(this),this._ready&&this.refresh()}}]),n}(l),v=10,m=function(t){function s(t,r,n,a,o){e(this,s);var l=i(this,(s.__proto__||Object.getPrototypeOf(s)).call(this,t,4,4));return l._origWidth=t.orig.width,l._origHeight=t.orig.height,l._width=l._origWidth,l._height=l._origHeight,l._leftWidth=void 0!==r?r:v,l._rightWidth=void 0!==a?a:v,l._topHeight=void 0!==n?n:v,l._bottomHeight=void 0!==o?o:v,l._cachedTint=16777215,l._tintedTexture=null,l._canvasUvs=null,l.refresh(!0),l}return a(s,t),r(s,[{key:"updateHorizontalVertices",value:function(){var t=this.vertices,e=this._topHeight+this._bottomHeight,r=this._height>e?1:this._height/e;t[9]=t[11]=t[13]=t[15]=this._topHeight*r,t[17]=t[19]=t[21]=t[23]=this._height-this._bottomHeight*r,t[25]=t[27]=t[29]=t[31]=this._height}},{key:"updateVerticalVertices",value:function(){var t=this.vertices,e=this._leftWidth+this._rightWidth,r=this._width>e?1:this._width/e;t[2]=t[10]=t[18]=t[26]=this._leftWidth*r,t[4]=t[12]=t[20]=t[28]=this._width-this._rightWidth*r,t[6]=t[14]=t[22]=t[30]=this._width}},{key:"_renderCanvas",value:function(t){var e=t.context,r=this.worldTransform,n=t.resolution,a=16777215!==this.tint,i=this._texture;a&&this._cachedTint!==this.tint&&(this._cachedTint=this.tint,this._tintedTexture=Tiny.CanvasTinter.getTintedTexture(this,this.tint));var s=a?this._tintedTexture:i.baseTexture.source;window.navigator.isAppXCanvasPlus&&"IMAGE"===s.tagName&&(s=window.navigator.canUseBinding?s.$realImage:s.src),this._canvasUvs||(this._canvasUvs=[0,0,0,0,0,0,0,0]);var o=this.vertices,l=this._canvasUvs,h=a?0:i.frame.x,u=a?0:i.frame.y,c=h+i.frame.width,f=u+i.frame.height;l[0]=h,l[1]=h+this._leftWidth,l[2]=c-this._rightWidth,l[3]=c,l[4]=u,l[5]=u+this._topHeight,l[6]=f-this._bottomHeight,l[7]=f;for(var d=0;d<8;d++)l[d]*=i.baseTexture.resolution;e.globalAlpha=this.worldAlpha,t.setBlendMode(this.blendMode),t.roundPixels?e.setTransform(r.a*n,r.b*n,r.c*n,r.d*n,r.tx*n|0,r.ty*n|0):e.setTransform(r.a*n,r.b*n,r.c*n,r.d*n,r.tx*n,r.ty*n);for(var v=0;v<3;v++)for(var m=0;m<3;m++){var g=2*m+8*v,p=Math.max(1,l[m+1]-l[m]),y=Math.max(1,l[v+5]-l[v+4]),x=Math.max(1,o[g+10]-o[g]),b=Math.max(1,o[g+11]-o[g+1]);e.drawImage(s,l[m],l[v+4],p,y,o[g],o[g+1],x,b)}}},{key:"_refresh",value:function(){n(s.prototype.__proto__||Object.getPrototypeOf(s.prototype),"_refresh",this).call(this);var t=this.uvs,e=this._texture;this._origWidth=e.orig.width,this._origHeight=e.orig.height;var r=1/this._origWidth,a=1/this._origHeight;t[0]=t[8]=t[16]=t[24]=0,t[1]=t[3]=t[5]=t[7]=0,t[6]=t[14]=t[22]=t[30]=1,t[25]=t[27]=t[29]=t[31]=1,t[2]=t[10]=t[18]=t[26]=r*this._leftWidth,t[4]=t[12]=t[20]=t[28]=1-r*this._rightWidth,t[9]=t[11]=t[13]=t[15]=a*this._topHeight,t[17]=t[19]=t[21]=t[23]=1-a*this._bottomHeight,this.updateHorizontalVertices(),this.updateVerticalVertices(),this.dirty++,this.multiplyUvs()}},{key:"width",get:function(){return this._width},set:function(t){this._width=t,this._refresh()}},{key:"height",get:function(){return this._height},set:function(t){this._height=t,this._refresh()}},{key:"leftWidth",get:function(){return this._leftWidth},set:function(t){this._leftWidth=t,this._refresh()}},{key:"rightWidth",get:function(){return this._rightWidth},set:function(t){this._rightWidth=t,this._refresh()}},{key:"topHeight",get:function(){return this._topHeight},set:function(t){this._topHeight=t,this._refresh()}},{key:"bottomHeight",get:function(){return this._bottomHeight},set:function(t){this._bottomHeight=t,this._refresh()}}]),s}(d),g=function(t){function n(t,r){e(this,n);var a=i(this,(n.__proto__||Object.getPrototypeOf(n)).call(this,t));return a.points=r,a.vertices=new Float32Array(4*r.length),a.uvs=new Float32Array(4*r.length),a.colors=new Float32Array(2*r.length),a.indices=new Uint16Array(2*r.length),a.autoUpdate=!0,a.refresh(),a}return a(n,t),r(n,[{key:"_refresh",value:function(){var t=this.points;if(!(t.length<1)&&this._texture._uvs){this.vertices.length/4!==t.length&&(this.vertices=new Float32Array(4*t.length),this.uvs=new Float32Array(4*t.length),this.colors=new Float32Array(2*t.length),this.indices=new Uint16Array(2*t.length));var e=this.uvs,r=this.indices,n=this.colors;e[0]=0,e[1]=0,e[2]=0,e[3]=1,n[0]=1,n[1]=1,r[0]=0,r[1]=1;for(var a=t.length,i=1;i<a;i++){var s=4*i,o=i/(a-1);e[s]=o,e[s+1]=0,e[s+2]=o,e[s+3]=1,n[s=2*i]=1,n[s+1]=1,r[s=2*i]=s,r[s+1]=s+1}this.dirty++,this.indexDirty++,this.multiplyUvs(),this.refreshVertices()}}},{key:"refreshVertices",value:function(){var t=this.points;if(!(t.length<1))for(var e=t[0],r=void 0,n=0,a=0,i=this.vertices,s=t.length,o=0;o<s;o++){var l=t[o],h=4*o;r=o<t.length-1?t[o+1]:l,a=-(r.x-e.x),n=r.y-e.y;var u=Math.sqrt(n*n+a*a),c=this._texture.height/2;n/=u,a/=u,n*=c,a*=c,i[h]=l.x+n,i[h+1]=l.y+a,i[h+2]=l.x-n,i[h+3]=l.y-a,e=l}}},{key:"updateTransform",value:function(){this.autoUpdate&&this.refreshVertices(),this.containerUpdateTransform()}}]),n}(l);t.Mesh=l,t.MeshRenderer=c,t.CanvasMeshRenderer=f,t.Plane=d,t.NineSlicePlane=m,t.Rope=g,Object.defineProperty(t,"__esModule",{value:!0})}(e)}(se={exports:{}},se.exports),se.exports),he=(oe=le)&&oe.__esModule&&Object.prototype.hasOwnProperty.call(oe,"default")?oe.default:oe;xt.yDown=!0;var ue=[0,0,0],ce=function(t){function r(t){e(this,r);var n=a(this,(r.__proto__||Object.getPrototypeOf(r)).call(this,t));return n.region=null,n}return n(r,t),r}(Tiny.Sprite),fe=function(t){function r(t,n,i,s,o){return e(this,r),a(this,(r.__proto__||Object.getPrototypeOf(r)).call(this,t,n,i,s,o))}return n(r,t),r}(he.Mesh),de=function(t){function i(t){e(this,i);var r=a(this,(i.__proto__||Object.getPrototypeOf(i)).call(this));if(!t)throw new Error("The spineData param is required.");if("string"==typeof t)throw new Error('spineData param cant be string. Please use spine.Spine.fromAtlas("YOUR_RESOURCE_NAME") from now on.');r.spineData=t,r.skeleton=new Pt(t),r.skeleton.updateWorldTransform(),r.stateData=new lt(t),r.state=new it(r.stateData),r.slotContainers=[],r.tempClipContainers=[];for(var n=0,s=r.skeleton.slots.length;n<s;n++){var o=r.skeleton.slots[n],l=o.getAttachment(),h=r.newContainer();if(h.name=o.data.name,r.slotContainers.push(h),r.addChild(h),r.tempClipContainers.push(null),l instanceof ht){var u=l.region.name,c=r.createSprite(o,l,u);o.currentSprite=c,o.currentSpriteName=u,h.addChild(c)}else if(l instanceof ut){var f=r.createMesh(o,l);o.currentMesh=f,o.currentMeshName=l.name,h.addChild(f)}else{if(!(l instanceof vt))continue;r.createGraphics(o,l),h.addChild(o.clippingContainer),h.addChild(o.currentGraphics)}}return r.autoUpdate=!0,r.tintRgb=new Float32Array([1,1,1]),r}return n(i,t),r(i,[{key:"update",value:function(t){var e=this.delayLimit;if(t>e&&(t=e),this.state.update(t),this.state.apply(this.skeleton),this.skeleton){this.skeleton.updateWorldTransform();var r=this.skeleton.slots,n=this.color,a=null,i=null;n?(a=n.light,i=n.dark):a=this.tintRgb;for(var s=Tiny.TransformBase&&1===this.transformHack(),o=0,l=r.length;o<l;o++){var h=r[o],u=h.getAttachment(),c=this.slotContainers[o];if(u){var f=null,d=u.color;if(u instanceof ht){var v=u.region;if(v){h.currentMesh&&(h.currentMesh.visible=!1,h.currentMesh=null,h.currentMeshName=void 0);var m=v;if(!h.currentSpriteName||h.currentSpriteName!==m.name){var g=m.name;if(h.currentSprite&&(h.currentSprite.visible=!1),h.sprites=h.sprites||{},void 0!==h.sprites[g])h.sprites[g].visible=!0;else{var p=this.createSprite(h,u,g);c.addChild(p)}h.currentSprite=h.sprites[g],h.currentSpriteName=g}}if(c.transform){var y=c.transform,x=y,b=null;x.matrix2d?(b=x.matrix2d,x._dirtyVersion++,x.version=x._dirtyVersion,x.isStatic=!0,x.operMode=0):s?(x.position&&((y=new Tiny.TransformBase)._parentID=-1,y._worldID=c.transform._worldID,c.transform=y),b=y.localTransform):x.setFromMatrix(h.bone.matrix),b&&h.bone.matrix.copy(b)}h.currentSprite.color?f=h.currentSprite.color:(ue[0]=a[0]*h.color.r*d.r,ue[1]=a[1]*h.color.g*d.g,ue[2]=a[2]*h.color.b*d.b,h.currentSprite.tint=Tiny.rgb2hex(ue)),h.currentSprite.blendMode=h.blendMode}else if(u instanceof ut){if(h.currentSprite)if(h.currentSprite.visible=!1,h.currentSprite=null,h.currentSpriteName=void 0,c.transform){var k=new Tiny.TransformStatic;k._parentID=-1,k._worldID=c.transform._worldID,c.transform=k}else c.localTransform=new Tiny.Matrix,c.displayObjectUpdateTransform=Tiny.DisplayObject.prototype.updateTransform;if(!h.currentMeshName||h.currentMeshName!==u.name){var w=u.name;if(h.currentMesh&&(h.currentMesh.visible=!1),h.meshes=h.meshes||{},void 0!==h.meshes[w])h.meshes[w].visible=!0;else{var T=this.createMesh(h,u);c.addChild(T)}h.currentMesh=h.meshes[w],h.currentMeshName=w}u.computeWorldVerticesOld(h,h.currentMesh.vertices),h.currentMesh.color&&(f=h.currentMesh.color);var E=h.currentMesh.tintRgb;E[0]=a[0]*h.color.r*d.r,E[1]=a[1]*h.color.g*d.g,E[2]=a[2]*h.color.b*d.b,h.currentMesh.blendMode=h.blendMode}else{if(!(u instanceof vt)){c.visible=!1;continue}h.currentGraphics||(this.createGraphics(h,u),c.addChild(h.clippingContainer),c.addChild(h.currentGraphics)),this.updateGraphics(h,u)}if(c.visible=!0,f){var M=h.color.r*d.r,S=h.color.g*d.g,_=h.color.b*d.b;f.setLight(a[0]*M+i[0]*(1-M),a[1]*S+i[1]*(1-S),a[2]*_+i[2]*(1-_)),h.darkColor?(M=h.darkColor.r,S=h.darkColor.g,_=h.darkColor.b):(M=0,S=0,_=0),f.setDark(a[0]*M+i[0]*(1-M),a[1]*S+i[1]*(1-S),a[2]*_+i[2]*(1-_))}c.alpha=h.color.a}else c.visible=!1}for(var I=this.skeleton.drawOrder,R=null,A=null,C=0,P=I.length;C<P;C++){var V=r[I[C].data.index],O=this.slotContainers[I[C].data.index];if(A||null!==O.parent&&O.parent!==this&&(O.parent.removeChild(O),O.parent=this),V.currentGraphics&&V.getAttachment())A=V.clippingContainer,R=V.getAttachment(),A.children.length=0,this.children[C]=O,R.endSlot===V.data&&(R.endSlot=null);else if(A){var N=this.tempClipContainers[C];N||((N=this.tempClipContainers[C]=this.newContainer()).visible=!1),this.children[C]=N,O.parent=null,A.addChild(O),R.endSlot===V.data&&(A.renderable=!0,A=null,R=null)}else this.children[C]=O}}}},{key:"setSpriteRegion",value:function(t,e,r){e.region=r,e.texture=r.texture,r.size?(e.scale.x=r.size.width/r.originalWidth,e.scale.y=-r.size.height/r.originalHeight):(e.scale.x=t.scaleX*t.width/r.originalWidth,e.scale.y=-t.scaleY*t.height/r.originalHeight)}},{key:"setMeshRegion",value:function(t,e,r){e.region=r,e.texture=r.texture,r.texture._updateUvs(),t.updateUVs(r,e.uvs),e.dirty++}},{key:"autoUpdateTransform",value:function(){if(i.globalAutoUpdate){this.lastTime=this.lastTime||Date.now();var t=.001*(Date.now()-this.lastTime);this.lastTime=Date.now(),this.update(t)}else this.lastTime=0;this.containerUpdateTransform()}},{key:"createSprite",value:function(t,e,r){var n=e.region;t.hackAttachment===e&&(n=t.hackRegion);var a=n.texture,i=this.newSprite(a);return i.rotation=e.rotation*c,i.anchor.x=.5,i.anchor.y=.5,i.position.x=e.x,i.position.y=e.y,i.alpha=e.color.a,i.name=r,i.region=e.region,this.setSpriteRegion(e,i,e.region),t.sprites=t.sprites||{},t.sprites[r]=i,i}},{key:"createMesh",value:function(t,e){var r=e.region;t.hackAttachment===e&&(r=t.hackRegion,t.hackAttachment=null,t.hackRegion=null);var n=this.newMesh(r.texture,new Float32Array(e.regionUVs.length),new Float32Array(e.regionUVs.length),new Uint16Array(e.triangles),he.Mesh.DRAW_MODES.TRIANGLES);return n.canvasPadding=1.5,n.alpha=e.color.a,n.region=e.region,n.name=e.name,this.setMeshRegion(e,n,r),t.meshes=t.meshes||{},t.meshes[e.name]=n,n}},{key:"createGraphics",value:function(t,e){var r=this.newGraphics(),n=new Tiny.Polygon([]);return r.clear(),r.beginFill(16777215,1),r.drawPolygon(n),r.renderable=!1,t.currentGraphics=r,t.clippingContainer=this.newContainer(),t.clippingContainer.mask=t.currentGraphics,r}},{key:"updateGraphics",value:function(t,e){var r=t.currentGraphics.graphicsData[0].shape.points,n=e.worldVerticesLength;r.length=n,e.computeWorldVertices(t,0,n,r,0,2),t.currentGraphics.dirty++,t.currentGraphics.clearDirty++}},{key:"hackTextureBySlotIndex",value:function(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null,n=this.skeleton.slots[t];if(!n)return!1;var a=n.getAttachment(),i=a.region;return e?((i=new Kt).texture=e,i.size=r,n.hackRegion=i,n.hackAttachment=a):(n.hackRegion=null,n.hackAttachment=null),n.currentSprite&&n.currentSprite.region!==i?(this.setSpriteRegion(a,n.currentSprite,i),n.currentSprite.region=i):n.currentMesh&&n.currentMesh.region!==i&&this.setMeshRegion(a,n.currentMesh,i),!0}},{key:"hackTextureBySlotName",value:function(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null,n=this.skeleton.findSlotIndex(t);return-1!==n&&this.hackTextureBySlotIndex(n,e,r)}},{key:"newContainer",value:function(){return new Tiny.Container}},{key:"newSprite",value:function(t){return new ce(t)}},{key:"newGraphics",value:function(){return new Tiny.Graphics}},{key:"newMesh",value:function(t,e,r,n,a){return new fe(t,e,r,n,a)}},{key:"transformHack",value:function(){return 1}},{key:"hackAttachmentGroups",value:function(t,e,r){if(t){for(var n=[],a=[],i=0,s=this.skeleton.slots.length;i<s;i++){var o=this.skeleton.slots[i],l=o.currentSpriteName||o.currentMeshName||"",h=o.currentSprite||o.currentMesh;l.endsWith(t)?(h.parentGroup=e,a.push(h)):r&&h&&(h.parentGroup=r,n.push(h))}return[n,a]}}},{key:"destroy",value:function(t){for(var e=0,r=this.skeleton.slots.length;e<r;e++){var n=this.skeleton.slots[e];for(var a in n.meshes)n.meshes[a].destroy(t);for(var s in n.meshes=null,n.sprites)n.sprites[s].destroy(t);n.sprites=null}for(var o=0,l=this.slotContainers.length;o<l;o++)this.slotContainers[o].destroy(t);this.spineData=null,this.skeleton=null,this.slotContainers=null,this.stateData=null,this.state=null,this.tempClipContainers=null,function t(e,r,n){null===e&&(e=Function.prototype);var a=Object.getOwnPropertyDescriptor(e,r);if(void 0===a){var i=Object.getPrototypeOf(e);return null===i?void 0:t(i,r,n)}if("value"in a)return a.value;var s=a.get;return void 0!==s?s.call(n):void 0}(i.prototype.__proto__||Object.getPrototypeOf(i.prototype),"destroy",this).call(this,t)}},{key:"autoUpdate",get:function(){return this.updateTransform===i.prototype.autoUpdateTransform},set:function(t){this.updateTransform=t?i.prototype.autoUpdateTransform:Tiny.Container.prototype.updateTransform}},{key:"visible",get:function(){return this._visible},set:function(t){t!==this._visible&&(this._visible=t,t&&(this.lastTime=0))}},{key:"tint",get:function(){return Tiny.rgb2hex(this.tintRgb)},set:function(t){this.tintRgb=Tiny.hex2rgb(t,this.tintRgb)}},{key:"delayLimit",get:function(){return(void 0!==this.localDelayLimit?this.localDelayLimit:i.globalDelayLimit)||Number.MAX_VALUE}}]),i}(Tiny.Container);de.globalAutoUpdate=!0,de.globalDelayLimit=0,de.clippingPolygon=[];var ve=Tiny.rgb2hex([192/255,192/255,192/255]),me=Tiny.rgb2hex([.8,0,0]),ge=Tiny.rgb2hex([1,0,0]),pe=Tiny.rgb2hex([0,1,0]),ye=Tiny.rgb2hex([1,.64,0]),xe=Tiny.rgb2hex([0,0,1]),be=Tiny.rgb2hex([.8,0,0]),ke=function(){function t(r){var n=this,a=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};e(this,t),this.controlBones=a.controlBones||[],this.drawBones=a.drawBones||!1,this.drawSkeletonXY=a.drawSkeletonXY||!1,this.drawPaths=a.drawPaths||!1,this.drawMeshHull=a.drawMeshHull||!1,this.drawMeshTriangles=a.drawMeshTriangles||!1,this.drawRegionAttachments=a.drawRegionAttachments||!1,this.drawClipping=a.drawClipping||!1,this.skeleton=r.skeleton,this.container=new Tiny.Container,this.controlBonesContainer=new Tiny.Container,this.temp=[],this.vertices=A(2048),this.controlBones.length&&this.controlBones.forEach(function(t){var e=new Tiny.Graphics;e.name=t+"-graphics",n.controlBonesContainer.addChild(e)}),this.drawBones&&(this.bonesGraphics=new Tiny.Graphics,this.container.addChild(this.bonesGraphics)),this.drawPaths&&(this.pathsGraphics=new Tiny.Graphics,this.container.addChild(this.pathsGraphics)),(this.drawMeshHull||this.drawMeshTriangles)&&(this.meshsGraphics=new Tiny.Graphics,this.container.addChild(this.meshsGraphics)),this.drawRegionAttachments&&(this.regionAttachmentsGraphics=new Tiny.Graphics,this.container.addChild(this.regionAttachmentsGraphics)),this.drawClipping&&(this.clippingGraphics=new Tiny.Graphics,this.container.addChild(this.clippingGraphics)),r.addChild(this.container),r.addChild(this.controlBonesContainer);var i=this;this.container.updateTransform=function(){i.drawBones&&i._drawBones(i.controlBones),i.drawPaths&&i._drawPaths(),(i.drawMeshHull||i.drawMeshTriangles)&&i._drawMeshs(),i.drawRegionAttachments&&i._drawRegionAttachments(),i.drawClipping&&i._drawClipping(),i.controlBones.length&&i._drawControlBones(i.controlBones),this.containerUpdateTransform()}}return r(t,[{key:"_drawControlBones",value:function(t){var e=this.skeleton,r=this.controlBonesContainer,n=e.x,a=e.y;t.forEach(function(t){var i=r.getChildByName(t+"-graphics"),s=e.findBone(t),o=s.worldX,l=s.worldY;i.clear(),i.lineStyle(1,me,.8),i.beginFill(me,.5),i.drawCircle(n+o,a+l,10),i.endFill()})}},{key:"_drawBones",value:function(t){for(var e=this.bonesGraphics,r=this.skeleton,n=r.x,a=r.y,s=r.bones,o=[],l=0,h=s.length;l<h;l++){var u=s[l],c=u.worldX,f=u.worldY;if(!(t&&t.indexOf(u.data.name)>-1)&&null!=u.parent){var d=n+u.data.length*u.matrix.a+c,v=a+u.data.length*u.matrix.b+f;o.push([n+c,a+f,d,v])}}e.clear(),e.lineStyle(1,ge,1),o.forEach(function(t,r){var n=i(t,4),a=n[0],s=n[1],o=n[2],l=n[3];e.moveTo(a,s),e.lineTo(o,l)}),e.beginFill(pe,1),e.lineStyle(0),o.forEach(function(t){var r=i(t,2),n=r[0],a=r[1];e.drawCircle(n,a,2)}),this.drawSkeletonXY&&(e.beginFill(ge),e.drawStar(n,a,4,1,5)),e.endFill()}},{key:"_drawPaths",value:function(){var t=this.pathsGraphics,e=this.skeleton.slots;t.clear(),t.moveTo(0,0);for(var r=0,n=e.length;r<n;r++){var a=e[r];if(a.bone.active){var i=a.getAttachment();if(i instanceof ft){var s=i,o=s.worldVerticesLength,l=this.temp=_(this.temp,o,0);s.computeWorldVertices(a,0,o,l,0,2);var h=l[2],u=l[3],c=0,f=0;if(s.closed){var d=l[0],v=l[1],m=l[o-2],g=l[o-1];c=l[o-4],f=l[o-3],t.lineStyle(1,16744192,1),t.moveTo(h,u),t.bezierCurveTo(d,v,m,g,c,f),t.lineStyle(1,ve,1),t.moveTo(h,u),t.lineTo(d,v),t.moveTo(c,f),t.lineTo(m,g),t.moveTo(c,f)}o-=4;for(var p=4;p<o;p+=6){var y=l[p],x=l[p+1],b=l[p+2],k=l[p+3];c=l[p+4],f=l[p+5],t.lineStyle(1,16744192,1),t.moveTo(h,u),t.bezierCurveTo(y,x,b,k,c,f),t.lineStyle(1,ve,1),t.moveTo(h,u),t.lineTo(y,x),t.moveTo(c,f),t.lineTo(b,k),t.moveTo(c,f),h=c,u=f}}}}}},{key:"_drawMeshs",value:function(){var t=this.meshsGraphics,e=this.skeleton.slots;t.clear();for(var r=0,n=e.length;r<n;r++){var a=e[r];if(a.bone.active){var i=a.getAttachment();if(i instanceof ut){var s=i,o=this.vertices;s.computeWorldVertices(a,0,s.worldVerticesLength,o,0,2);var l=s.triangles,h=s.hullLength;if(this.drawMeshTriangles){t.lineStyle(1,ye,.5);for(var u=0,c=l.length;u<c;u+=3){var f=2*l[u],d=2*l[u+1],v=2*l[u+2];t.moveTo(o[f],o[f+1]),t.lineTo(o[d],o[d+1]),t.lineTo(o[v],o[v+1])}}if(this.drawMeshHull&&h>0){var m=o[(h=2*(h>>1))-2],g=o[h-1];t.lineStyle(1,xe,.5);for(var p=0,y=h;p<y;p+=2){var x=o[p],b=o[p+1];t.moveTo(x,b),t.lineTo(m,g),m=x,g=b}}}}}}},{key:"_drawRegionAttachments",value:function(){var t=this.regionAttachmentsGraphics,e=this.skeleton.slots;t.clear(),t.lineStyle(1,xe,.5);for(var r=0,n=e.length;r<n;r++){var a=e[r],i=a.getAttachment();if(i instanceof ht){var s=i,o=this.vertices;s.computeWorldVertices(a.bone,o,0,2),t.moveTo(o[0],o[1]),t.lineTo(o[2],o[3]),t.lineTo(o[4],o[5]),t.lineTo(o[6],o[7]),t.lineTo(o[0],o[1])}}}},{key:"_drawClipping",value:function(){var t=this.clippingGraphics,e=this.skeleton.slots;t.clear(),t.lineStyle(1,be,1);for(var r=0,n=e.length;r<n;r++){var a=e[r];if(a.bone.active){var i=a.getAttachment();if(i instanceof vt){var s=i,o=s.worldVerticesLength,l=_(this.temp,o,0);s.computeWorldVertices(a,0,o,l,0,2);for(var h=0,u=l.length;h<u;h+=2){var c=l[h],f=l[h+1],d=l[(h+2)%l.length],v=l[(h+3)%l.length];t.moveTo(c,f),t.lineTo(d,v)}}}}}},{key:"clear",value:function(t){this.bonesGraphics&&this.bonesGraphics.clear(),this.pathsGraphics&&this.pathsGraphics.clear(),this.meshsGraphics&&this.meshsGraphics.clear(),this.regionAttachmentsGraphics&&this.regionAttachmentsGraphics.clear(),this.clippingGraphics&&this.clippingGraphics.clear(),t&&(this.container.removeChildren(),this.controlBonesContainer.removeChildren())}}]),t}();t.Debugger=ke,t.atlasParser=ne,t.imageLoaderAdapter=ae,t.staticImageLoader=ie,t.SpineSprite=ce,t.SpineMesh=fe,t.Spine=de,t.AnimationStateData=lt,t.BlendMode=gt,t.Bone=xt,t.ConstraintData=bt,t.Event=kt,t.EventData=wt,t.IKConstraint=Tt,t.IKConstraintData=Et,t.PathConstraint=Rt,t.Skeleton=Pt,t.SkeletonBounds=Wt,t.SkeletonData=Ot,t.Slot=At,t.SlotData=Nt,t.TransformConstraint=Ct,t.TransformConstraintData=Vt,t.Triangulator=Ut,t.BoundingBoxAttachment=ct,t.ClippingAttachment=vt,t.MeshAttachment=ut,t.PathAttachment=ft,t.PointAttachment=dt,t.RegionAttachment=ht,t.JitterEffect=ee,t.SwirlEffect=re,t.SUPPORTS_TYPED_ARRAYS=M,t.arrayCopy=S,t.setArraySize=_,t.ensureArrayCapacity=I,t.newArray=R,t.newFloatArray=A,t.newShortArray=function(t){if(M)return new Int16Array(t);for(var e=new Array(t),r=0;r<e.length;r++)e[r]=0;return e},t.toFloatArray=C,t.toSinglePrecision=P,t.webkit602BugfixHelper=function(t,e){},t.contains=V,t.Color=s,t.PI=l,t.PI2=h,t.radians2Degrees=57.29577866666166,t.radDeg=u,t.degrees2Radians=.01745329277777778,t.degRad=c,t.clamp=f,t.cosDeg=d,t.sinDeg=v,t.signum=m,t.toInt=function(t){return t>0?Math.floor(t):Math.ceil(t)},t.cbrt=function(t){var e=Math.pow(Math.abs(t),1/3);return t<0?-e:e},t.randomTriangular=g,t.randomTriangularWith=p,t.Vector2=y,t.Vector3=x,t.Pool=b,t.IntSet=k,t.Pow=T,t.PowOut=E,t.MixDirection=L,t.TimelineType=Y,t.MixBlend=B,t.Animation=X,t.CurveTimeline=D,t.RotateTimeline=W,t.TranslateTimeline=U,t.ScaleTimeline=G,t.ShearTimeline=q,t.ColorTimeline=j,t.TwoColorTimeline=H,t.AttachmentTimeline=z,t.DeformTimeline=K,t.EventTimeline=J,t.DrawOrderTimeline=Q,t.IKConstraintTimeline=$,t.TransformConstraintTimeline=tt,t.PathConstraintPositionTimeline=et,t.PathConstraintSpacingTimeline=rt,t.PathConstraintMixTimeline=nt,t.EventType=at,t.AnimationState=it,t.TrackEntry=st,t.EventQueue=ot,t.AtlasAttachmentLoader=mt,t.TransformMode=pt,t.BoneData=yt,t.PathConstraintData=Mt,t.PositionMode=St,t.SpacingMode=_t,t.RotateMode=It,t.SkeletonBinary=Lt,t.SkeletonClipping=Gt,t.FAIL_ON_NON_EXISTING_SKIN=!1,t.SkeletonJSON=qt,t.Skin=Bt,t.SkinEntry=Ft,t.TextureFilter=Ht,t.TextureWrap=zt,t.Texture=Zt,t.TextureRegion=Kt,t.TextureAtlas=Jt,t.TextureAtlasPage=Qt,t.TextureAtlasRegion=$t,t.Attachment=N,t.VertexAttachment=F,t.AttachmentType=O,Object.defineProperty(t,"__esModule",{value:!0})});
