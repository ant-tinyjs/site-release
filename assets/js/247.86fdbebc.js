(window.webpackJsonp=window.webpackJsonp||[]).push([[247],{535:function(t,s,a){"use strict";a.r(s);var e=a(1),n=Object(e.a)({},(function(){var t=this,s=t.$createElement,a=t._self._c||s;return a("div",{staticClass:"content"},[t._m(0),t._m(1),a("p",[t._v("先看一下下面这张纹理图，前端习惯叫做雪碧图，在游戏界一般叫做 Atlas 图集，原始分辨率为 512*512，文件大小为 53KB。")]),t._m(2),t._m(3),t._m(4),t._m(5),t._m(6),t._m(7),a("p",[t._v("压缩纹理是一种游戏领域常用的纹理压缩技术，其依赖于特定硬件实现，经过某种算法压缩之后的纹理可直接以固定速率交由 GPU 即时解压使用，只有当 shader 进行纹理查询（texture lookup）才会进行解压操作，找到对应位置的像素颜色。GPU 通常会对解压过程进行优化从而提升性能。")]),a("p",[t._v("那么，它在内存占用上有质的优势，详细如下：")]),t._m(8),t._m(9),a("p",[t._v("有优点肯定也有条件和代价，也可以说是规范or约束：")]),t._m(10),a("p",[t._v("整体来说，这些约束对于大体量图片项目影响不大，收益却相当可观。")]),t._m(11),t._m(12),a("p",[t._v("鉴于业界优秀软件的合并效果更好，建议使用相关软件/工具制作，比如："),a("a",{attrs:{href:"https://www.codeandweb.com/texturepacker",target:"_blank",rel:"noopener noreferrer"}},[t._v("TexturePacker"),a("OutboundLink")],1),t._v("，这里推荐 "),a("a",{attrs:{href:"http://renderhjs.net/shoebox/",target:"_blank",rel:"noopener noreferrer"}},[t._v("ShoeBox"),a("OutboundLink")],1),t._v("（好用、免费）。")]),a("p",[t._v("以下是通过 ShoeBox 生成的图集资源：")]),t._m(13),t._m(14),a("p",[t._v("通过上面制作生成的 "),a("code",[t._v(".png")]),t._v(" 和 "),a("code",[t._v(".json")]),t._v("，你可以使用 "),a("router-link",{attrs:{to:"/tools/"}},[t._v("tinyjs-cli")]),t._v(" 来快速生成压缩纹理。")],1),t._m(15),t._m(16),t._m(17),a("blockquote",[a("p",[t._v("Tips")]),a("ul",[a("li",[t._v("生成 KTX 纹理的功能，"),a("code",[t._v("tinyjs-cli")]),t._v(" 版本需要 "),a("code",[t._v(">=1.3.0")]),t._v("，详细命令请移步："),a("router-link",{attrs:{to:"/tools/#生成压缩纹理"}},[t._v("生成压缩纹理")])],1)])]),t._m(18),t._m(19),t._m(20)])}),[function(){var t=this.$createElement,s=this._self._c||t;return s("h1",{attrs:{id:"使用压缩纹理"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#使用压缩纹理","aria-hidden":"true"}},[this._v("#")]),this._v(" 使用压缩纹理")])},function(){var t=this.$createElement,s=this._self._c||t;return s("h2",{attrs:{id:"无法减小显存占用"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#无法减小显存占用","aria-hidden":"true"}},[this._v("#")]),this._v(" 无法减小显存占用")])},function(){var t=this.$createElement,s=this._self._c||t;return s("p",[s("img",{attrs:{src:"https://gw.alipayobjects.com/os/tiny/resources/1.0.5/compressedtexture/hao.png",alt:""}})])},function(){var t=this.$createElement,s=this._self._c||t;return s("p",[this._v("一般情况下，浏览器内部会将 JPEG/PNG 图片文件进行解压，并解码成显卡认识的 RGB(A) 位图格式纹理，如果带 alpha 通道，图片就需要占用内存存储 "),s("code",[this._v("512*512*4")]),this._v("，即 1M，同时这 1M 的信息也需要加载到 GPU 缓存中（虽然文件格式、磁盘占用、内存占用大小不一样，即无论将图片的存储体积压缩到多么小，其显存开销总是固定的），即：一张图片在引擎中运行时占用的显存大小，与图片本身占用磁盘大小无关，只和图片的宽和高相关。\n所以，类似 JPEG/PNG 文件作为纹理时会有以下问题：")])},function(){var t=this.$createElement,s=this._self._c||t;return s("ul",[s("li",[this._v("浏览器解压图片存在耗时，图片越大，耗时越多")]),s("li",[this._v("内存占用较多，除了原始文件的存储，浏览器和 GPU 还会各自保存一份位图数据（如图示1）")])])},function(){var t=this.$createElement,s=this._self._c||t;return s("p",[s("img",{attrs:{src:"https://gw.alipayobjects.com/mdn/rms_73f2e4/afts/img/A*5YwoQLKT0KIAAAAAAAAAAABkARQnAQ",alt:""}}),this._v("\n图示1：img 对象创建纹理的内存使用情况")])},function(){var t=this.$createElement,s=this._self._c||t;return s("p",[s("strong",[this._v("可以看出，第二个问题如果在大体量图片应用场景下，这个瓶颈会越来越明显，在移动设备上很容易造成 OOM。")])])},function(){var t=this.$createElement,s=this._self._c||t;return s("h2",{attrs:{id:"压缩纹理（compressed-textures）"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#压缩纹理（compressed-textures）","aria-hidden":"true"}},[this._v("#")]),this._v(" 压缩纹理（Compressed Textures）")])},function(){var t=this.$createElement,s=this._self._c||t;return s("ul",[s("li",[this._v("内存占用很少，除了原始文件的存储，只有 GPU 保存的一份压缩纹理数据（如图示2）")]),s("li",[this._v("省去了使用 JPEG/PNG 图片文件作为纹理时的图片解码耗时")]),s("li",[this._v("可以精准控制内存，如图示2中 JSHeap 中的占用可以手动控制释放")])])},function(){var t=this.$createElement,s=this._self._c||t;return s("p",[s("img",{attrs:{src:"https://gw.alipayobjects.com/mdn/rms_73f2e4/afts/img/A*qVSDQ55k4CIAAAAAAAAAAABkARQnAQ",alt:""}}),this._v("\n图示2：压缩纹理的内存使用情况")])},function(){var t=this.$createElement,s=this._self._c||t;return s("ul",[s("li",[this._v("压缩纹理是有损压缩，会对图片的质量有一定减损")]),s("li",[this._v("压缩纹理的传输体积可能比 JPG/PNG 要高1~4倍")]),s("li",[this._v("压缩纹理要求POT，即长宽都是二的幂次，同时 PVRTC 也有长宽相等的要求")]),s("li",[this._v("压缩纹理支持格式在不同平台不一，加上降级需要三份资源")])])},function(){var t=this.$createElement,s=this._self._c||t;return s("h2",{attrs:{id:"如何使用？"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#如何使用？","aria-hidden":"true"}},[this._v("#")]),this._v(" 如何使用？")])},function(){var t=this.$createElement,s=this._self._c||t;return s("h3",{attrs:{id:"制作-pot-等宽-atlas-图集"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#制作-pot-等宽-atlas-图集","aria-hidden":"true"}},[this._v("#")]),this._v(" 制作 POT 等宽 Atlas 图集")])},function(){var t=this.$createElement,s=this._self._c||t;return s("ul",[s("li",[this._v("png: https://gw.alipayobjects.com/os/tiny/resources/1.0.5/compressedtexture/hao.png")]),s("li",[this._v("json: https://gw.alipayobjects.com/os/tiny/resources/1.0.5/compressedtexture/hao.json")])])},function(){var t=this.$createElement,s=this._self._c||t;return s("h3",{attrs:{id:"生成压缩纹理"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#生成压缩纹理","aria-hidden":"true"}},[this._v("#")]),this._v(" 生成压缩纹理")])},function(){var t=this.$createElement,s=this._self._c||t;return s("div",{staticClass:"language-bash extra-class"},[s("pre",{pre:!0,attrs:{class:"language-bash"}},[s("code",[this._v("$ tiny texture-compressed res/hao.png\n")])])])},function(){var t=this.$createElement,s=this._self._c||t;return s("p",[this._v("通过以上命令，会在 "),s("code",[this._v("res")]),this._v(" 目录下生成以下格式压缩纹理：")])},function(){var t=this.$createElement,s=this._self._c||t;return s("ul",[s("li",[this._v("astc 格式: https://gw.alipayobjects.com/os/tiny/resources/1.0.5/compressedtexture/hao.astc.ktx")]),s("li",[this._v("pvr 格式: https://gw.alipayobjects.com/os/tiny/resources/1.0.5/compressedtexture/hao.pvr.ktx")])])},function(){var t=this.$createElement,s=this._self._c||t;return s("h3",{attrs:{id:"使用压缩纹理-2"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#使用压缩纹理-2","aria-hidden":"true"}},[this._v("#")]),this._v(" 使用压缩纹理")])},function(){var t=this,s=t.$createElement,a=t._self._c||s;return a("div",{staticClass:"language-js extra-class"},[a("pre",{pre:!0,attrs:{class:"language-js"}},[a("code",[a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("const")]),t._v(" app "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("new")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("Tiny"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("Application")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("...")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("const")]),t._v(" loader "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("new")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("Tiny"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("loaders"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("Loader")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// 初始化压缩纹理插件")]),t._v("\nTiny"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("plugins"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("compressedTexture"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("init")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("app"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("renderer"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// 加载 Atlas 图集")]),t._v("\nloader"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("add")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token string"}},[t._v("'./res/hao.json'")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n  metadata"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v(" useCompressedTexture"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token boolean"}},[t._v("true")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\nloader"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("load")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token parameter"}},[t._v("loaderInstance"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" resources")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=>")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("const")]),t._v(" textures "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("for")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("let")]),t._v(" i "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("0")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v(" i "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("<")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("4")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v(" i"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("++")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// 通过 Texture 的 fromFrame 方法创建纹理。frame 名就是 tileset 资源文件里的 frameId")]),t._v("\n    textures"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("push")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("Tiny"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("Texture"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("fromFrame")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token string"}},[t._v("'hao'")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("+")]),t._v(" i "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("+")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v("'.png'")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n")])])])},function(){var t=this,s=t.$createElement,a=t._self._c||s;return a("blockquote",[a("p",[t._v("Tips")]),a("ul",[a("li",[t._v("压缩纹理只有 WebGL 模式下才有效，如果当前环境不支持 WebGL 会自动降级到同目录下的 "),a("code",[t._v(".png")])]),a("li",[t._v("TinyJS 压缩纹理插件 "),a("code",[t._v("Tiny.plugins.compressedTexture")]),t._v(" 会自动识别当前环境支持的压缩纹理格式并在加载时使用，如安卓上会加载 "),a("code",[t._v(".astc.ktx")]),t._v("，iOS 上会加载 "),a("code",[t._v(".pvr.ktx")]),t._v("，不支持的会加载 "),a("code",[t._v(".png")])]),a("li",[t._v("在创建并使用 "),a("code",[t._v("Tiny.Texture")]),t._v(" 时，和使用普通的 tileset 一样")])])])}],!1,null,null,null);s.default=n.exports}}]);